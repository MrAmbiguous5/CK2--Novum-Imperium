namespace = toe

#Inefficiency event on check or if the title is new

character_event = {
	id = toe.999 
	
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		primary_title = {
			tier = EMPEROR
			temporary = no
			is_tribal = no
			is_nomadic = no
		}
		is_nomadic = no
		is_tribal = no
	}
	
	immediate = {
		primary_title = { save_event_target_as = imperial_inefficiency_title }
		
		character_event = { id = toe.1001 days = 1 }
		
		# remove the inefficiency modifier from the former owner, if alive
	}
}

# Main inefficiency event upon an imperial title being inherited/usurped
# ROOT is the character, FROM is the title, FROMFROM is the old holder
character_event = {
	id = toe.1000 
	
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		AND = {
			FROMFROM = { always = yes } #If there is a FROMFROM
			FROM = {
				tier = EMPEROR
				temporary = no
				is_tribal = no
				is_nomadic = no
				is_primary_holder_title = yes
			}
			is_nomadic = no
			is_tribal = no
		}
	}
	
	immediate = {
		FROM = { save_event_target_as = imperial_inefficiency_title }
		
		character_event = { id = toe.1001 days = 1 }
		
		# remove the inefficiency modifier from the former owner, if alive
		FROMFROM = {
			if = {
				limit = {
					is_alive = yes
					lower_tier_than = EMPEROR
				}
				remove_character_modifier = imperial_inefficiency_0
				remove_character_modifier = imperial_inefficiency_1
				remove_character_modifier = imperial_inefficiency_2
				remove_character_modifier = imperial_inefficiency_3
				remove_character_modifier = imperial_inefficiency_4
				remove_character_modifier = imperial_inefficiency_5
				remove_character_modifier = imperial_inefficiency_6
				remove_character_modifier = imperial_inefficiency_7
				remove_character_modifier = imperial_inefficiency_8
				remove_character_modifier = imperial_inefficiency_9
				remove_character_modifier = imperial_inefficiency_10
			}
		}
	}
}

# ROOT/FROM is the character, FROMFROM is the title, FROMFROMFROM is the old holder
character_event = {
	id = toe.1001
	
	hide_window = yes
	is_triggered_only = yes
	only_rulers = yes
	
	trigger = {
		has_landed_title = event_target:imperial_inefficiency_title
		is_nomadic = no
		is_tribal = no
	}
	
	immediate = {
		event_target:imperial_inefficiency_title = {
			
			# reset the inefficiency value to 0, in case it's negative
			if = {
				limit = { NOT = { check_variable = { which = "imperial_inefficiency" value = 0.5 } } }
				set_variable = { which = "imperial_inefficiency" value = 0 }
			}
			
			# set new ruler inefficiency to 0
			set_variable = { which = "imperial_inefficiency" value = 0 }
			
			#determine how much the realm size should change it
			if = {
				limit = { ROOT = { realm_size = 45 } } #15 counties
				change_variable = { which = "imperial_inefficiency" value = 15 }
			}
			if = {
				limit = { ROOT = { realm_size = 90 } } #30 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #20
			}
			if = {
				limit = { ROOT = { realm_size = 180 } } #60 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #25
			}
			if = {
				limit = { ROOT = { realm_size = 270 } } #90 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #30
			}
			if = {
				limit = { ROOT = { realm_size = 450 } } #150 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #35
			}
			if = {
				limit = { ROOT = { realm_size = 600 } } #200 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #40
			}
			if = {
				limit = { ROOT = { realm_size = 750 } } #250 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #45
			}
			if = {
				limit = { ROOT = { realm_size = 900 } } #300 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #50
			}
			if = {
				limit = { ROOT = { realm_size = 1050 } } #350 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #55
			}
			if = {
				limit = { ROOT = { realm_size = 1200 } } #400 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #60
			}
			if = {
				limit = { ROOT = { realm_size = 1350 } } #450 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #65
			}
			if = {
				limit = { ROOT = { realm_size = 1500 } } #500 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #70
			}
			if = {
				limit = { ROOT = { realm_size = 1650 } } #550 counties 
				change_variable = { which = "imperial_inefficiency" value = 5 } #75
			}
			if = {
				limit = { ROOT = { realm_size = 1800 } } #600 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #80
			}
			if = {
				limit = { ROOT = { realm_size = 2100 } } #700 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #85
			}
			if = {
				limit = { ROOT = { realm_size = 2400 } } #800 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #90
			}
			if = {
				limit = { ROOT = { realm_size = 2700 } } #900 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #95
			}
			if = {
				limit = { ROOT = { realm_size = 3000 } } #1000 counties
				change_variable = { which = "imperial_inefficiency" value = 3 } #98
			}
			
			#Check realm stewardship
			if = {
				limit = { NOT = { ROOT = { realm_stewardship = 10 } } }
				change_variable = { which = "imperial_inefficiency" value = 5 }
			}
			if = {
				limit = { NOT = { ROOT = { realm_stewardship = 20 } } }
				change_variable = { which = "imperial_inefficiency" value = 5 }
			}
			if = {
				limit = { NOT = { ROOT = { realm_stewardship = 30 } } }
				change_variable = { which = "imperial_inefficiency" value = 5 }
			}
			if = {
				limit = { ROOT = { realm_stewardship = 40 } }
				change_variable = { which = "imperial_inefficiency" value = -5 }
			}
			if = {
				limit = { ROOT = { realm_stewardship = 50 } }
				change_variable = { which = "imperial_inefficiency" value = -5 }
			}
			if = {
				limit = { ROOT = { realm_stewardship = 60 } }
				change_variable = { which = "imperial_inefficiency" value = -5 }
			}
			
			if = {
				limit = { check_variable = { which = "imperial_inefficiency" value = 100.5 } }
				set_variable = { which = "imperial_inefficiency" value = 100 }
			}
			if = {
				limit = { NOT = { check_variable = { which = "imperial_inefficiency" value = 0.5 } } }
				set_variable = { which = "imperial_inefficiency" value = 0 }
			}
		}
		
		# change the inefficiency modifier
		character_event = { id = toe.1002 }
		clear_event_target = imperial_inefficiency_title
	}
}

# Notification of inefficiency change and adding the proper inefficiency modifier
character_event = {
	id = toe.1002
	desc = EVTDESC_toe.1002
	picture = "GFX_evt_diplomat_hf"
	
	is_triggered_only = yes
	notification = yes
	
	immediate = {
		# remove old inefficiency modifier and add the new one
		remove_character_modifier = imperial_inefficiency_0
		remove_character_modifier = imperial_inefficiency_1
		remove_character_modifier = imperial_inefficiency_2
		remove_character_modifier = imperial_inefficiency_3
		remove_character_modifier = imperial_inefficiency_4
		remove_character_modifier = imperial_inefficiency_5
		remove_character_modifier = imperial_inefficiency_6
		remove_character_modifier = imperial_inefficiency_7
		remove_character_modifier = imperial_inefficiency_8
		remove_character_modifier = imperial_inefficiency_9
		remove_character_modifier = imperial_inefficiency_10
		if = {
			limit = {
				primary_title = {
					check_variable = { which = "imperial_inefficiency" value = 0 }
					NOT = { check_variable = { which = "imperial_inefficiency" value = 5 } }
				}
			}
			add_character_modifier = {
				name = imperial_inefficiency_0
				duration = -1
			}
		} 
		if = {
			limit = {
				primary_title = {
					check_variable = { which = "imperial_inefficiency" value = 5 }
					NOT = { check_variable = { which = "imperial_inefficiency" value = 15 } }
				}
			}
			add_character_modifier = {
				name = imperial_inefficiency_1
				duration = -1
			}
		} 
		if = {
			limit = {
				primary_title = {
					check_variable = { which = "imperial_inefficiency" value = 15 }
					NOT = { check_variable = { which = "imperial_inefficiency" value = 25 } }
				}
			}
			add_character_modifier = {
				name = imperial_inefficiency_2
				duration = -1
			}
		} 
		if = {
			limit = {
				primary_title = {
					check_variable = { which = "imperial_inefficiency" value = 25 }
					NOT = { check_variable = { which = "imperial_inefficiency" value = 35 } }
				}
			}
			add_character_modifier = {
				name = imperial_inefficiency_3
				duration = -1
			}
		} 
		if = {
			limit = {
				primary_title = {
					check_variable = { which = "imperial_inefficiency" value = 35 }
					NOT = { check_variable = { which = "imperial_inefficiency" value = 45 } }
				}
			}
			add_character_modifier = {
				name = imperial_inefficiency_4
				duration = -1
			}
		} 
		if = {
			limit = {
				primary_title = {
					check_variable = { which = "imperial_inefficiency" value = 45 }
					NOT = { check_variable = { which = "imperial_inefficiency" value = 55 } }
				}
			}
			add_character_modifier = {
				name = imperial_inefficiency_5
				duration = -1
			}
		} 
		if = {
			limit = {
				primary_title = {
					check_variable = { which = "imperial_inefficiency" value = 55 }
					NOT = { check_variable = { which = "imperial_inefficiency" value = 65 } }
				}
			}
			add_character_modifier = {
				name = imperial_inefficiency_6
				duration = -1
			}
		} 
		if = {
			limit = {
				primary_title = {
					check_variable = { which = "imperial_inefficiency" value = 65 }
					NOT = { check_variable = { which = "imperial_inefficiency" value = 75 } }
				}
			}
			add_character_modifier = {
				name = imperial_inefficiency_7
				duration = -1
			}
		} 
		if = {
			limit = {
				primary_title = {
					check_variable = { which = "imperial_inefficiency" value = 75 }
					NOT = { check_variable = { which = "imperial_inefficiency" value = 85 } }
				}
			}
			add_character_modifier = {
				name = imperial_inefficiency_8
				duration = -1
			}
		} 
		if = {
			limit = {
				primary_title = {
					check_variable = { which = "imperial_inefficiency" value = 85 }
					NOT = { check_variable = { which = "imperial_inefficiency" value = 95 } }
				}
			}
			add_character_modifier = {
				name = imperial_inefficiency_9
				duration = -1
			}
		} 
		if = {
			limit = {
				primary_title = {
					check_variable = { which = "imperial_inefficiency" value = 95 }
				}
			}
			add_character_modifier = {
				name = imperial_inefficiency_10
				duration = -1
			}
		} 
	}
	
	option = {
		name = "OK"
	}
}

###Setup inefficiencies at startup



#Inefficiency for titles on startup

character_event = {
	id = toe.1003
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		OR = {
			ROOT = {
				primary_title = {
					tier = EMPEROR
					temporary = no
				}
				is_nomadic = no
				is_tribal = no
			}
			FROM = {
				primary_title = {
					tier = EMPEROR
					temporary = no
				}
				is_nomadic = no
				is_tribal = no
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				primary_title = {
					tier = EMPEROR
					temporary = no
				}
				is_nomadic = no
				is_tribal = no
			}
			primary_title = { save_event_target_as = imperial_inefficiency_title }
			character_event = { id = toe.1004 days = 1 }
		}
		if = {
			limit = {
				FROM = {
					primary_title = {
						tier = EMPEROR
						temporary = no
					}
					is_nomadic = no
					is_tribal = no
				}
			}
			FROM = {
				primary_title = { save_event_target_as = imperial_inefficiency_title }
				character_event = { id = toe.1004 days = 1 }
			}
		}
	}
}


character_event = {
	id = toe.1004
	
	hide_window = yes
	is_triggered_only = yes
	only_rulers = yes
	
	trigger = {
		has_landed_title = event_target:imperial_inefficiency_title
		is_nomadic = no
		is_tribal = no
	}
	
	immediate = {
		event_target:imperial_inefficiency_title = {
			
			# reset the inefficiency value to 0, in case it's negative
			if = {
				limit = { NOT = { check_variable = { which = "imperial_inefficiency" value = 0.5 } } }
				set_variable = { which = "imperial_inefficiency" value = 0 }
			}
			
			# set new ruler inefficiency to 0
			set_variable = { which = "imperial_inefficiency" value = 0 }
			
			#determine how much the realm size should change it
			if = {
				limit = { ROOT = { realm_size = 50 } } #17 counties
				change_variable = { which = "imperial_inefficiency" value = 25 }
			}
			if = {
				limit = { ROOT = { realm_size = 90 } } #30 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #30
			}
			if = {
				limit = { ROOT = { realm_size = 120 } } #40 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #35
			}
			if = {
				limit = { ROOT = { realm_size = 150 } } #50 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #40
			}
			if = {
				limit = { ROOT = { realm_size = 180 } } #60 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #45
			}
			if = {
				limit = { ROOT = { realm_size = 225 } } #75 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #50
			}
			if = {
				limit = { ROOT = { realm_size = 270 } } #90 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #55
			}
			if = {
				limit = { ROOT = { realm_size = 300 } } #100 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #60
			}
			if = {
				limit = { ROOT = { realm_size = 330 } } #110 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #65
			}
			if = {
				limit = { ROOT = { realm_size = 375 } } #125 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #70
			}
			if = {
				limit = { ROOT = { realm_size = 420 } } #140 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #75
			}
			if = {
				limit = { ROOT = { realm_size = 450 } } #150 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #80
			}
			if = {
				limit = { ROOT = { realm_size = 600 } } #200 counties
				change_variable = { which = "imperial_inefficiency" value = 10 } #90
			}
			if = {
				limit = { ROOT = { realm_size = 750 } } #250 counties
				change_variable = { which = "imperial_inefficiency" value = 5 } #95
			}
			if = {
				limit = { ROOT = { realm_size = 900 } } #300 counties
				change_variable = { which = "imperial_inefficiency" value = 3 } #98
			}
			
			#Check realm stewardship
			if = {
				limit = { NOT = { ROOT = { realm_stewardship = 10 } } }
				change_variable = { which = "imperial_inefficiency" value = 5 }
			}
			if = {
				limit = { NOT = { ROOT = { realm_stewardship = 20 } } }
				change_variable = { which = "imperial_inefficiency" value = 5 }
			}
			if = {
				limit = { NOT = { ROOT = { realm_stewardship = 30 } } }
				change_variable = { which = "imperial_inefficiency" value = 5 }
			}
			if = {
				limit = { ROOT = { realm_stewardship = 40 } }
				change_variable = { which = "imperial_inefficiency" value = -5 }
			}
			if = {
				limit = { ROOT = { realm_stewardship = 50 } }
				change_variable = { which = "imperial_inefficiency" value = -5 }
			}
			if = {
				limit = { ROOT = { realm_stewardship = 60 } }
				change_variable = { which = "imperial_inefficiency" value = -5 }
			}
			
			###Put any more startups here for the special councillors 
			
			if = {
				limit = { check_variable = { which = "imperial_inefficiency" value = 100.5 } }
				set_variable = { which = "imperial_inefficiency" value = 100 }
			}
			if = {
				limit = { NOT = { check_variable = { which = "imperial_inefficiency" value = 0.5 } } }
				set_variable = { which = "imperial_inefficiency" value = 0 }
			}		
		}
		
		# change the inefficiency modifier
		character_event = { id = toe.1002 }
		clear_event_target = imperial_inefficiency_title
	}
}