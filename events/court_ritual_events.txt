namespace = toe

#Ritual grows over time
character_event = {
	id = toe.1600
	desc = EVTDESC_toe.1600
	picture = "GFX_evt_throne_room"
	trigger = {
		primary_title = {
			tier = EMPEROR
			temporary = no
			is_tribal = no
			is_nomadic = no
			NOT = { has_law = succ_feudal_elective }
			NOT = { has_law = succ_hre_elective }
		}
	}
	
	mean_time_to_happen = {
		years = 40
		modifier = {
			factor = 0.5
			is_adult = no
		}
		modifier = {
			factor = 2
			primary_title = {
				OR = {
					has_law = succ_elective_gavelkind
					has_law = succ_tanistry
				}
			}
		}
		modifier = {
			factor = 0.5
			trait = slothful
		}
		modifier = {
			factor = 0.75
			trait = trusting
		}
		modifier = {
			factor = 0.75
			OR = {
				trait = shy
				trait = gregarious
			}
		}
		modifier = {
			factor = 1.33
			trait = envious
		}
		modifier = {
			factor = 0.75
			trait = kind
		}
		modifier = {
			factor = 0.5
			trait = content
		}
		modifier = {
			factor = 2
			trait = ambitious
		}
	}
	
	immediate = {
		if = {
			limit = {
				primary_title = {
					has_title_flag = toe_title_6
				}
			}
			primary_title = {
				set_title_flag = toe_title_7
				clr_title_flag = toe_title_6
			}
			add_character_modifier = { 
				name = court_ritual_losses_7
				duration = -1
			}
			remove_character_modifier = court_ritual_losses_6
		}
		if = {
			limit = {
				primary_title = {
					has_title_flag = toe_title_5
				}
			}
			primary_title = {
				set_title_flag = toe_title_6
				clr_title_flag = toe_title_5
			}
			add_character_modifier = { 
				name = court_ritual_losses_6
				duration = -1
			}
			remove_character_modifier = court_ritual_losses_5
		}
		if = {
			limit = {
				primary_title = {
					has_title_flag = toe_title_4
				}
			}
			primary_title = {
				set_title_flag = toe_title_5
				clr_title_flag = toe_title_4
			}
			add_character_modifier = { 
				name = court_ritual_losses_5
				duration = -1
			}
			remove_character_modifier = court_ritual_losses_4
		}
		if = {
			limit = {
				primary_title = {
					has_title_flag = toe_title_3
				}
			}
			primary_title = {
				set_title_flag = toe_title_4
				clr_title_flag = toe_title_3
			}
			add_character_modifier = { 
				name = court_ritual_losses_4
				duration = -1
			}
			remove_character_modifier = court_ritual_losses_3
		}
		if = {
			limit = {
				primary_title = {
					has_title_flag = toe_title_2
				}
			}
			primary_title = {
				set_title_flag = toe_title_3
				clr_title_flag = toe_title_2
			}
			add_character_modifier = { 
				name = court_ritual_losses_3
				duration = -1
			}
			remove_character_modifier = court_ritual_losses_2
		}
		if = {
			limit = {
				primary_title = {
					has_title_flag = toe_title_1
				}
			}
			primary_title = {
				set_title_flag = toe_title_2
				clr_title_flag = toe_title_1
			}
			add_character_modifier = { 
				name = court_ritual_losses_2
				duration = -1
			}
			remove_character_modifier = court_ritual_losses_1
		}
		else_if = {
			limit = {
				primary_title = {
					NOR = {
						has_title_flag = toe_title_1
						has_title_flag = toe_title_2
						has_title_flag = toe_title_3
						has_title_flag = toe_title_4
						has_title_flag = toe_title_5
						has_title_flag = toe_title_6
						has_title_flag = toe_title_7
					}
				}
			}
			primary_title = {
				set_title_flag = toe_title_1
			}
			add_character_modifier = { 
				name = court_ritual_losses_1
				duration = -1
			}
		}
	}
	
	option = {
		name = EVTOPTA_toe.1600 #I see
	}
}

#Cut in front of other councilor
character_event = {
	id = toe.1601
	desc = EVTDESC_toe.1601
	picture = "GFX_evt_church_council"
	trigger = {
		is_voter = yes
		prisoner = no
		liege = {
			primary_title = {
				tier = EMPEROR
				temporary = no
				is_tribal = no
				is_nomadic = no
				prisoner = no
			}
		}
	}
	
	mean_time_to_happen = {
		years = 12
		modifier = {
			factor = 0.17
			ai = no
		}
	}
	
	immediate = {
		liege = {
			random_voter = {
				limit = {
					NOT = { character = ROOT }
					NOT = { trait = incapable }
					prisoner = no
				}
				save_event_target_as = courtier_antagonist
			}
		}
	}
	
	option = {
		name = EVTOPTA_toe.1601 #Pass in front?
		ai_chance = {
			factor = 25
			modifier = {
				factor = 1.33
				trait = just
			}
			modifier = {
				factor = 1.33
				trait = diligent
			}
			modifier = {
				factor = 1.33
				trait = gregarious
			}
			modifier = {
				factor = 1.33
				trait = paranoid
			}
		}
		liege = { character_event = { id = toe.1602 }} #How does the emperor react? 
	}
	option = {
		name = EVTOPTB_toe.1601 #Better not
		ai_chance = {
			factor = 25
			modifier = {
				factor = 1.33
				trait = just
			}
			modifier = {
				factor = 1.33
				trait = diligent
			}
			modifier = {
				factor = 1.33
				trait = gregarious
			}
			modifier = {
				factor = 1.33
				trait = paranoid
			}
		}
	}
}

#Emperor reaction
character_event = {
	id = toe.1602
	desc = EVTDESC_toe.1602
	picture = "GFX_evt_church_council"
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_toe.1602 #Approve?
		ai_chance = {
			factor = 75
			modifier = {
				factor = 1.33
				trait = arbitrary
			}
			modifier = {
				factor = 1.33
				trait = slothful
			}
			modifier = {
				factor = 1.33
				trait = content
			}
			modifier = {
				factor = 1.33
				trait = shy
			}
			modifier = {
				factor = 1.33
				trait = trusting
			}
		}
		FROM = { character_event = { id = toe.1603 }} #Tell pusher
		event_target:courtier_antagonist = { character_event = { id = toe.1604 }} #Tell pushee
	}
	option = {
		name = EVTOPTB_toe.1602 #Disapprove?
		ai_chance = {
			factor = 25
			modifier = {
				factor = 1.33
				trait = just
			}
			modifier = {
				factor = 1.33
				trait = diligent
			}
			modifier = {
				factor = 1.33
				trait = gregarious
			}
			modifier = {
				factor = 1.33
				trait = paranoid
			}
		}
		FROM = { character_event = { id = toe.1605 }} #Tell pusher 
		event_target:courtier_antagonist = { character_event = { id = toe.1606 }} #Tell pushee
	}
}

#Pusher success
character_event = {
	id = toe.1603
	desc = EVTDESC_toe.1603
	picture = "GFX_evt_throne_room"
	is_triggered_only = yes
	
	immediate = {
		opinion = {
			modifier = opinion_defended_me
			years = 5
			who = FROM
		}
		FROM = {
			opinion = {
				modifier = opinion_emperor_attention
				years = 5
				who = ROOT
			}
		}
		event_target:courtier_antagonist = {
			opinion = {
				modifier = resentful_of_my_behaviour
				years = 5
				who = ROOT
			}
		}
	}
	
	option = {
		name = EVTOPTA_toe.1603 #Woo
	}
}

#Pushee failure
character_event = {
	id = toe.1604
	desc = EVTDESC_toe.1604
	picture = "GFX_evt_throne_room"
	is_triggered_only = yes
	
	immediate = {
		opinion = {
			modifier = opinion_disappointed
			years = 5
			who = FROM
		}
		FROM = {
			opinion = {
				modifier = opinion_emperor_neglect
				years = 5
				who = ROOT
			}
		}
	}
	
	option = {
		name = EVTOPTA_toe.1604 #Crap
	}
}

#Pusher failure
character_event = {
	id = toe.1605
	desc = EVTDESC_toe.1605
	picture = "GFX_evt_throne_room"
	is_triggered_only = yes
	
	immediate = {
		opinion = {
			modifier = opinion_disappointed
			years = 5
			who = FROM
		}
		FROM = {
			opinion = {
				modifier = opinion_unconvinced
				years = 5
				who = ROOT
			}
		}
		event_target:courtier_antagonist = {
			opinion = {
				modifier = resentful_of_my_behaviour
				years = 5
				who = ROOT
			}
		}
	}
	
	option = {
		name = EVTOPTA_toe.1605 #Crap
	}
}

#Pushee success
character_event = {
	id = toe.1606
	desc = EVTDESC_toe.1606
	picture = "GFX_evt_throne_room"
	is_triggered_only = yes
	
	immediate = {
		opinion = {
			modifier = opinion_defended_me
			years = 5
			who = FROM
		}
	}
	
	option = {
		name = EVTOPTA_toe.1606 #Woo
	}
}

#Sleep with emperor for a favor
character_event = {
	id = toe.1607
	desc = EVTDESC_toe.1607
	picture = "GFX_evt_fancy_feast"
	trigger = {
		is_voter = yes
		prisoner = no
		liege = {
			primary_title = {
				tier = EMPEROR
				temporary = no
				is_tribal = no
				is_nomadic = no
				prisoner = no
			}
			trait = lustful
			NOT = { is_lover = ROOT }
			NOT = { is_former_lover = ROOT }
			NOT = { owes_favor_to = ROOT }
		}
		OR = {
			AND = {
				liege = { 
					trait = homosexual
					same_sex = ROOT
				}
				trait = homosexual
			}
			liege = { 
				NOT = { trait = homosexual }
				same_sex = ROOT
			}
		}
		NOT = { trait = chaste }
	}
	
	mean_time_to_happen = {
		years = 10
		modifier = {
			ai = yes
			factor = 7
		}
	}
	
	option = {
		name = EVTOPTA_toe.1607 #Try?
		liege = { character_event = { id = toe.1608 }} #How does the emperor react? 
	}
	option = {
		name = EVTOPTB_toe.1607 #Better not
	}
}

#Emperor reacts
character_event = {
	id = toe.1608
	desc = "GFX_evt_whispers"
	picture = GFX_evt_council
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_toe.1608 #Sure
		FROM = { character_event = { id = toe.1609 }} 
	}
	option = {
		name = EVTOPTB_toe.1608 #No
		FROM = { character_event = { id = toe.1610 }} 
	}
}

#Success
character_event = {
	id = toe.1609
	desc = EVTDESC_toe.1609
	picture = "GFX_evt_dark_love"
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { has_dlc = "Zeus" }
			add_favor = FROM
		}
	}
	
	option = {
		name = EVTOPTA_toe.1609 #Yay
		add_lover = FROM
	}
}

#Failure
character_event = {
	id = toe.1610
	desc = "GFX_evt_bad_news"
	picture = GFX_evt_council
	is_triggered_only = yes
	
	immediate = {
		opinion = {
			modifier = opinion_seduced_refused
			years = 5
			who = FROM
		}
		FROM = {
			opinion = {
				modifier = opinion_seduced_repelled
				years = 5
				who = ROOT
			}
		}
	}
	
	option = {
		name = EVTOPTA_toe.1610 #Boo
	}
}

#Offer other councillor attention
character_event = {
	id = toe.1611
	desc = EVTDESC_toe.1611
	picture = "GFX_evt_suspicious_noble"
	trigger = {
		is_voter = yes
		liege = {
			primary_title = {
				tier = EMPEROR
				temporary = no
				is_tribal = no
				is_nomadic = no
			}
			any_voter = {
				NOT = { character = ROOT }
				NOT = { owes_favor_to = ROOT }
				ai = yes
			}
		}
		has_dlc = "Zeus"
	}
	
	mean_time_to_happen = {
		years = 12
		modifier = {
			factor = 0.17
			ai = no
		}
	}
	
	immediate = {
		liege = {
			random_voter = {
				limit = {
					NOT = { character = ROOT }
					NOT = { owes_favor_to = ROOT }
					ai = yes
				}
				save_event_target_as = visibility_courtier
			}
			save_event_target_as = visibility_emperor
		}
		
	}
	
	option = {
		name = EVTOPTA_toe.1611 #Offer? 
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1.33
				trait = humble
			}
			modifier = {
				factor = 1.33
				trait = charitable
			}
			modifier = {
				factor = 1.33
				trait = ambitious
			}
			modifier = {
				factor = 1.33
				trait = trusting
			}
		}
		event_target:visibility_emperor = {
			opinion = {
				modifier = opinion_emperor_attention
				years = 5
				who = event_target:visibility_courtier
			}
		}
		event_target:visibility_emperor = {
			opinion = {
				modifier = opinion_emperor_neglect
				years = 5
				who = ROOT
			}
		}
		add_favor = event_target:visibility_courtier
	}
	option = {
		name = EVTOPTB_toe.1611 #Better not
		ai_chance = {
			factor = 25
			modifier = {
				factor = 1.33
				trait = envious
			}
			modifier = {
				factor = 1.33
				trait = greedy
			}
			modifier = {
				factor = 1.33
				trait = content
			}
			modifier = {
				factor = 1.33
				trait = paranoid
			}
		}
	}
}