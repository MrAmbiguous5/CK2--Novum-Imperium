
#0-99 generic missions 
#100-199 seneschal/stewardship
#200-299 marshal/martial
#300-399 lawkeeper/diplomacy
#400-499 spymaster/intrigue

namespace = ipcq


############Generic############

###generic tombola, rank 3 members assign to lower
character_event = {
	id = ipcq.000
	
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		is_imperial_court_member_trigger = yes
		society_rank == 3
		NOT = { has_character_modifier = ipc_random_mission_timer }
	}
	
	weight_multiplier = {
		days = 1
		
		modifier = {
			factor = 0.5
			OR = {
				war = yes
				liege = { war = yes }
			}
		}
		modifier = {
			factor = 0.8
			is_ill = yes
		}
	}
	
	
	immediate = {
		random_list = {
		
			#undermine other rank 3 member
			10 = {
				trigger = {
					society = {
						any_society_member = {
							NOT = { character = ROOT }
							society_rank == 3
							is_quest_target = no
							OR = {
								is_foe = ROOT
								ROOT = { is_foe = PREV }
								NOT = { ROOT = { opinion = { who = PREV value = 10 } } }
							}
							society = {
								any_society_member = {
									society_rank < 3
									has_any_quest = no
									NOT = { has_character_modifier = quest_cooldown_timer }
									OR = {
										is_foe = PREVPREV
										PREVPREV = { is_foe = THIS }
										NOT = { opinion = { who = PREVPREV value = 10 } }
									}
								}
							}
						}
					}
				}
				society = {
					random_society_member = {
						limit = {
							NOT = { character = ROOT }
							society_rank == 3
							is_quest_target = no
							NOT = { ROOT = { opinion = { who = PREV value = 10 } } }
						}
						preferred_limit = { 
							OR = {
								is_foe = ROOT
								ROOT = { is_foe = PREV }
							}
						}
						save_event_target_as = undermined_member
						
						society = {
							random_society_member = {
								limit = {
									society_rank < 3
									has_any_quest = no
									NOT = { has_character_modifier = quest_cooldown_timer }
									NOT = { opinion = { who = event_target:undermined_member value = 10 } }
								}
								preferred_limit = { 
									OR = {
										is_foe = event_target:undermined_member
										event_target:undermined_member = { is_foe = THIS }
									}
								}
								save_event_target_as = underminer_mission_candidate_1
							}
							random_society_member = {
								limit = {
									NOT = { character = event_target:underminer_mission_candidate_1 }
									society_rank < 3
									has_any_quest = no
									NOT = { has_character_modifier = quest_cooldown_timer }
									NOT = { opinion = { who = event_target:undermined_member value = 10 } }
								}
								preferred_limit = { 
									OR = {
										is_foe = event_target:undermined_member
										event_target:undermined_member = { is_foe = THIS }
									}
								}
								save_event_target_as = underminer_mission_candidate_2
							}
							random_society_member = {
								limit = {
									NOR = { 
										character = event_target:underminer_mission_candidate_1 
										character = event_target:underminer_mission_candidate_2
									}
									society_rank < 3
									has_any_quest = no
									NOT = { has_character_modifier = quest_cooldown_timer }
									NOT = { opinion = { who = event_target:undermined_member value = 10 } }
								}
								preferred_limit = { 
									OR = {
										is_foe = event_target:undermined_member
										event_target:undermined_member = { is_foe = THIS }
									}
								}
								save_event_target_as = underminer_mission_candidate_3
							}
						}
					}
				}
				add_character_modifier = { modifier = ipc_random_mission_timer years = 5 hidden = yes }
				save_event_target_as = mission_giver
				event_target:undermined_member = { character_event = { id = ipcq.001 } }
			}
			
			
			#attempt to gain imperial office with help
			#10 = {}
			
			
			#nothing
			100 = {}
			
			
			
		}
	
	}
}


###undermine other rank 3 member, ping from target to issuer
character_event = {
	id = ipcq.001
	
	hide_window = yes
	is_triggered_only = yes
	
	immediate = { FROM = { character_event = { id = ipcq.002 } } }
}


###issue mission?
character_event = {
	id = ipcq.002
	desc = EVTDESAipcq.002
	picture = GFX_evt_state_diplomacy
	
	is_triggered_only = yes
	
	#pick 1st candidate
	option = {
		name = EVTOPTAipcq.002
		event_target:underminer_mission_candidate_1 = { 
			custom_tooltip = {
				text = EVTTOOLTIPAipcq.002
				society_quest_event = { id = ipcq.003 days = 1 }
			}
		}
	}
	
	#pick 2nd candidate
	option = {
		trigger = { event_target:underminer_mission_candidate_2 = { always = yes } }
		name = EVTOPTBipcq.002
		event_target:underminer_mission_candidate_2 = { 
			custom_tooltip = {
				text = EVTTOOLTIPBipcq.002
				society_quest_event = { id = ipcq.003 days = 1 }
			}
		}
	}
	
	
	#pick 3rd candidate
	option = {
		trigger = { event_target:underminer_mission_candidate_3 = { always = yes } }
		name = EVTOPTCipcq.002
		event_target:underminer_mission_candidate_3 = { 
			custom_tooltip = {
				text = EVTTOOLTIPCipcq.002
				society_quest_event = { id = ipcq.003 days = 1 }
			}
		}
	}
	
	
	#no
	option = {
		name = EVTOPTDipcq.002
	}
	
	
}

##quest window
society_quest_event = {
	id = ipcq.003
	desc = EVTDESAipcq.003
	
	is_triggered_only = yes
	is_in_society = yes
	
	trigger = {
		is_imperial_court_member_trigger = yes
		has_any_quest = no
	}
	
	quest_target = event_target:undermined_member
	
	option = {
		name = ACCEPT
		event_target:undermined_member = {
			set_quest_target = {
				id = quest_ipc_undermine_member
				holder = ROOT
			}
		}
		hidden_tooltip = { character_event = { id = ipcq.005 days = 30 } }
		ai_chance = { 
			factor = 50
			modifier = { 
				factor = 1.5
				trait = envious
			}
			modifier = { 
				factor = 1.5
				trait = deceitful
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:undermined_member value = 5 } }
			}
			modifier = {
				factor = 1.5
				OR = {
					is_foe = event_target:undermined_member
					event_target:undermined_member = { is_foe = ROOT }
				}
			}
		}
	}
	
	option  = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }
		
		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			years = 5
		}
		hidden_tooltip = { FROM = { letter_event = { id = ipcq.004 days = 1 } } }
		ai_chance = { 
			factor = 25
			modifier = {
				factor = 1.25
				opinion = { who = event_target:undermined_member value = 25 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = event_target:undermined_member value = 50 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = event_target:undermined_member value = 75 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = event_target:undermined_member value = 100 }
			}
			modifier = {
				factor = 1.5
				event_target:undermined_member = { dynasty = ROOT }
				opinion = { who = event_target:undermined_member value = 5 }
				NOT = { FROM = { dynasty = ROOT } }
			}
			modifier = {
				factor = 1.25
				trait = kind
			}
			modifier = {
				factor = 1.25
				trait = just
			}
		}
	}
}

letter_event = {
	id = ipcq.004
	desc = EVTDESAipcq.004
	
	is_triggered_only = yes
	
	option = { 
		name = EVTOPTAipcq.004
		reverse_opinion = { modifier = opinion_disapprove who = FROM years = 5 }
		hidden_tooltip = { remove_character_modifier = ipc_random_mission_timer }
	}
}


##choose method
character_event = {
	id = ipcq.005
	desc = EVTDESAipcq.005
	picture = GFX_evt_noble_in_castle
	
	is_triggered_only = yes
	
	immediate = {
		clear_event_target = underminer_mission_candidate_1
		clear_event_target = underminer_mission_candidate_2
		clear_event_target = underminer_mission_candidate_3
		save_event_target_as = underminer_mission_accomplice
	}
	
	#pay servent to throw away notes
	option = {
		name = EVTOPTAipcq.005
		custom_tooltip = {
			text = EVTTOOLTIPAipcq.005
			set_character_flag = mission_diplomacy_route
		}
	}
	
	#sabotage something to lure way during meeting
	option = {
		name = EVTOPTBipcq.005
		custom_tooltip = {
			text = EVTTOOLTIPBipcq.005
			set_character_flag = mission_intrigue_route
		}
	}
	
	#write counter arguements
	option = {
		name = EVTOPTCipcq.005
		custom_tooltip = {
			text = EVTTOOLTIPCipcq.005
			set_character_flag = mission_learning_route
		}
	}
	
	after = {
		hidden_tooltip = { character_event = { id = ipcq.006 days = 30 random = 10 } }
	}
}

##continue plan
character_event = {
	id = ipcq.006
	desc = {
		trigger = { has_character_flag = mission_diplomacy_route }
		text = EVTDESAipcq.006
	}
	desc = {
		trigger = { has_character_flag = mission_intrigue_route }
		text = EVTDESAipcq.006
		picture = GFX_evt_arson_hf
	}
	desc = {
		trigger = { has_character_flag = mission_learning_route }
		text = EVTDESAipcq.006
	}
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	#diplo
	option = {
		trigger = { has_character_flag = mission_diplomacy_route }
		name = EVTOPTAipcq.006
		hidden_tooltip = {
			random_list = {
				#success
				50 = {
					modifier = {
						factor = 1.1
						trait = naive_appeaser
					}
					modifier = {
						factor = 1.2
						trait = underhanded_rogue
					}
					modifier = {
						factor = 1.3
						trait = charismatic_negotiator
					}
					modifier = {
						factor = 1.4
						trait = grey_eminence
					}
					modifier = {
						factor = 1.1
						diplomacy = 4
					}
					modifier = {
						factor = 1.1
						diplomacy = 6
					}
					modifier = {
						factor = 1.1
						diplomacy = 8
					}
					modifier = {
						factor = 1.2
						diplomacy = 10
					}
					modifier = {
						factor = 1.1
						diplomacy = 12
					}
					modifier = {
						factor = 1.1
						diplomacy = 14
					}
					modifier = {
						factor = 1.1
						diplomacy = 16
					}
					modifier = {
						factor = 1.2
						diplomacy = 18
					}
					modifier = {
						factor = 1.3
						diplomacy = 20
					}
					modifier = {
						factor = 1.25
						trait = quick
					}
					modifier = {
						factor = 1.5
						trait = genius
					}
					modifier = {
						factor = 1.25
						trait = shrewd
					}
					modifier = {
						factor = 1.25
						trait = fair
					}
					modifier = {
						factor = 1.25
						OR = {
							trait = seducer
							trait = seductress
						}
					}
					modifier = {
						factor = 1.25
						trait = socializer
					}
					modifier = {
						factor = 1.25
						trait = gregarious
					}
					set_character_flag = mission_success
				}
				
				#failure
				50 = {
					modifier = {
						factor = 1.25
						has_education_diplomacy_trigger = no
					}
					modifier = {
						factor = 1.5
						NOT = { diplomacy = 2 }
					}
					modifier = {
						factor = 2
						NOT = { diplomacy = 4 }
					}
					modifier = {
						factor = 1.25
						trait = slow
					}
					modifier = {
						factor = 1.5
						trait = imbecile
					}
					modifier = {
						factor = 1.25
						trait = dull
					}
					modifier = {
						factor = 1.25
						trait = drunkard
					}
					modifier = {
						factor = 1.25
						trait = ugly
					}
					modifier = {
						factor = 1.25
						trait = stutter
					}
					modifier = {
						factor = 1.25
						trait = lisp
					}
					modifier = {
						factor = 1.25
						trait = stubborn
					}
					modifier = {
						factor = 1.25
						trait = shy
					}
					set_character_flag = mission_failure
				}
			}
		}
		
	}
	
	#intrigue
	option = {
		trigger = { has_character_flag = mission_intrigue_route }
		name = EVTOPTBipcq.006
		hidden_tooltip = {
			random_list = {
				#success
				50 = {
					modifier = {
						factor = 1.1
						trait = amateurish_plotter
					}
					modifier = {
						factor = 1.2
						trait = flamboyant_schemer
					}
					modifier = {
						factor = 1.3
						trait = intricate_webweaver
					}
					modifier = {
						factor = 1.4
						trait = elusive_shadow
					}
					modifier = {
						factor = 1.1
						intrigue = 4
					}
					modifier = {
						factor = 1.1
						intrigue = 6
					}
					modifier = {
						factor = 1.1
						intrigue = 8
					}
					modifier = {
						factor = 1.2
						intrigue = 10
					}
					modifier = {
						factor = 1.1
						intrigue = 12
					}
					modifier = {
						factor = 1.1
						intrigue = 14
					}
					modifier = {
						factor = 1.1
						intrigue = 16
					}
					modifier = {
						factor = 1.2
						intrigue = 18
					}
					modifier = {
						factor = 1.3
						intrigue = 20
					}
					modifier = {
						factor = 1.25
						trait = quick
					}
					modifier = {
						factor = 1.5
						trait = genius
					}
					modifier = {
						factor = 1.25
						trait = shrewd
					}
					modifier = {
						factor = 1.25
						trait = architect
					}
					modifier = {
						factor = 1.25
						trait = schemer
					}
					modifier = {
						factor = 1.25
						trait = strategist
					}
					modifier = {
						factor = 1.25
						trait = deceitful
					}
					set_character_flag = mission_success
				}
				
				#failure
				50 = {
					modifier = {
						factor = 1.25
						has_education_intrigue_trigger = no
					}
					modifier = {
						factor = 1.5
						NOT = { intrigue = 2 }
					}
					modifier = {
						factor = 2
						NOT = { intrigue = 4 }
					}
					modifier = {
						factor = 1.25
						trait = slow
					}
					modifier = {
						factor = 1.5
						trait = imbecile
					}
					modifier = {
						factor = 1.25
						trait = dull
					}
					modifier = {
						factor = 1.25
						trait = drunkard
					}
					modifier = {
						factor = 1.25
						trait = kind
					}
					modifier = {
						factor = 1.25
						trait = craven
					}
					modifier = {
						factor = 1.25
						trait = trusting
					}
					modifier = {
						factor = 1.25
						trait = honest
					}
					set_character_flag = mission_failure
				}
			}
		}
	}
	
	#learning
	option = {
		trigger = { has_character_flag = mission_learning_route }
		name = EVTOPTCipcq.006
		hidden_tooltip = {
			random_list = {
				#success
				50 = {
					modifier = {
						factor = 1.1
						trait = detached_priest
					}
					modifier = {
						factor = 1.2
						trait = martial_cleric
					}
					modifier = {
						factor = 1.3
						trait = scholarly_theologian
					}
					modifier = {
						factor = 1.4
						trait = mastermind_theologian
					}
					modifier = {
						factor = 1.1
						learning = 4
					}
					modifier = {
						factor = 1.1
						learning = 6
					}
					modifier = {
						factor = 1.1
						learning = 8
					}
					modifier = {
						factor = 1.2
						learning = 10
					}
					modifier = {
						factor = 1.1
						learning = 12
					}
					modifier = {
						factor = 1.1
						learning = 14
					}
					modifier = {
						factor = 1.1
						learning = 16
					}
					modifier = {
						factor = 1.2
						learning = 18
					}
					modifier = {
						factor = 1.3
						learning = 20
					}
					modifier = {
						factor = 1.25
						trait = quick
					}
					modifier = {
						factor = 1.5
						trait = genius
					}
					modifier = {
						factor = 1.25
						trait = shrewd
					}
					modifier = {
						factor = 1.25
						trait = scholar
					}
					modifier = {
						factor = 1.25
						trait = erudite
					}
					modifier = {
						factor = 1.25
						trait = faqih
					}
					set_character_flag = mission_success
				}
				
				#failure
				50 = {
					modifier = {
						factor = 1.25
						has_education_learning_trigger = no
					}
					modifier = {
						factor = 1.5
						NOT = { learning = 2 }
					}
					modifier = {
						factor = 2
						NOT = { learning = 4 }
					}
					modifier = {
						factor = 1.25
						trait = slow
					}
					modifier = {
						factor = 1.5
						trait = imbecile
					}
					modifier = {
						factor = 1.25
						trait = dull
					}
					modifier = {
						factor = 1.25
						trait = drunkard
					}
					modifier = {
						factor = 1.25
						trait = hedonist
					}
					modifier = {
						factor = 1.25
						trait = slothful
					}
					modifier = {
						factor = 1.25
						trait = arbitrary
					}
					set_character_flag = mission_failure
				}
			}
		}
	}
	
	after = {
		if = {
			limit = { has_character_flag = mission_success }
			character_event = { id = ipcq.007 days = 40 random = 10 }
		}
		else = {
			character_event = { id = ipcq.010 days = 40 random = 10 }
		}
	}
}

##success
character_event = {
	id = ipcq.007
	desc = {
		trigger = { has_character_flag = mission_diplomacy_route }
		text = EVTDESAipcq.007
		picture = GFX_evt_experiments_failed
	}
	desc = {
		trigger = { has_character_flag = mission_intrigue_route }
		text = EVTDESBipcq.007
		picture = GFX_evt_burning_house
	}
	desc = {
		trigger = { has_character_flag = mission_learning_route }
		text = EVTDESCipcq.007
		picture = GFX_evt_gathering_of_minds
	}
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = {
		name = {
			trigger = { has_character_flag = mission_diplomacy_route }
			text = EVTOPTAipcq.007
		}
		name = {
			trigger = { has_character_flag = mission_intrigue_route }
			text = EVTOPTBipcq.007
		}
		name = {
			trigger = { has_character_flag = mission_learning_route }
			text = EVTOPTCipcq.007
		}
		change_society_currency = 200
		clr_quest = quest_ipc_undermine_member
		hidden_tooltip = {
			event_target:mission_giver = { letter_event = { id = ipcq.008 days = 5 } }
			event_target:undermined_member = { character_event = { id = ipcq.009 days = 12 random = 2 } } 
		}
	}
}

##notify mission giver
letter_event = {
	id = ipcq.008
	desc = EVTDESAipcq.008
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAipcq.008
		opinion = { who = FROM modifier = opinion_pleased years = 5 }
	}
}


##notify target
character_event = {
	id = ipcq.009
	desc = {
		trigger = { FROM = { has_character_flag = mission_diplomacy_route } }
		text = EVTDESAipcq.009
		picture = GFX_evt_experiments_failed
	}
	desc = {
		trigger = { FROM = { has_character_flag = mission_intrigue_route } }
		text = EVTDESBipcq.009
		picture = GFX_evt_burning_house
	}
	desc = {
		trigger = { FROM = { has_character_flag = mission_learning_route } }
		text = EVTDESCipcq.009
		picture = GFX_evt_gathering_of_minds
	}
	picture = GFX_evt_council
	
	is_triggered_only = yes
	hide_from = yes
	
	option = {
		trigger = { FROM = { has_character_flag = mission_diplomacy_route } }
		name = EVTOPTAipcq.009
		change_society_currency = -50
		prestige = -25
	}
	option = {
		trigger = { FROM = { has_character_flag = mission_intrigue_route } }
		name = EVTOPTBipcq.009
		change_society_currency = -50
		scaled_wealth = -0.02
	}
	option = {
		trigger = { FROM = { has_character_flag = mission_learning_route } }
		name = EVTOPTCipcq.009
		change_society_currency = -50
		prestige = -25
	}
	after = {
		hidden_tooltip = {
			event_target:underminer_mission_accomplice = {
				clr_character_flag = mission_diplomacy_route
				clr_character_flag = mission_intrigue_route
				clr_character_flag = mission_learning_route
			}
		}
	}
}



##failure
character_event = {
	id = ipcq.010
	desc = {
		trigger = { has_character_flag = mission_diplomacy_route }
		text = EVTDESAipcq.010
		picture = GFX_evt_experiments_failed
	}
	desc = {
		trigger = { has_character_flag = mission_intrigue_route }
		text = EVTDESBipcq.010
		picture = GFX_evt_burning_house
	}
	desc = {
		trigger = { has_character_flag = mission_learning_route }
		text = EVTDESCipcq.010
		picture = GFX_evt_gathering_of_minds
	}
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAipcq.010
		clr_quest = {
			id = quest_ipc_undermine_member
			failure = yes
		}
		hidden_tooltip = { event_target:mission_giver = { letter_event = { id = ipcq.011 days = 5 } } }
	}
}

##notify mission giver of failure
letter_event = {
	id = ipcq.011
	desc = EVTDESAipcq.011
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAipcq.011
		opinion = { who = FROM modifier = opinion_disappointed years = 5 }
	}
	
	after = {
		hidden_tooltip = {
			event_target:underminer_mission_accomplice = {
				clr_character_flag = mission_diplomacy_route
				clr_character_flag = mission_intrigue_route
				clr_character_flag = mission_learning_route
			}
		}
	}
}


############Seneschal############

##build imperial road chain
society_quest_event = {
	id = ipcq.100
	desc = EVTDESAipcq.100
	
	is_triggered_only = yes
	is_in_society = yes
	
	trigger = {
		is_imperial_court_member_trigger = yes
		has_any_quest = no
	}
	
	quest_target = event_target:imperial_road_province
	
	option = {
		name = ACCEPT
		event_target:imperial_road_province = {
			show_scope_change = no
			set_quest_target = {
				id = quest_ipc_build_imperial_road
				holder = ROOT
			}
		}
		custom_tooltip = {
			text = ipc_mission_stewardship_bonus_tooltip
			character_event = { id = ipcq.101 days = 30 }
		}
		ai_chance = { factor = 1 }
	}
	
	option  = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }
		
		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			years = 5
		}
		hidden_tooltip = { 
			FROMFROM = { change_society_currency = 100 }
			event_target:imperial_road_province = { remove_province_modifier = building_imperial_road }
		}
		ai_chance = { factor = 0 }
	}
}


##first step financial costs
character_event = {
	id = ipcq.101
	desc = EVTDESAipcq.101
	picture = GFX_evt_culture_change
	
	is_triggered_only = yes
	
	##scaling stewardship costs
	option = {
		name = EVTOPTAipcq.101
		if = {
			limit = { stewardship = 20 }
			scaled_wealth = { value = -0.1 max = -200 }
		}
		else_if = {
			limit = { stewardship = 16 }
			scaled_wealth = { value = -0.15 max = -250 }
		}
		else_if = {
			limit = { stewardship = 12 }
			scaled_wealth = { value = -0.2 max = -300 }
		}
		else_if = {
			limit = { stewardship = 8 }
			scaled_wealth = { value = -0.25 min = -60 max = -350 }
		}
		else_if = {
			limit = { stewardship = 4 }
			scaled_wealth = { value = -0.30 max = -400 }
		}
		else_if = {
			limit = { NOT = { stewardship = 4 } }
			scaled_wealth = { value = -0.35 max = -450 }
		}
		ai_chance = { factor = 1 }
	}
	
	option = {
		tooltip_info_custom = ipc_admin_architect_info
		trigger = { trait = administrator }
		name = EVTOPTBipcq.101
		scaled_wealth = { value = -0.05 max = -100 }
		ai_chance = { factor = 100 }
	}
	
	after = { hidden_tooltip = { character_event = { id = ipcq.102 days = 30 } } }
}

##second step, labor
character_event = {
	id = ipcq.102
	desc = EVTDESAipcq.102
	picture = GFX_evt_culture_change
	
	is_triggered_only = yes
	
	#pay for labor
	option = {
		name = EVTOPTAipcq.102
		if = {
			limit = { stewardship = 20 }
			scaled_wealth = { value = -0.2 min = -50 max = -200 }
		}
		else_if = {
			limit = { stewardship = 16 }
			scaled_wealth = { value = -0.3 min = -100 max = -250 }
		}
		else_if = {
			limit = { stewardship = 12 }
			scaled_wealth = { value = -0.4 min = -150 max = -300 }
		}
		else_if = {
			limit = { stewardship = 8 }
			scaled_wealth = { value = -0.5 min = -200 max = -350 }
		}
		else_if = {
			limit = { stewardship = 4 }
			scaled_wealth = { value = -0.6 min = -250 max = -400 }
		}
		else_if = {
			limit = { NOT = { stewardship = 4 } }
			scaled_wealth = { value = -0.7 min = -300 max = -450 }
		}
		ai_chance = { factor = 1 }
	}
	
	#use own labor force
	option = {
		name = EVTOPTBipcq.102
		if = {
			limit = { event_target:imperial_road_province = { holder_scope = { character = ROOT } } }
			custom_tooltip = { text = EVTTOOLTIPBipcq.102 }
		}
		else_if = {
			limit = { stewardship = 20 }
			capital_scope = { add_province_modifier = { modifier = peasants_forced_road_building years = 1 } }
		}
		else_if = {
			limit = { stewardship = 16 }
			capital_scope = { add_province_modifier = { modifier = peasants_forced_road_building years = 2 } }
		}
		else_if = {
			limit = { stewardship = 12 }
			capital_scope = { add_province_modifier = { modifier = peasants_forced_road_building years = 4 } }
		}
		else_if = {
			limit = { stewardship = 8 }
			capital_scope = { add_province_modifier = { modifier = peasants_forced_road_building years = 6 } }
		}
		else_if = {
			limit = { stewardship = 4 }
			capital_scope = { add_province_modifier = { modifier = peasants_forced_road_building years = 8 } }
		}
		else_if = {
			limit = { NOT = { stewardship = 4 } }
			capital_scope = { add_province_modifier = { modifier = peasants_forced_road_building years = 10 } }
		}
		ai_chance = { 
			factor = 1 
			modifier = {
				factor = 100
				event_target:imperial_road_province = { holder_scope = { character = ROOT } }
			}
		}
	}
	after = { hidden_tooltip = { character_event = { id = ipcq.103 days = 90 } } }
}

##third step, guards
character_event = {
	id = ipcq.103
	desc = EVTDESAipcq.103
	picture = GFX_evt_culture_change
	
	is_triggered_only = yes
	
	#provide own troops
	option = {
		name = EVTOPTAipcq.103
		if = {
			limit = { event_target:imperial_road_province = { holder_scope = { character = ROOT } } }
			custom_tooltip = { text = EVTTOOLTIPBipcq.102 }
		}
		else_if = {
			limit = { stewardship = 20 }
			capital_scope = { add_province_modifier = { modifier = soldiers_guarding_road years = 1 } }
		}
		else_if = {
			limit = { stewardship = 16 }
			capital_scope = { add_province_modifier = { modifier = soldiers_guarding_road years = 2 } }
		}
		else_if = {
			limit = { stewardship = 12 }
			capital_scope = { add_province_modifier = { modifier = soldiers_guarding_road years = 4 } }
		}
		else_if = {
			limit = { stewardship = 8 }
			capital_scope = { add_province_modifier = { modifier = soldiers_guarding_road years = 6 } }
		}
		else_if = {
			limit = { stewardship = 4 }
			capital_scope = { add_province_modifier = { modifier = soldiers_guarding_road years = 8 } }
		}
		else_if = {
			limit = { NOT = { stewardship = 4 } }
			capital_scope = { add_province_modifier = { modifier = soldiers_guarding_road years = 10 } }
		}
		ai_chance = { factor = 1 }
	}
	
	option = {
		tooltip_info_custom = ipc_admin_strategist_info
		trigger = { 
			trait = administrator 
			NOT = { event_target:imperial_road_province = { holder_scope = { character = ROOT } } }
		}
		name = EVTOPTBipcq.103
		capital_scope = { add_province_modifier = { modifier = soldiers_guarding_road_2 years = 1 } }
		ai_chance = { factor = 100 }
	}

	after = { hidden_tooltip = { character_event = { id = ipcq.104 days = 10 } } }
}

##finish mission
character_event = {
	id = ipcq.104
	desc = EVTDESAipcq.104
	picture = GFX_evt_culture_change
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAipcq.104
		event_target:imperial_road_province = {
			show_scope_change = no
			add_province_modifier = { modifier = ipc_imperial_road duration = -1 } 
			hidden_tooltip = { remove_province_modifier = building_imperial_road }
		}
		change_society_currency = 250
		clr_quest = quest_ipc_build_imperial_road
	}
}

#######Improve capital mission
society_quest_event = {
	id = ipcq.110
	desc = EVTDESAipcq.110
	
	is_triggered_only = yes
	is_in_society = yes
	
	trigger = {
		is_imperial_court_member_trigger = yes
		has_any_quest = no
	}
	
	immediate = { 
		get_imperial_capital_effect = yes 
		event_target:imperial_capital = {
			if = {
				limit = { check_variable = { which = imperial_capital_building_progress value < 1 } }
				set_variable = { which = imperial_capital_building_progress value = 0 }
			}
			set_variable = { which = imperial_capital_building_progress_temp value = 0 }
		}
		reset_ipc_mission_variables_effect = yes
	}
	
	quest_target = event_target:imperial_capital
	
	option = {
		name = ACCEPT
		event_target:imperial_capital = {
			set_quest_target = {
				id = quest_ipc_improve_imperial_capital
				holder = ROOT
			}
		}
		custom_tooltip = {
			text = ipc_mission_stewardship_bonus_tooltip
			character_event = { id = ipcq.112 days = 30 }
		}
		ai_chance = { factor = 1 }
	}
	
	option  = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }
		
		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			years = 5
		}
		
		hidden_tooltip = { FROMFROM = { change_society_currency = 300 } }
		
		ai_chance = { factor = 0 }
	}
}

####capital lost mission failsafe
character_event = {
	id = ipcq.111
	desc = EVTDESAipcq.111
	picture = GFX_evt_end_of_days
	
	is_triggered_only = yes
	
	immediate = {
		event_target:imperial_capital = { set_variable = { which = imperial_capital_building_progress_temp value = 0 } }
		
		clear_delayed_event = { id = ipcq.112 }
		clear_delayed_event = { id = ipcq.113 }
		clear_delayed_event = { id = ipcq.114 }
		clear_delayed_event = { id = ipcq.115 }
		clear_delayed_event = { id = ipcq.116 }
		clear_delayed_event = { id = ipcq.118 }
		
		clr_character_flag = mission_failure
	}
	
	option = {
		name = EVTOPTAipcq.111
		clr_quest = {
			id = quest_ipc_improve_imperial_capital
			failure = yes
		}
	}
}

####flavor tombola, do 5 events, with 1 empty
character_event = {
	id = ipcq.112
	
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { check_variable = { which = ipc_mission_flavor_counter value == 3 } } 
			character_event = { id = ipcq.118 days = 30 }
		}
		else = {
			change_variable = { which = ipc_mission_flavor_counter value = 1 }
			random_list = {
				20 = { character_event = { id = ipcq.113 days = 30 } }
				20 = { character_event = { id = ipcq.114 days = 30 } }
				20 = { character_event = { id = ipcq.115 days = 30 } }
				20 = { character_event = { id = ipcq.116 days = 30 } }
				#chance no event
				10 = { 
					random_list = {
						33 = {}
						33 = { event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 1 } } }
						33 = { event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 2 } } }
					}
					character_event = { id = ipcq.112 days = 2 } 
				}
			}
		}
	}
	
	
}

####lazy workers
character_event = {
	id = ipcq.113
	desc = EVTDESAipcq.113
	picture = GFX_evt_castle_construction
	
	is_triggered_only = yes
	
	#ignore it
	option = {
		name = EVTOPTAipcq.113
		if = {
			limit = { trait = diligent }
			random = { chance = 50 remove_trait = diligent }
		}
		else_if = {
			limit = { NOT = { trait = slothful } }
			random = { chance = 25 add_trait = slothful }
		}
		change_society_currency = 25
		custom_tooltip = {
			text = EVTTOOLTIPbuildingprogress
			random_list = {
				40 = {}
				25 = {
					modifier = {
						factor = 1.2
						stewardship = 4
						NOT = { stewardship = 12 } 
					}
					modifier = {
						factor = 1.2
						stewardship = 8
						NOT = { stewardship = 12 } 
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 1 } }
				}
				25 = {
					modifier = {
						factor = 1.2
						stewardship = 12
						NOT = { stewardship = 20 } 
					}
					modifier = {
						factor = 1.2
						stewardship = 16
						NOT = { stewardship = 20 } 
					}
					modifier = {
						factor = 2
						OR = {
							trait = gardener
							trait = administrator
						}
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 2 } }
				}
				25 = {
					modifier = {
						factor = 1.6
						stewardship = 20
					}
					modifier = {
						factor = 2
						trait = architect
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 3 } }
				}
			}
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0.5
				is_loyal_to_empire_trigger = yes
			}
			modifier = {
				factor = 2
				trait = slothful
			}
			modifier = {
				factor = 1.5
				society_rank == 1
			}
		}
	}
	
	
	#get them back to work
	option = {
		name = EVTOPTBipcq.113
		if = {
			limit = { NOT = { trait = diligent } }
			random = { chance = 5 add_trait = diligent }
		}
		change_society_currency = -25
		custom_tooltip = {
			text = EVTTOOLTIPbuildingincreasedprogress
			random_list = {
				25 = {}
				25 = {
					modifier = {
						factor = 1.2
						stewardship = 4
						NOT = { stewardship = 12 } 
					}
					modifier = {
						factor = 1.2
						stewardship = 8
						NOT = { stewardship = 12 } 
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 1 } }
				}
				25 = {
					modifier = {
						factor = 1.2
						stewardship = 12
						NOT = { stewardship = 20 } 
					}
					modifier = {
						factor = 1.2
						stewardship = 16
						NOT = { stewardship = 20 } 
					}
					modifier = {
						factor = 2
						OR = {
							trait = gardener
							trait = administrator
						}
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 2 } }
				}
				25 = {
					modifier = {
						factor = 1.6
						stewardship = 20
					}
					modifier = {
						factor = 2
						trait = architect
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 3 } }
				}
			}
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1.5
				trait = diligent
			}
			modifier = {
				factor = 1.5
				trait = just
			}
			modifier = {
				factor = 1.25
				is_loyal_to_empire_trigger = yes
			}
		}
	}
	
	#punish them
	option = {
		name = EVTOPTCipcq.113
		if = {
			limit = { trait = kind }
			remove_trait = kind
		}
		else_if = {
			limit = { NOT = { trait = wroth } }
			random = { chance = 80 add_trait = wroth }
		}
		else_if = {
			limit = { NOT = { trait = cruel } }
			random = { chance = 50 add_trait = cruel }
		}
		else = { prestige = -50 }
		change_society_currency = -25
		custom_tooltip = {
			text = EVTTOOLTIPbuildinggreatprogress
			random_list = {
				25 = {}
				25 = {
					modifier = {
						factor = 1.2
						stewardship = 4
						NOT = { stewardship = 12 } 
					}
					modifier = {
						factor = 1.2
						stewardship = 8
						NOT = { stewardship = 12 } 
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 1 } }
				}
				35 = {
					modifier = {
						factor = 1.2
						stewardship = 12
						NOT = { stewardship = 20 } 
					}
					modifier = {
						factor = 1.2
						stewardship = 16
						NOT = { stewardship = 20 } 
					}
					modifier = {
						factor = 2
						OR = {
							trait = gardener
							trait = administrator
						}
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 2 } }
				}
				35 = {
					modifier = {
						factor = 1.6
						stewardship = 20
					}
					modifier = {
						factor = 2
						trait = architect
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 3 } }
				}
			}
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0.5
				trait = kind
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 1.5
				trait = cruel
			}
			modifier = {
				factor = 1.5
				trait = impaler
			}
			modifier = {
				factor = 2
				is_loyal_to_empire_trigger = yes
			}
		}
	}
	after = { hidden_tooltip = { character_event = { id = ipcq.112 } } }
}

####missing stone
character_event = {
	id = ipcq.114
	desc = EVTDESAipcq.114
	picture = GFX_evt_castle_construction
	
	is_triggered_only = yes
	
	#get cheap replacement
	option = {
		name = EVTOPTAipcq.114
		if = {
			limit = { trait = honest }
			random = { chance = 50 remove_trait = honest }
		}
		else_if = {
			limit = { NOT = { trait = greedy } }
			random = { chance = 25 add_trait = greedy }
		}
		else_if = {
			limit = { NOT = { trait = deceitful } }
			random = { chance = 15 add_trait = deceitful }
		}
		scaled_wealth = -0.05
		change_society_currency = 25
		custom_tooltip = {
			text = EVTTOOLTIPbuildingprogress
			random_list = {
				40 = {}
				25 = {
					modifier = {
						factor = 1.2
						stewardship = 4
						NOT = { stewardship = 12 } 
					}
					modifier = {
						factor = 1.2
						stewardship = 8
						NOT = { stewardship = 12 } 
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 1 } }
				}
				25 = {
					modifier = {
						factor = 1.2
						stewardship = 12
						NOT = { stewardship = 20 } 
					}
					modifier = {
						factor = 1.2
						stewardship = 16
						NOT = { stewardship = 20 } 
					}
					modifier = {
						factor = 2
						OR = {
							trait = gardener
							trait = administrator
						}
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 2 } }
				}
				25 = {
					modifier = {
						factor = 1.6
						stewardship = 20
					}
					modifier = {
						factor = 2
						trait = architect
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 3 } }
				}
			}
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0.5
				is_loyal_to_empire_trigger = yes
			}
			modifier = {
				factor = 0.5
				trait = charitable
			}
			modifier = {
				factor = 1.5
				trait = greedy
			}
			modifier = {
				factor = 1.5
				trait = just
			}
		}
	}
	
	
	#find it
	option = {
		name = EVTOPTBipcq.114
		if = {
			limit = { trait = slothful }
			remove_trait = slothful
		}
		else_if = {
			limit = { NOT = { trait = patient } }
			random = { chance = 33 add_trait = patient }
		}
		else_if = {
			limit = { NOT = { trait = diligent } }
			random = { chance = 10 add_trait = diligent }
		}
		change_society_currency = -25
		custom_tooltip = {
			text = EVTTOOLTIPbuildingincreasedprogress
			random_list = {
				25 = {}
				25 = {
					modifier = {
						factor = 1.2
						stewardship = 4
						NOT = { stewardship = 12 } 
					}
					modifier = {
						factor = 1.2
						stewardship = 8
						NOT = { stewardship = 12 } 
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 1 } }
				}
				25 = {
					modifier = {
						factor = 1.2
						stewardship = 12
						NOT = { stewardship = 20 } 
					}
					modifier = {
						factor = 1.2
						stewardship = 16
						NOT = { stewardship = 20 } 
					}
					modifier = {
						factor = 2
						OR = {
							trait = gardener
							trait = administrator
						}
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 2 } }
				}
				25 = {
					modifier = {
						factor = 1.6
						stewardship = 20
					}
					modifier = {
						factor = 2
						trait = architect
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 3 } }
				}
			}
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.5
				trait = slothful
			}
			modifier = {
				factor = 1.5
				trait = diligent
			}
		}
	}
	
	#replace with better quality
	option = {
		name = EVTOPTCipcq.114
		if = {
			limit = { trait = greedy }
			remove_trait = greedy
		}
		else_if = {
			limit = { NOT = { trait = charitable } }
			random = { chance = 60 add_trait = charitable }
		}
		else = { prestige = 50 }
		scaled_wealth = -0.15
		custom_tooltip = {
			text = EVTTOOLTIPbuildinggreatprogress
			random_list = {
				25 = {}
				25 = {
					modifier = {
						factor = 1.2
						stewardship = 4
						NOT = { stewardship = 12 } 
					}
					modifier = {
						factor = 1.2
						stewardship = 8
						NOT = { stewardship = 12 } 
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 1 } }
				}
				35 = {
					modifier = {
						factor = 1.2
						stewardship = 12
						NOT = { stewardship = 20 } 
					}
					modifier = {
						factor = 1.2
						stewardship = 16
						NOT = { stewardship = 20 } 
					}
					modifier = {
						factor = 2
						OR = {
							trait = gardener
							trait = administrator
						}
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 2 } }
				}
				35 = {
					modifier = {
						factor = 1.6
						stewardship = 20
					}
					modifier = {
						factor = 2
						trait = architect
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 3 } }
				}
			}
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0.5
				trait = greedy
			}
			modifier = {
				factor = 1.5
				trait = charitable
			}
			modifier = {
				factor = 2
				is_loyal_to_empire_trigger = yes
			}
		}
	}
	after = { hidden_tooltip = { character_event = { id = ipcq.112 } } }
}

####saw hot babe/dude
character_event = {
	id = ipcq.115
	desc = { 
		trigger = { is_female = no }
		text = EVTDESAipcq.115
	}
	desc = {
		trigger = { is_female = yes }
		text = EVTDESBipcq.115
	}
	picture = GFX_evt_castle_construction
	
	is_triggered_only = yes
	
	#hello there
	option = {
		name = {
			trigger = { is_female = no }
			text = EVTOPTAipcq.115
		}
		name = {
			trigger = { is_female = yes }
			text = EVTOPTBipcq.115
		}
		if = {
			limit = { trait = chaste }
			remove_trait = chaste
		}
		else_if = {
			limit = { NOT = { trait = lustful } }
			random = { chance = 25 add_trait = lustful }
		}
		else_if = {
			limit = { NOT = { trait = arbitrary } }
			random = { chance = 15 add_trait = arbitrary }
		}
		change_society_currency = 25
		custom_tooltip = {
			text = EVTTOOLTIPbuildingprogress
			random_list = {
				40 = {}
				25 = {
					modifier = {
						factor = 1.2
						stewardship = 4
						NOT = { stewardship = 12 } 
					}
					modifier = {
						factor = 1.2
						stewardship = 8
						NOT = { stewardship = 12 } 
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 1 } }
				}
				25 = {
					modifier = {
						factor = 1.2
						stewardship = 12
						NOT = { stewardship = 20 } 
					}
					modifier = {
						factor = 1.2
						stewardship = 16
						NOT = { stewardship = 20 } 
					}
					modifier = {
						factor = 2
						OR = {
							trait = gardener
							trait = administrator
						}
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 2 } }
				}
				25 = {
					modifier = {
						factor = 1.6
						stewardship = 20
					}
					modifier = {
						factor = 2
						trait = architect
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 3 } }
				}
			}
		}
		ai_chance = {
			factor = 35
			modifier = {
				factor = 0.5
				is_loyal_to_empire_trigger = yes
			}
			modifier = {
				factor = 0.5
				trait = chaste
			}
			modifier = {
				factor = 1.5
				trait = lustful
			}
			modifier = {
				factor = 1.5
				OR = {
					trait = seducer
					trait = seductress
				}
			}
			modifier = {
				factor = 1.5
				age < 30
				is_married = no
			}
		}
	}
	
	
	#resist
	option = {
		name = EVTOPTCipcq.115
		if = {
			limit = { trait = lustful }
			remove_trait = lustful
		}
		else_if = {
			limit = { NOT = { trait = chaste } }
			random = { chance = 50 add_trait = chaste }
		}
		else = { prestige = 50 }
		change_society_currency = -25
		custom_tooltip = {
			text = EVTTOOLTIPbuildinggreatprogress
			random_list = {
				25 = {}
				25 = {
					modifier = {
						factor = 1.2
						stewardship = 4
						NOT = { stewardship = 12 } 
					}
					modifier = {
						factor = 1.2
						stewardship = 8
						NOT = { stewardship = 12 } 
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 1 } }
				}
				35 = {
					modifier = {
						factor = 1.2
						stewardship = 12
						NOT = { stewardship = 20 } 
					}
					modifier = {
						factor = 1.2
						stewardship = 16
						NOT = { stewardship = 20 } 
					}
					modifier = {
						factor = 2
						OR = {
							trait = gardener
							trait = administrator
						}
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 2 } }
				}
				35 = {
					modifier = {
						factor = 1.6
						stewardship = 20
					}
					modifier = {
						factor = 2
						trait = architect
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 3 } }
				}
			}
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 1.5
				trait = diligent
			}
			modifier = {
				factor = 1.5
				is_married = yes
				NOR = {
					trait = lustful
					trait = seducer
					trait = seductress
				}
			}
			modifier = {
				factor = 1.5
				age >= 40
			}
			modifier = {
				factor = 2
				is_loyal_to_empire_trigger = yes
			}
		}
	}
	after = { hidden_tooltip = { character_event = { id = ipcq.112 } } }
}

####matters at home
character_event = {
	id = ipcq.116
	desc = EVTDESAipcq.116
	picture = GFX_evt_castle_construction
	
	is_triggered_only = yes
	
	#return
	option = {
		name = EVTOPTAipcq.116
		if = {
			limit = { trait = arbitrary }
			remove_trait = honest
		}
		else_if = {
			limit = { NOT = { trait = just } }
			random = { chance = 50 add_trait = just }
		}
		else =  { prestige = 50 }
		change_society_currency = 25
		custom_tooltip = {
			text = EVTTOOLTIPbuildingprogress
			random_list = {
				40 = {}
				25 = {
					modifier = {
						factor = 1.2
						stewardship = 4
						NOT = { stewardship = 12 } 
					}
					modifier = {
						factor = 1.2
						stewardship = 8
						NOT = { stewardship = 12 } 
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 1 } }
				}
				25 = {
					modifier = {
						factor = 1.2
						stewardship = 12
						NOT = { stewardship = 20 } 
					}
					modifier = {
						factor = 1.2
						stewardship = 16
						NOT = { stewardship = 20 } 
					}
					modifier = {
						factor = 2
						OR = {
							trait = gardener
							trait = administrator
						}
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 2 } }
				}
				25 = {
					modifier = {
						factor = 1.6
						stewardship = 20
					}
					modifier = {
						factor = 2
						trait = architect
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 3 } }
				}
			}
		}
		ai_chance = {
			factor = 35
			modifier = {
				factor = 0.5
				trait = diligent
			}
			modifier = {
				factor = 1.5
				trait = just
			}
		}
	}
	
	
	#trust council
	option = {
		name = EVTOPTBipcq.116
		if = {
			limit = { trait = just }
			random = { chance = 50 remove_trait = just }
		}
		else_if = {
			limit = { NOT = { trait = arbitrary } }
			random = { chance = 25 add_trait = arbitrary }
		}
		else = { prestige = -50 }
		change_society_currency = -25
		random_courtier = {
			limit = { is_councillor = yes }
			opinion = { modifier = opinion_glad who = ROOT years = 5 }
		}
		custom_tooltip = {
			text = EVTTOOLTIPbuildingincreasedprogress
			random_list = {
				25 = {}
				25 = {
					modifier = {
						factor = 1.2
						stewardship = 4
						NOT = { stewardship = 12 } 
					}
					modifier = {
						factor = 1.2
						stewardship = 8
						NOT = { stewardship = 12 } 
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 1 } }
				}
				25 = {
					modifier = {
						factor = 1.2
						stewardship = 12
						NOT = { stewardship = 20 } 
					}
					modifier = {
						factor = 1.2
						stewardship = 16
						NOT = { stewardship = 20 } 
					}
					modifier = {
						factor = 2
						OR = {
							trait = gardener
							trait = administrator
						}
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 2 } }
				}
				25 = {
					modifier = {
						factor = 1.6
						stewardship = 20
					}
					modifier = {
						factor = 2
						trait = architect
					}
					event_target:imperial_capital = { change_variable = { which = imperial_capital_building_progress_temp value = 3 } }
				}
			}
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 1.5
				trait = slothful
			}
			modifier = {
				factor = 1.5
				trait = trusting
			}
			modifier = {
				factor = 2
				is_loyal_to_empire_trigger = yes
			}
		}
	}
	after = { hidden_tooltip = { character_event = { id = ipcq.112 } } }
}

###construction complete
character_event = {
	id = ipcq.118
	desc = {
		trigger = {
			NOT = { has_character_flag = mission_failure }
			event_target:imperial_capital = { check_variable = { which = imperial_capital_building_progress value < 100 } } 
		}
		text = EVTDESAipcq.118
	}
	desc = {
		trigger = { 
			NOT = { has_character_flag = mission_failure }
			event_target:imperial_capital = { check_variable = { which = imperial_capital_building_progress value >= 100 } } 
		}
		text = EVTDESBipcq.118
	}
	desc = {
		trigger = { has_character_flag = mission_failure }
		text = EVTDESCipcq.118
	}
	picture = GFX_evt_castle_construction
	
	is_triggered_only = yes
	
	immediate = {
		#add progress
		event_target:imperial_capital = {
			if = {
				limit = { check_variable = { which = imperial_capital_building_progress_temp value < 3 } }
				ROOT = { set_character_flag = mission_failure }
			}
			
			multiply_variable = { which = imperial_capital_building_progress_temp value = 3.8 }
			change_variable = { which = imperial_capital_building_progress which = imperial_capital_building_progress_temp }
		}
	}
	
	option = {
		trigger = { NOT = { has_character_flag = mission_failure } }
		name = {
			trigger = { event_target:imperial_capital = { check_variable = { which = imperial_capital_building_progress value < 100 } } }
			text = EVTOPTAipcq.118
		}
		name = {
			trigger = { event_target:imperial_capital = { check_variable = { which = imperial_capital_building_progress value >= 100 } } }
			text = EVTOPTBipcq.118
		}
		change_society_currency = 300
		clr_quest = quest_ipc_improve_imperial_capital
		add_imperial_service_opinion_effect = yes
	}
	
	option = {
		trigger = { has_character_flag = mission_failure }
		name = EVTOPTCipcq.118
		clr_quest = {
			id = quest_ipc_improve_imperial_capital
			failure = yes
		}
		add_failed_empire_opinion_effect = yes
	}
	
	after = {
		hidden_tooltip = {
			clr_character_flag = mission_failure
			reset_ipc_mission_variables_effect = yes
			event_target:imperial_capital = {
				if = {
					limit = { check_variable = { which = imperial_capital_building_progress value >= 100 } }
					change_variable = { which = imperial_capital_building_progress value = -100 }
					ROOT = {
						add_character_modifier = { modifier = quest_ipc_improve_imperial_capital_building_notification days = 10 hidden = yes }
						top_liege = { character_event = { id = ipcq.119 days = 5 } }
					}
				}
			}
		}
	}
}

###inform emperor of building complete
character_event = {
	id = ipcq.119
	desc = EVTDESAipcq.119
	picture = GFX_evt_castle_construction
	
	hide_from = yes
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAipcq.119
		event_target:imperial_capital = {
			random_list = {
				20 = {
					trigger = {
						NOR = {
							has_building = ipc_imperial_barracks_1
							has_building = ipc_imperial_barracks_2
							has_building = ipc_imperial_barracks_3
						}
					}
					add_building = ipc_imperial_barracks_1
				}
				20 = {
					trigger = {
						has_building = ipc_imperial_barracks_1
						NOT = { has_building = ipc_imperial_barracks_2 }
					}
					add_building = ipc_imperial_barracks_2
				}
				20 = {
					trigger = {
						has_building = ipc_imperial_barracks_2
						NOT = { has_building = ipc_imperial_barracks_3 }
					}
					add_building = ipc_imperial_barracks_3
				}
				
				20 = {
					trigger = {
						NOR = {
							has_building = ipc_imperial_training_grounds_1
							has_building = ipc_imperial_training_grounds_2
							has_building = ipc_imperial_training_grounds_3
						}
					}
					add_building = ipc_imperial_training_grounds_1
				}
				20 = {
					trigger = {
						has_building = ipc_imperial_training_grounds_1
						NOT = { has_building = ipc_imperial_training_grounds_2 }
					}
					add_building = ipc_imperial_training_grounds_2
				}
				20 = {
					trigger = {
						has_building = ipc_imperial_training_grounds_2
						NOT = { has_building = ipc_imperial_training_grounds_3 }
					}
					add_building = ipc_imperial_training_grounds_3
				}
				
				20 = {
					trigger = {
						NOR = {
							has_building = ipc_imperial_tax_center_1
							has_building = ipc_imperial_tax_center_2
							has_building = ipc_imperial_tax_center_3
						}
					}
					add_building = ipc_imperial_tax_center_1
				}
				20 = {
					trigger = {
						has_building = ipc_imperial_tax_center_1
						NOT = { has_building = ipc_imperial_tax_center_2 }
					}
					add_building = ipc_imperial_tax_center_2
				}
				20 = {
					trigger = {
						has_building = ipc_imperial_tax_center_2
						NOT = { has_building = ipc_imperial_tax_center_3 }
					}
					add_building = ipc_imperial_tax_center_3
				}
			
				20 = {
					trigger = {
						NOR = {
							has_building = ipc_imperial_library_1
							has_building = ipc_imperial_library_2
							has_building = ipc_imperial_library_3
						}
					}
					add_building = ipc_imperial_library_1
				}
				20 = {
					trigger = {
						has_building = ipc_imperial_library_1
						NOT = { has_building = ipc_imperial_library_2 }
					}
					add_building = ipc_imperial_library_2
				}
				20 = {
					trigger = {
						has_building = ipc_imperial_library_2
						NOT = { has_building = ipc_imperial_library_3 }
					}
					add_building = ipc_imperial_library_3
				}
				
				20 = {
					trigger = {
						NOR = {
							has_building = ipc_imperial_council_halls_1
							has_building = ipc_imperial_council_halls_2
							has_building = ipc_imperial_council_halls_3
						}
					}
					add_building = ipc_imperial_council_halls_1
				}
				20 = {
					trigger = {
						has_building = ipc_imperial_council_halls_1
						NOT = { has_building = ipc_imperial_council_halls_2 }
					}
					add_building = ipc_imperial_council_halls_2
				}
				20 = {
					trigger = {
						has_building = ipc_imperial_council_halls_2
						NOT = { has_building = ipc_imperial_council_halls_3 }
					}
					add_building = ipc_imperial_council_halls_3
				}
				
				20 = {
					trigger = {
						NOR = {
							has_building = ipc_imperial_palace_1
							has_building = ipc_imperial_palace_2
							has_building = ipc_imperial_palace_3
						}
					}
					add_building = ipc_imperial_palace_1
				}
				20 = {
					trigger = {
						has_building = ipc_imperial_palace_1
						NOT = { has_building = ipc_imperial_palace_2 }
					}
					add_building = ipc_imperial_palace_2
				}
				20 = {
					trigger = {
						has_building = ipc_imperial_palace_2
						NOT = { has_building = ipc_imperial_palace_3 }
					}
					add_building = ipc_imperial_palace_3
				}
			}
		}
	}
}



############Marshal############

#organize military drill
society_quest_event = {
	id = ipcq.200
	desc = EVTDESAipcq.200
	
	is_triggered_only = yes
	is_in_society = yes
	
	trigger = {
		is_imperial_court_member_trigger = yes
		has_any_quest = no
	}
	
	option = {
		name = ACCEPT
		set_quest = quest_ipc_military_drill
		custom_tooltip = {
			text = ipc_mission_martial_bonus_tooltip
			character_event = { id = ipcq.201 days = 30 }
		}
		ai_chance = { factor = 1 }
	}
	
	option  = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }
		
		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			years = 5
		}
		
		hidden_tooltip = { FROMFROM = { change_society_currency = 250 } }
		
		ai_chance = { factor = 0 }
	}
}

##prepare and send invitations
character_event = {
	id = ipcq.201
	desc = EVTDESAipcq.201
	picture = GFX_evt_machines_of_war
	
	is_triggered_only = yes
	
	immediate = { 
		set_variable = { which = attending_characters_count value = 0 }
		set_variable = { which = attending_characters_improved_count value = 0 }
	}
	
	#only invite society
	option = {
		name = EVTOPTAipcq.201
		custom_tooltip = {
			text = EVTTOOLTIPAipcq.201
			set_character_flag = invite_society_only
			hidden_tooltip = {
				society = {
					any_society_member = {
						limit = {
							NOT = { character = ROOT }
							society_rank < 3
							OR = {
								AND = {
									is_landed = yes
									is_feudal = yes
								}
								AND = {
									is_landed = no
									OR = {
										has_minor_title = title_commander
										has_education_martial_trigger = yes
									}
								}
							}
						}
						letter_event = { id = ipcq.202 days = 3 }
					}
				}
			}
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1.25
				trait = greedy
			}
			modifier = {
				factor = 1.25
				trait = slothful
			}
			modifier = {
				factor = 2
				NOT = { opinion = { who = top_liege value = 10 } }
			}
		}
	}
	
	#invite all the realm
	option = {
		name = EVTOPTBipcq.201
		scaled_wealth = { value = -0.3 min = -50 max = -500 }
		custom_tooltip = {
			text = EVTTOOLTIPBipcq.201
			set_character_flag = invite_all_realm
			hidden_tooltip = {
				top_liege = {
					any_realm_character = {
						limit = {
							NOR = { 
								tier = emperor
								character = ROOT 
							}
							OR = {
								NOT = { same_society_as = ROOT }
								society_rank < 3
							}
							OR = {
								AND = {
									is_landed = yes
									is_feudal = yes
								}
								AND = {
									is_landed = no
									has_minor_title = title_commander
								}
							}
						}
						letter_event = { id = ipcq.202 days = 3 }
					}
				}
			}
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 3
				is_loyal_to_empire_trigger = yes
			}
			modifier = {
				factor = 1.25
				is_landed = no
			}
		}
	}
	
	after = { hidden_tooltip = { character_event = { id = ipcq.203 days = 30 } } }
}

###invitations
letter_event = {
	id = ipcq.202
	desc = EVTDESAipcq.202
	
	is_triggered_only = yes
	
	#attend
	option = {
		name = EVTOPTAipcq.202
		custom_tooltip = {
			text = EVTTOOLTIPAipcq.202
			set_character_flag = attending_military_drill
			FROM = { change_variable = { which = attending_characters_count value = 1 } }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				NOT = { leader_traits = 1 }
			}
		}
	}
	
	#decline
	option = {
		name = EVTOPTBipcq.202
		reverse_opinion = { modifier = opinion_very_disappointed who = FROM years = 3 }
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1.2
				has_education_martial_trigger = no
			}
		}
	}
}

###which topic to focus on
character_event = {
	id = ipcq.203
	desc = EVTDESAipcq.203
	picture = GFX_evt_armory
	
	is_triggered_only = yes
	
	#balanced
	option = {
		name = EVTOPTAipcq.203
		custom_tooltip = {
			text = EVTTOOLTIPAipcq.203
			set_character_flag = balanced_military_drill
		}
		ai_chance = { factor = 50 }
	}
	
	#offense
	option = {
		trigger = { has_offensive_leadership_trait_trigger = yes }
		name = EVTOPTBipcq.203
		custom_tooltip = {
			text = EVTTOOLTIPBipcq.203
			set_character_flag = offensive_military_drill
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 5
				has_offensive_leadership_trait_trigger = yes
			}
		}
	}

	#defense
	option = {
		trigger = { has_defensive_leadership_trait_trigger = yes }
		name = EVTOPTCipcq.203
		custom_tooltip = {
			text = EVTTOOLTIPCipcq.203
			set_character_flag = defensive_military_drill
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 5
				has_defensive_leadership_trait_trigger = yes
			}
		}
	}
	
	#strategy
	option = {
		tooltip_info = strategist
		trigger = { trait = strategist }
		name = EVTOPTDipcq.203
		custom_tooltip = {
			text = EVTTOOLTIPDipcq.203
			set_character_flag = strategic_military_drill
		}
		ai_chance = { factor = 250 }
	}
	
	after = { 
		hidden_tooltip = {
			if = {
				limit = { has_character_flag = invite_society_only }
				society = {
					any_society_member = {
						limit = { has_character_flag = attending_military_drill }
						character_event = { id = ipcq.204 days = 5 }
					}
				}
			}
			else = {
				top_liege = {
					any_realm_character = {
						limit = { has_character_flag = attending_military_drill }
						character_event = { id = ipcq.204 days = 5 }
					}
				}
			}
			character_event = { id = ipcq.205 days = 30 }
		}
	}
}

###attending characters improve
character_event = {
	id = ipcq.204
	desc = EVTDESAipcq.204
	picture = GFX_evt_armory
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAipcq.204
		if = {
			limit = { FROM = { has_character_flag = balanced_military_drill } }
			random_list = {
				50 = {
					modifier = {
						factor = 0.9
						FROM = { martial = 4 }
					}
					modifier = {
						factor = 0.9
						FROM = { martial = 8 }
					}
					modifier = {
						factor = 0.9
						FROM = { martial = 12 }
					}
					modifier = {
						factor = 0.9
						FROM = { martial = 16 }
					}
					modifier = {
						factor = 0.9
						FROM = { martial = 20 }
					}
					modifier = {
						factor = 0.8
						FROM = { trait = inspiring_leader }
					}
					modifier = {
						factor = 0.9
						FROM = { prestige = 500 }
					}
					modifier = {
						factor = 0.9
						FROM = { prestige = 1000 }
					}
				}
				20 = { change_martial = 1 hidden_tooltip = { FROM = { change_variable = { which = attending_characters_improved_count value = 1 } } } }
				20 = { change_martial = 2 hidden_tooltip = { FROM = { change_variable = { which = attending_characters_improved_count value = 1 } } } }
				5 = {
					trigger = { FROM = { has_offensive_leadership_trait_trigger = yes } }
					custom_tooltip = {
						text = EVTTOOLTIPAipcq.204
						hidden_tooltip = {
							FROM = { change_variable = { which = attending_characters_improved_count value = 1 } }
							random_list = {
								10 = {
									trigger = { FROM = { trait = light_foot_leader } }
									add_trait = light_foot_leader
								}
								10 = {
									trigger = { FROM = { trait = heavy_infantry_leader } }
									add_trait = heavy_infantry_leader
								}
								10 = {
									trigger = { FROM = { trait = cavalry_leader } }
									add_trait = cavalry_leader
								}
								10 = {
									trigger = { FROM = { trait = organizer } }
									add_trait = organizer
								}
								10 = {
									trigger = { FROM = { trait = experimenter } }
									add_trait = experimenter
								}
								10 = {
									trigger = { FROM = { trait = flanker } }
									add_trait = flanker
								}
								10 = {
									trigger = { FROM = { trait = aggressive_leader } }
									add_trait = aggressive_leader
								}
								10 = {
									trigger = { FROM = { trait = siege_leader } }
									add_trait = siege_leader
								}
								10 = {
									trigger = { FROM = { trait = holy_warrior } }
									add_trait = holy_warrior
								}
								10 = {
									trigger = { FROM = { trait = war_elephant_leader } }
									add_trait = war_elephant_leader
								}
								10 = {
									trigger = { FROM = { trait = master_of_flame } }
									add_trait = master_of_flame
								}
								10 = {
									trigger = { FROM = { trait = sapper } }
									add_trait = sapper
								}
							}
						}
					}
				}
				5 = {
					trigger = { FROM = { has_defensive_leadership_trait_trigger = yes } }
					custom_tooltip = {
						text = EVTTOOLTIPBipcq.204
						hidden_tooltip = {
							FROM = { change_variable = { which = attending_characters_improved_count value = 1 } }
							random_list = {
								10 = {
									trigger = { FROM = { trait = inspiring_leader } }
									add_trait = inspiring_leader
								}
								10 = {
									trigger = { FROM = { trait = trickster } }
									add_trait = trickster
								}
								10 = {
									trigger = { FROM = { trait = defensive_leader } }
									add_trait = defensive_leader
								}
								10 = {
									trigger = { FROM = { trait = unyielding_leader } }
									add_trait = unyielding_leader
								}
								10 = {
									trigger = { FROM = { trait = narrow_flank_leader } }
									add_trait = narrow_flank_leader
								}
								10 = {
									trigger = { FROM = { trait = logistics_expert } }
									add_trait = logistics_expert
								}
								10 = {
									trigger = { FROM = { trait = levy_coordinator } }
									add_trait = levy_coordinator
								}
							}
						}
					}
				}
				5 = {
					trigger = { FROM = { has_terrain_leadership_trait_trigger = yes } }
					custom_tooltip = {
						text = EVTTOOLTIPCipcq.204
						hidden_tooltip = {
							FROM = { change_variable = { which = attending_characters_improved_count value = 1 } }
							random_list = {
								10 = {
									trigger = { FROM = { trait = flat_terrain_leader } }
									add_trait = flat_terrain_leader
								}
								10 = {
									trigger = { FROM = { trait = rough_terrain_leader } }
									add_trait = rough_terrain_leader
								}
								10 = {
									trigger = { FROM = { trait = mountain_terrain_leader } }
									add_trait = mountain_terrain_leader
								}
								10 = {
									trigger = { FROM = { trait = desert_terrain_leader } }
									add_trait = desert_terrain_leader
								}
								10 = {
									trigger = { FROM = { trait = jungle_terrain_leader } }
									add_trait = jungle_terrain_leader
								}
								10 = {
									trigger = { FROM = { trait = winter_soldier } }
									add_trait = winter_soldier
								}
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = { FROM = { has_character_flag = offensive_military_drill } }
			random_list = {
				50 = {
					modifier = {
						factor = 0.9
						FROM = { martial = 4 }
					}
					modifier = {
						factor = 0.9
						FROM = { martial = 8 }
					}
					modifier = {
						factor = 0.9
						FROM = { martial = 12 }
					}
					modifier = {
						factor = 0.9
						FROM = { martial = 16 }
					}
					modifier = {
						factor = 0.9
						FROM = { martial = 20 }
					}
					modifier = {
						factor = 0.8
						FROM = { trait = inspiring_leader }
					}
					modifier = {
						factor = 0.9
						FROM = { prestige = 500 }
					}
					modifier = {
						factor = 0.9
						FROM = { prestige = 1000 }
					}
				}
				20 = { change_martial = 1 hidden_tooltip = { FROM = { change_variable = { which = attending_characters_improved_count value = 1 } } } }
				20 = { change_martial = 2 hidden_tooltip = { FROM = { change_variable = { which = attending_characters_improved_count value = 1 } } } }
				20 = {
					trigger = { FROM = { has_offensive_leadership_trait_trigger = yes } }
					custom_tooltip = {
						text = EVTTOOLTIPAipcq.204
						hidden_tooltip = {
							FROM = { change_variable = { which = attending_characters_improved_count value = 1 } }
							random_list = {
								10 = {
									trigger = { FROM = { trait = light_foot_leader } }
									add_trait = light_foot_leader
								}
								10 = {
									trigger = { FROM = { trait = heavy_infantry_leader } }
									add_trait = heavy_infantry_leader
								}
								10 = {
									trigger = { FROM = { trait = cavalry_leader } }
									add_trait = cavalry_leader
								}
								10 = {
									trigger = { FROM = { trait = organizer } }
									add_trait = organizer
								}
								10 = {
									trigger = { FROM = { trait = experimenter } }
									add_trait = experimenter
								}
								10 = {
									trigger = { FROM = { trait = flanker } }
									add_trait = flanker
								}
								10 = {
									trigger = { FROM = { trait = aggressive_leader } }
									add_trait = aggressive_leader
								}
								10 = {
									trigger = { FROM = { trait = siege_leader } }
									add_trait = siege_leader
								}
								10 = {
									trigger = { FROM = { trait = holy_warrior } }
									add_trait = holy_warrior
								}
								10 = {
									trigger = { FROM = { trait = war_elephant_leader } }
									add_trait = war_elephant_leader
								}
								10 = {
									trigger = { FROM = { trait = master_of_flame } }
									add_trait = master_of_flame
								}
								10 = {
									trigger = { FROM = { trait = sapper } }
									add_trait = sapper
								}
							}
						}
					}
				}
				5 = {
					trigger = { FROM = { has_terrain_leadership_trait_trigger = yes } }
					custom_tooltip = {
						text = EVTTOOLTIPCipcq.204
						hidden_tooltip = {
							FROM = { change_variable = { which = attending_characters_improved_count value = 1 } }
							random_list = {
								10 = {
									trigger = { FROM = { trait = flat_terrain_leader } }
									add_trait = flat_terrain_leader
								}
								10 = {
									trigger = { FROM = { trait = rough_terrain_leader } }
									add_trait = rough_terrain_leader
								}
								10 = {
									trigger = { FROM = { trait = mountain_terrain_leader } }
									add_trait = mountain_terrain_leader
								}
								10 = {
									trigger = { FROM = { trait = desert_terrain_leader } }
									add_trait = desert_terrain_leader
								}
								10 = {
									trigger = { FROM = { trait = jungle_terrain_leader } }
									add_trait = jungle_terrain_leader
								}
								10 = {
									trigger = { FROM = { trait = winter_soldier } }
									add_trait = winter_soldier
								}
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = { FROM = { has_character_flag = defensive_military_drill } }
			random_list = {
				50 = {
					modifier = {
						factor = 0.9
						FROM = { martial = 4 }
					}
					modifier = {
						factor = 0.9
						FROM = { martial = 8 }
					}
					modifier = {
						factor = 0.9
						FROM = { martial = 12 }
					}
					modifier = {
						factor = 0.9
						FROM = { martial = 16 }
					}
					modifier = {
						factor = 0.9
						FROM = { martial = 20 }
					}
					modifier = {
						factor = 0.8
						FROM = { trait = inspiring_leader }
					}
					modifier = {
						factor = 0.9
						FROM = { prestige = 500 }
					}
					modifier = {
						factor = 0.9
						FROM = { prestige = 1000 }
					}
				}
				20 = { change_martial = 1 hidden_tooltip = { FROM = { change_variable = { which = attending_characters_improved_count value = 1 } } } }
				20 = { change_martial = 2 hidden_tooltip = { FROM = { change_variable = { which = attending_characters_improved_count value = 1 } } } }
				20 = {
					trigger = { FROM = { has_defensive_leadership_trait_trigger = yes } }
					custom_tooltip = {
						text = EVTTOOLTIPBipcq.204
						hidden_tooltip = {
							FROM = { change_variable = { which = attending_characters_improved_count value = 1 } }
							random_list = {
								10 = {
									trigger = { FROM = { trait = inspiring_leader } }
									add_trait = inspiring_leader
								}
								10 = {
									trigger = { FROM = { trait = trickster } }
									add_trait = trickster
								}
								10 = {
									trigger = { FROM = { trait = defensive_leader } }
									add_trait = defensive_leader
								}
								10 = {
									trigger = { FROM = { trait = unyielding_leader } }
									add_trait = unyielding_leader
								}
								10 = {
									trigger = { FROM = { trait = narrow_flank_leader } }
									add_trait = narrow_flank_leader
								}
								10 = {
									trigger = { FROM = { trait = logistics_expert } }
									add_trait = logistics_expert
								}
								10 = {
									trigger = { FROM = { trait = levy_coordinator } }
									add_trait = levy_coordinator
								}
							}
						}
					}
				}
				5 = {
					trigger = { FROM = { has_terrain_leadership_trait_trigger = yes } }
					custom_tooltip = {
						text = EVTTOOLTIPCipcq.204
						hidden_tooltip = {
							FROM = { change_variable = { which = attending_characters_improved_count value = 1 } }
							random_list = {
								10 = {
									trigger = { FROM = { trait = flat_terrain_leader } }
									add_trait = flat_terrain_leader
								}
								10 = {
									trigger = { FROM = { trait = rough_terrain_leader } }
									add_trait = rough_terrain_leader
								}
								10 = {
									trigger = { FROM = { trait = mountain_terrain_leader } }
									add_trait = mountain_terrain_leader
								}
								10 = {
									trigger = { FROM = { trait = desert_terrain_leader } }
									add_trait = desert_terrain_leader
								}
								10 = {
									trigger = { FROM = { trait = jungle_terrain_leader } }
									add_trait = jungle_terrain_leader
								}
								10 = {
									trigger = { FROM = { trait = winter_soldier } }
									add_trait = winter_soldier
								}
							}
						}
					}
				}
			}
		}
		if = {
			limit = { FROM = { has_character_flag = strategic_military_drill } }
			random_list = {
				50 = {
					modifier = {
						factor = 0.9
						FROM = { martial = 4 }
					}
					modifier = {
						factor = 0.9
						FROM = { martial = 8 }
					}
					modifier = {
						factor = 0.9
						FROM = { martial = 12 }
					}
					modifier = {
						factor = 0.9
						FROM = { martial = 16 }
					}
					modifier = {
						factor = 0.9
						FROM = { martial = 20 }
					}
					modifier = {
						factor = 0.8
						FROM = { trait = inspiring_leader }
					}
					modifier = {
						factor = 0.9
						FROM = { prestige = 500 }
					}
					modifier = {
						factor = 0.9
						FROM = { prestige = 1000 }
					}
				}
				10 = { change_martial = 2 hidden_tooltip = { FROM = { change_variable = { which = attending_characters_improved_count value = 1 } } } }
				10 = { change_martial = 3 hidden_tooltip = { FROM = { change_variable = { which = attending_characters_improved_count value = 1 } } } }
				20 = {
					trigger = { FROM = { has_offensive_leadership_trait_trigger = yes } }
					custom_tooltip = {
						text = EVTTOOLTIPAipcq.204
						hidden_tooltip = { 
							FROM = { change_variable = { which = attending_characters_improved_count value = 1 } }
							random_list = {
								10 = {
									trigger = { FROM = { trait = light_foot_leader } }
									add_trait = light_foot_leader
								}
								10 = {
									trigger = { FROM = { trait = heavy_infantry_leader } }
									add_trait = heavy_infantry_leader
								}
								10 = {
									trigger = { FROM = { trait = cavalry_leader } }
									add_trait = cavalry_leader
								}
								10 = {
									trigger = { FROM = { trait = organizer } }
									add_trait = organizer
								}
								10 = {
									trigger = { FROM = { trait = experimenter } }
									add_trait = experimenter
								}
								10 = {
									trigger = { FROM = { trait = flanker } }
									add_trait = flanker
								}
								10 = {
									trigger = { FROM = { trait = aggressive_leader } }
									add_trait = aggressive_leader
								}
								10 = {
									trigger = { FROM = { trait = siege_leader } }
									add_trait = siege_leader
								}
								10 = {
									trigger = { FROM = { trait = holy_warrior } }
									add_trait = holy_warrior
								}
								10 = {
									trigger = { FROM = { trait = war_elephant_leader } }
									add_trait = war_elephant_leader
								}
								10 = {
									trigger = { FROM = { trait = master_of_flame } }
									add_trait = master_of_flame
								}
								10 = {
									trigger = { FROM = { trait = sapper } }
									add_trait = sapper
								}
							}
						}
					}
				}
				20 = {
					trigger = { FROM = { has_defensive_leadership_trait_trigger = yes } }
					custom_tooltip = {
						text = EVTTOOLTIPBipcq.204
						hidden_tooltip = { 
							FROM = { change_variable = { which = attending_characters_improved_count value = 1 } }
							random_list = {
								10 = {
									trigger = { FROM = { trait = inspiring_leader } }
									add_trait = inspiring_leader
								}
								10 = {
									trigger = { FROM = { trait = trickster } }
									add_trait = trickster
								}
								10 = {
									trigger = { FROM = { trait = defensive_leader } }
									add_trait = defensive_leader
								}
								10 = {
									trigger = { FROM = { trait = unyielding_leader } }
									add_trait = unyielding_leader
								}
								10 = {
									trigger = { FROM = { trait = narrow_flank_leader } }
									add_trait = narrow_flank_leader
								}
								10 = {
									trigger = { FROM = { trait = logistics_expert } }
									add_trait = logistics_expert
								}
								10 = {
									trigger = { FROM = { trait = levy_coordinator } }
									add_trait = levy_coordinator
								}
							}
						}
					}
				}
				20 = {
					trigger = { FROM = { has_terrain_leadership_trait_trigger = yes } }
					custom_tooltip = {
						text = EVTTOOLTIPCipcq.204
						hidden_tooltip = { 
							FROM = { change_variable = { which = attending_characters_improved_count value = 1 } }
							random_list = {
								10 = {
									trigger = { FROM = { trait = flat_terrain_leader } }
									add_trait = flat_terrain_leader
								}
								10 = {
									trigger = { FROM = { trait = rough_terrain_leader } }
									add_trait = rough_terrain_leader
								}
								10 = {
									trigger = { FROM = { trait = mountain_terrain_leader } }
									add_trait = mountain_terrain_leader
								}
								10 = {
									trigger = { FROM = { trait = desert_terrain_leader } }
									add_trait = desert_terrain_leader
								}
								10 = {
									trigger = { FROM = { trait = jungle_terrain_leader } }
									add_trait = jungle_terrain_leader
								}
								10 = {
									trigger = { FROM = { trait = winter_soldier } }
									add_trait = winter_soldier
								}
							}
						}
					}
				}
			}
		}
	}
}


##drill over, check if success or fail and finish mission
character_event = {
	id = ipcq.205
	desc = {
		trigger = { has_character_flag = military_drill_success }
		text = EVTDESAipcq.205
	}
	desc = {
		trigger = { has_character_flag = military_drill_failure }
		text = EVTDESBipcq.205
	}
	picture = GFX_evt_armory
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { has_character_flag = strategic_military_drill }
			multiply_variable = { which = attending_characters_count value = 0.25 }
			if = {
				limit = { check_variable = { which = attending_characters_improved_count which = attending_characters_count } }
				set_character_flag = military_drill_success
			}
			else = { set_character_flag = military_drill_failure }
		}
		else_if = {
			limit = { martial = 12 }
			multiply_variable = { which = attending_characters_count value = 0.35 }
			if = {
				limit = { check_variable = { which = attending_characters_improved_count which = attending_characters_count } }
				set_character_flag = military_drill_success
			}
			else = { set_character_flag = military_drill_failure }
		}
		else = {
			multiply_variable = { which = attending_characters_count value = 0.40 }
			if = {
				limit = { check_variable = { which = attending_characters_improved_count which = attending_characters_count } }
				set_character_flag = military_drill_success
			}
			else = { set_character_flag = military_drill_failure }
		}
	}
	
	#success
	option = {
		trigger = { has_character_flag = military_drill_success }
		name = EVTOPTAipcq.205
		custom_tooltip = {
			text = EVTTOOLTIPAipcq.205
			if = {
				limit = { has_character_flag = invite_society_only }
				society = {
					any_society_member = {
						limit = { has_character_flag = attending_military_drill }
						capital_scope = { add_province_modifier = { modifier = ipc_military_drill years = 5 } }
						clr_character_flag = attending_military_drill
					}
				}
			}
			else = {
				top_liege = {
					any_realm_character = {
						limit = { has_character_flag = attending_military_drill }
						capital_scope = { add_province_modifier = { modifier = ipc_military_drill years = 5 } }
						clr_character_flag = attending_military_drill
					}
				}
			}
		}
		change_society_currency = 350
		clr_quest = quest_ipc_military_drill
		add_imperial_service_opinion_effect = yes
	}
	
	#failure
	option = {
		trigger = { has_character_flag = military_drill_failure }
		name = EVTOPTBipcq.205
		custom_tooltip = {
			text = EVTTOOLTIPBipcq.205
			if = {
				limit = { has_character_flag = invite_society_only }
				society = {
					any_society_member = {
						limit = { has_character_flag = attending_military_drill }
						clr_character_flag = attending_military_drill
					}
				}
			}
			else = {
				top_liege = {
					any_realm_character = {
						limit = { has_character_flag = attending_military_drill }
						clr_character_flag = attending_military_drill
					}
				}
			}
		}
		clr_quest = {
			id = quest_ipc_military_drill
			failure = yes
		}
		add_failed_empire_opinion_effect = yes
	}
	
	after = {
		hidden_tooltip = {
			clr_character_flag = invite_society_only
			clr_character_flag = invite_all_realm
			clr_character_flag = balanced_military_drill
			clr_character_flag = offensive_military_drill
			clr_character_flag = defensive_military_drill
			clr_character_flag = strategic_military_drill
		}
	}
}


######Distribute Levy Recompense mission

society_quest_event = {
	id = ipcq.210
	desc = EVTDESAipcq.210
	
	is_triggered_only = yes
	is_in_society = yes
	
	show_from_from = yes
	
	trigger = {
		is_imperial_court_member_trigger = yes
		has_any_quest = no
	}
	
	
	
	immediate = { reset_ipc_mission_variables_effect = yes }
	
	option = {
		name = ACCEPT
		set_quest = quest_ipc_distribute_levy_recompense
		custom_tooltip = {  text = ipc_mission_combat_rating_tooltip }
		custom_tooltip = {
			text = ipc_mission_martial_bonus_tooltip
			character_event = { id = ipcq.211 days = 2 }
		}
		ai_chance = { factor = 1 }
	}
	
	option  = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }
		
		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			years = 5
		}
		
		hidden_tooltip = { FROMFROM = { change_society_currency = 150 } }
		
		ai_chance = { factor = 0 }
	}
}

###start, set out
character_event = {
	id = ipcq.211
	desc = EVTDESAipcq.211
	picture = GFX_evt_carriage
	
	is_triggered_only = yes
	
	immediate = { 
		set_variable = { which = ipc_mission_score value = 4 } #decreases if person steals/gets robbed
	}
	
	option = {
		name = EVTOPTAipcq.211
		add_character_modifier = { modifier = out_traveling months = 6 }
		hidden_tooltip = { character_event = { id = ipcq.212 days = 1 } }
	}
}


###tombola
character_event = {
	id = ipcq.212
	
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		is_imperial_court_member_trigger = yes
	}
	
	immediate = {
		if = {
			limit = { check_variable = { which = ipc_mission_flavor_counter value == 6 } } 
			character_event = { id = ipcq.220 days = 10 random = 5 }
		}
		else = {
			change_variable = { which = ipc_mission_flavor_counter value = 1 }
			random_list = {
				##give to lord
				60 = {
					trigger = { check_variable = { which = ipc_mission_score value > 0 } }
					top_liege = {
						random_realm_lord = {
							limit = {
								higher_tier_than = baron
								liege = { tier = emperor }
								opinion_levy_raised_days = { who = liege days = 1 }
								NOR = {
									has_character_modifier = recompense_timer 
									character = ROOT
								}
							}
							preferred_limit = { opinion_levy_raised_days = { who = liege days = 300 } }
							preferred_limit = { opinion_levy_raised_days = { who = liege days = 200 } }
							preferred_limit = { opinion_levy_raised_days = { who = liege days = 100 } }
							add_character_modifier = { modifier = recompense_timer years = 1 hidden = yes }
							character_event = { id = ipcq.213 }
						}
					}
				}
				##steal some for yourself
				20 = {
					trigger = { check_variable = { which = ipc_mission_score value > 0 } }
					modifier = {
						factor = 1.5
						trait = greedy
					}
					modifier = {
						factor = 1.5
						trait = deceitful
					}
					modifier = {
						factor = 1.5
						trait = schemer
					}
					character_event = { id = ipcq.215 }
				}
				
				##enemy ambush
				20 = { 
					trigger = {
						has_dlc = "Holy Fury"
						check_variable = { which = ipc_mission_score value > 0 }
						top_liege = {
							any_current_enemy = {
								any_realm_character = {
									is_landed = no
									is_inaccessible_or_incapable_trigger = no
									has_minor_title = title_commander
									in_command = no
								}
							}
						}
					}
					modifier = {
						factor = 1.5
						top_liege = { any_current_enemy = { religion_group = pagan_group } }
					}
					top_liege = {
						random_current_enemy = {
							limit = {
								any_realm_character = {
									is_landed = no
									is_inaccessible_or_incapable_trigger = no
									has_minor_title = title_commander
								}
							}
							random_realm_character = {
								limit = {
									is_landed = no
									is_inaccessible_or_incapable_trigger = no
									has_minor_title = title_commander
									in_command = no
								}
								preferred_limit = { is_good_dueler_compared_to_prev_trigger = yes }
								preferred_limit = { is_decent_dueler_compared_to_prev_trigger = yes }
								preferred_limit = { is_ok_dueler_compared_to_prev_trigger = yes }
								preferred_limit = { is_bad_dueler_compared_to_prev_trigger = yes }
								character_event = { id = ipcq.216 }
							}
						}
					}
				}
				
				##no more available targets or out of money
				1000 = {
					trigger = {
						OR = {
							check_variable = { which = ipc_mission_score value <= 0 }
							NOT = {
								top_liege = {
									any_realm_lord = {
										opinion_levy_raised_days = { who = liege days = 1 } 
										NOT = { has_character_modifier = recompense_timer }
									}
								}
							}
						}
					}
					#fail mission
					if = {
						limit = { check_variable = { which = ipc_mission_score value <= 0 } }
						character_event = { id = ipcq.221 }
					}
					#partial success
					else = { character_event = { id = ipcq.220 } }
				}
			}
		}
	}
}


###lord recieves payment
character_event = {
	id = ipcq.213
	desc = EVTDESAipcq.213
	picture = GFX_evt_carriage
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAipcq.213
		show_portrait = top_liege
		set_opinion_levy_raised_days = { who = liege days = 0 }
		opinion = { modifier = opinion_grateful who = FROM years = 3 }
		hidden_tooltip = { FROM = { character_event = { id = ipcq.214 } } }
	}
}

###notify messenger
character_event = {
	id = ipcq.214
	desc = EVTDESAipcq.214
	picture = GFX_evt_carriage
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAipcq.214
		tooltip = { reverse_opinion = { modifier = opinion_grateful who = FROM years = 3 } }
		hidden_tooltip = { character_event = { id = ipcq.212 days = 10 random = 5 } }
	}
}

###steal some gold for yourself
character_event = {
	id = ipcq.215
	desc = EVTDESAipcq.215
	picture = GFX_evt_carriage
	
	is_triggered_only = yes
	
	#steal some
	option = {
		name = EVTOPTAipcq.215
		scaled_wealth = { value = 0.15 min = 20 max = 100 }
		hidden_tooltip = { change_variable = { which = ipc_mission_score value = -1 } }
		if = {
			limit = { trait = charitable }
			remove_trait = charitable
		}
		else_if = {
			limit = { NOT = { trait = greedy } }
			random = { chance = 66 add_trait = greedy }
		}
		else = { prestige = -50 }
		random_list = {
			90 = {}
			10 = {
				modifier = {
					factor = 0.8
					trait = deceitful
				}
				modifier = {
					factor = 0.7
					trait = schemer
				}
				reverse_opinion = { modifier = opinion_charge_traitor who = top_liege years = 3 }
			}
		}
		ai_chance = {
			factor = 20
			modifier = {
				factor = 0
				is_loyal_to_empire_trigger = yes
			}
			modifier = {
				factor = 0.5
				trait = content
			}
			modifier = {
				factor = 1.5
				wealth < 100
			}
			modifier = {
				factor = 1.5
				wealth < 200
			}
			modifier = {
				factor = 1.5
				trait = ambitious
			}
			modifier = {
				factor = 1.5
				trait = arbitrary
			}
			modifier = {
				factor = 2
				trait = greedy
			}
		}
		
	}
	#dont be stupid
	option = {
		name = EVTOPTBipcq.215
		prestige = 25
		ai_chance = { factor = 80 }
	}
	
	after = { hidden_tooltip = { character_event = { id = ipcq.212 days = 10 random = 5 } } }
}

####get ambushed by enemy commander, enemy ping
character_event = {
	id = ipcq.216
	
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		#need to set up targets
		save_event_target_as = combatant_1
		FROM = { 
			save_event_target_as = combatant_2 
			character_event = { id = ipcq.217 }
		}
	}
}

####get ambushed by enemy commander, notify character
character_event = {
	id = ipcq.217
	desc = EVTDESAipcq.217
	picture = GFX_evt_bandits
	
	is_triggered_only = yes
	
	#fight!
	option = {
		name = EVTOPTAipcq.217
		custom_tooltip = {
			text = EVTTOOLTIPAipcq.217
			FROM = { character_event = { id = ipcq.218 } }
		}
		ai_chance = { factor = 75 }
	}
	
	#run awaaay
	option = {
		name = EVTOPTBipcq.217
		if = {
			limit = { trait = brave }
			remove_trait = brave
		}
		else_if = {
			limit = { NOT = { trait = craven } }
			random = { chance = 66 add_trait = craven}
		}
		else = { prestige = -50 }
		custom_tooltip = {
			text = EVTTOOLTIPBipcq.217
			random_list = {
				33 = { change_variable = { which = ipc_mission_score value = -1 } }
				33 = {
					modifier = {
						factor = 2
						FROM = { trait = greedy }
					}
					modifier = {
						factor = 2
						FROM = { trait = ambitious }
					}
					modifier = {
						factor = 3
						FROM = { religion_group = pagan_group }
					}
					modifier = {
						factor = 4
						FROM = { this_is_sea_raider_trigger = yes }
					}
					change_variable = { which = ipc_mission_score value = -2 }
				}
				33 = { 
					modifier = {
						factor = 1.5
						FROM = { trait = greedy }
					}
					modifier = {
						factor = 1.5
						FROM = { trait = ambitious }
					}
					modifier = {
						factor = 2
						FROM = { religion_group = pagan_group }
					}
					modifier = {
						factor = 3
						FROM = { this_is_sea_raider_trigger = yes }
					}
					change_variable = { which = ipc_mission_score value = -3 }
				}
			}
			character_event = { id = ipcq.212 days = 10 random = 5 }
		}
		ai_chance = { 
			factor = 25
			modifier = {
				factor = 0.5
				trait = brave
			}
			modifier = {
				factor = 3
				duelist_skill_is_low_group_trigger = yes
				FROM = { duelist_skill_is_low_group_trigger = no }
			}
			modifier = {
				factor = 3
				OR = { 
					duelist_skill_is_low_group_trigger = yes
					duelist_skill_is_medium_group_trigger = yes
				}
				FROM = { duelist_skill_is_high_group_trigger = yes }
			}
			modifier = {
				factor = 3
				trait = craven
			}
		}
	}
}




####get ambushed by enemy commander, duel starts
character_event = {
	id = ipcq.218
	
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		
		
		#vanilla effects
		#Chooses a weapon for mainly loc purposes (but has a tiny effect on outcomes, too)...
        set_dueling_weapon_effect = yes
        event_target:combatant_2 = { set_dueling_weapon_effect = yes }
        
        #Chooses a body part for injury (if it occurs), also for loc purposes (effect handles both characters)
        set_potential_injury_flag_effect = yes

        #Scripted effect requiring event-targets combatant_1 & combatant_2! RAW NUMBERS...
        evaluate_duel_result_score_effect = yes

        #Room for extra special calculations... (based on traits, and other special circumstances?)
        evaluate_extra_duel_result_score_effect = yes

        #Send the correct result event (from random_list)...
        send_duel_result_event_effect = yes 
		
		
		FROM = { character_event = { id = ipcq.219 days = 3 } }
	}
}

###check result and go back to tombola, should only trigger if still alive
character_event = {
	id = ipcq.219
	desc = {
		trigger = { has_character_modifier = recent_duel_victory }
		text = EVTDESAipcq.219
		picture = GFX_evt_duel_scene
	}
	desc = {
		trigger = { NOT = { has_character_modifier = recent_duel_victory } }
		text = EVTDESBipcq.219
		picture = GFX_evt_bloody_man
	}
	picture = GFX_evt_duel_scene
	
	is_triggered_only = yes
	
	trigger = { is_alive = yes }
	
	option = {
		trigger = { has_character_modifier = recent_duel_victory }
		name = EVTOPTAipcq.219
		increase_duel_exp_modifier_effect = yes
		prestige = 50
	}
	
	#knocked out
	option = {
		trigger = { NOT = { has_character_modifier = recent_duel_victory } }
		name = EVTOPTBipcq.219
		custom_tooltip = {
			text = EVTTOOLTIPBipcq.219
			FROM = { increase_duel_exp_modifier_effect = yes }
			random_list = {
				33 = { change_variable = { which = ipc_mission_score value = -1 } }
				33 = {
					modifier = {
						factor = 2
						FROM = { trait = greedy }
					}
					modifier = {
						factor = 2
						FROM = { trait = ambitious }
					}
					modifier = {
						factor = 3
						FROM = { religion_group = pagan_group }
					}
					modifier = {
						factor = 4
						FROM = { this_is_sea_raider_trigger = yes }
					}
					change_variable = { which = ipc_mission_score value = -2 }
				}
				33 = { 
					modifier = {
						factor = 1.5
						FROM = { trait = greedy }
					}
					modifier = {
						factor = 1.5
						FROM = { trait = ambitious }
					}
					modifier = {
						factor = 2
						FROM = { religion_group = pagan_group }
					}
					modifier = {
						factor = 3
						FROM = { this_is_sea_raider_trigger = yes }
					}
					change_variable = { which = ipc_mission_score value = -3 }
				}
			}
		}
	}
	after = { 
		hidden_tooltip = { 
			remove_character_modifier = recent_duel_victory
			FROM = { remove_character_modifier = recent_duel_victory }
			clear_event_target = combatant_1
			clear_event_target = combatant_2
			character_event = { id = ipcq.212 days = 10 random = 5 }
		}
	}
}


####mission completed normally
character_event = {
	id = ipcq.220
	desc = EVTDESAipcq.220
	picture = GFX_evt_emissary
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAipcq.220
		if = {
			limit = { check_variable = { which = ipc_mission_flavor_counter value == 6 } }
			change_society_currency = 250
		}
		else_if = {
			limit = { check_variable = { which = ipc_mission_flavor_counter value >= 4 } }
			change_society_currency = 200
		}
		else_if = {
			limit = { check_variable = { which = ipc_mission_flavor_counter value >= 2 } }
			change_society_currency = 150
		}
		else = { change_society_currency = 100 }
		clr_quest = quest_ipc_distribute_levy_recompense
		add_imperial_service_opinion_effect = yes
		remove_character_modifier = out_traveling
	}
}

###mission failed
character_event = {
	id = ipcq.221
	desc = EVTDESAipcq.221
	picture = GFX_evt_carriage

	is_triggered_only = yes
	
	option = {
		name = EVTOPTAipcq.221
		clr_quest = {
			id = quest_ipc_distribute_levy_recompense
			failure = yes
		}
		add_failed_empire_opinion_effect = yes
		remove_character_modifier = out_traveling
	}
}



######Imperial Conquests
society_quest_event = {
	id = ipcq.230
	desc = {
		trigger = { FROMFROM = { tier = emperor } }
		text = EVTDESAipcq.230
	}
	desc = {
		trigger = { FROMFROM = { NOT = { tier = emperor } } }
		text = EVTDESBipcq.230
	}
	
	is_triggered_only = yes
	is_in_society = yes
	
	trigger = {
		is_imperial_court_member_trigger = yes
		has_any_quest = no
	}
	
	immediate = { 
		set_variable = { which = ipc_court_aid value = 0 } 
	}
	
	show_from_from = yes
	quest_target = event_target:imperial_conquest_target
	
	option = {
		name = ACCEPT
		event_target:imperial_conquest_target = {
			show_scope_change = no
			set_quest_target = {
				id = quest_ipc_imperial_conquest
				holder = ROOT
			}
		}
		if = {
			limit = { ai = yes }
			character_event = { id = ipcq.241 days = 3 }
		}
		
		ai_chance = { factor = 1 }
	}
	
	option  = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }
		
		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			years = 5
		}
		
		hidden_tooltip = { FROMFROM = { change_society_currency = 750 } }
		
		ai_chance = { factor = 0 }
	}
}

######when the war starts, send aid request to all landed members, then check if influence is high enough to appoint dynasty
character_event = {
	id = ipcq.231
	
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		society = {
			persistent_event_target:imperial_conquest_target = { save_event_target_as = imperial_conquest_target }
			
			##call for aid
			any_society_member = {
				limit = {
					society_rank < 4
					higher_tier_than = baron
					NOR = {
						character = ROOT
						is_vassal_or_below = ROOT
					}
				}
				character_event = { id = ipcq.232 }
			}
		}
		character_event = { id = ipcq.233 days = 3 }
		
		
		##high influence distribution
		if = {
			limit = { society_influence >= 60 }
			##choose dynasty members
			if = {
				limit = { any_dynasty_member = { can_be_given_imperial_conquest_land_trigger = yes } }
				character_event = { id = ipcq.234 days = 1 }
			}
			society = {
				any_society_member = {
					limit = {
						society_rank < 4
						higher_tier_than = baron
						NOT = { character = ROOT }
						any_dynasty_member = {
							NOT = { character = PREV }
							can_be_given_imperial_conquest_land_trigger = yes
						}
					}
					character_event = { id = ipcq.235 days = 5 }
				}
			}
			
			#calc scores
			character_event = { id = ipcq.236 days = 10 }
		}
	}
}

###call for aid, choose how much to donate
character_event = {
	id = ipcq.232
	desc = EVTDESAipcq.232
	picture = GFX_evt_armory
	
	is_triggered_only = yes
	
	trigger = { is_imperial_court_member_trigger = yes }
	
	##give lots of help
	option = {
		name = EVTOPTAipcq.232
		scaled_wealth = { value = -0.8 min = -200 max = -500 }
		capital_scope = { add_province_modifier = { modifier = pledged_to_imperial_conquest years = 3 } }
		change_society_currency = 50
		reverse_opinion = { modifier = opinion_grateful who = FROM years = 3 }
		hidden_tooltip = { 
			add_character_modifier = { modifier = ipc_large_pledge days = 20 hidden = yes }
			FROM = { change_variable = { which = ipc_court_aid value = 3 } } 
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0.5
				scaled_wealth < 0.8
			}
			modifier = {
				factor = 1.5
				is_loyal_to_empire_trigger = yes
			}
			modifier = {
				factor = 2
				opinion = { who = FROM value = 75 }
			}
			modifier = {
				factor = 2
				FROM = { diplomacy = 20 }
			}
			modifier = {
				factor = 2
				FROM = { prestige = 1500 }
			}
		}
	}
	
	##give decent help
	option = {
		name = EVTOPTBipcq.232
		scaled_wealth = { value = -0.4 min = -100 max = -300 }
		capital_scope = { add_province_modifier = { modifier = pledged_to_imperial_conquest years = 1 } }
		change_society_currency = 25
		hidden_tooltip = { 
			add_character_modifier = { modifier = ipc_medium_pledge days = 20 hidden = yes }
			FROM = { change_variable = { which = ipc_court_aid value = 2 } } 
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0.5
				scaled_wealth < 0.4
			}
			modifier = {
				factor = 1.25
				is_loyal_to_empire_trigger = yes
			}
			modifier = {
				factor = 1.5
				opinion = { who = FROM value = 50 }
			}
			modifier = {
				factor = 1.5
				FROM = { diplomacy = 14 }
			}
			modifier = {
				factor = 1.5
				FROM = { prestige = 1000 }
			}
		}
	}
	
	##give little help
	option = {
		name = EVTOPTCipcq.232
		scaled_wealth = { value = -0.2 min = -50 max = -150 }
		hidden_tooltip = { 
			add_character_modifier = { modifier = ipc_small_pledge days = 20 hidden = yes }
			FROM = { change_variable = { which = ipc_court_aid value = 1 } } 
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0.5
				scaled_wealth < 0.2
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROM value = 25 }
			}
			modifier = {
				factor = 1.25
				FROM = { diplomacy = 8 }
			}
			modifier = {
				factor = 1.25
				FROM = { prestige = 500 }
			}
		}
	}
	
	##give nothing
	option = {
		name = EVTOPTDipcq.232
		reverse_opinion = { modifier = opinion_disappointed who = FROM years = 3 }
		change_society_currency = -25
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0
				is_loyal_to_empire_trigger = yes
			}
			modifier = {
				factor = 3
				OR = {
					is_foe = FROM
					FROM = { is_foe = ROOT }
				}
			}
		}
	}
}

###attacker gets troops
character_event = {
	id = ipcq.233
	desc = EVTDESAipcq.233
	picture = GFX_evt_armory
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAipcq.233
		custom_tooltip = {
			text = EVTTOOLTIPAipcq.233
			while = {
				limit = { check_variable = { which = ipc_court_aid value > 0 } }
				change_variable = { which = ipc_court_aid value = -1 }
			
				capital_scope = {
					ROOT = {
						random_list = {
							15 = { 
								spawn_unit = {
									owner = ROOT
									province = PREV
									home = PREV
									troops = { light_infantry = { 300 300 } }
									attrition = 1.0
									maintenance_multiplier = 0.25
									reinforces = yes
									merge = yes
									disband_on_peace = yes
								}
							}
							30 = { 
								spawn_unit = {
									owner = ROOT
									province = PREV
									home = PREV
									troops = { heavy_infantry = { 150 150 } }
									attrition = 1.0
									maintenance_multiplier = 0.25
									reinforces = yes
									merge = yes
									disband_on_peace = yes
								}
							} 
							15 = { 
								spawn_unit = {
									owner = ROOT
									province = PREV
									home = PREV
									troops = { pikemen = { 150 150 } }
									attrition = 1.0
									maintenance_multiplier = 0.25
									reinforces = yes
									merge = yes
									disband_on_peace = yes
								}
							}
							20 = { 
								spawn_unit = {
									owner = ROOT
									province = PREV
									home = PREV
									troops = { archers = { 250 250 } }
									attrition = 1.0
									maintenance_multiplier = 0.25
									reinforces = yes
									merge = yes
									disband_on_peace = yes
								}
							}
							15 = { 
								spawn_unit = {
									owner = ROOT
									province = PREV
									home = PREV
									troops = { light_cavalry  = { 150 150 } }
									attrition = 1.0
									maintenance_multiplier = 0.25
									reinforces = yes
									merge = yes
									disband_on_peace = yes
								}
							}
							5 = { 
								spawn_unit = {
									owner = ROOT
									province = PREV
									home = PREV
									troops = { knights = { 100 100 } }
									attrition = 1.0
									maintenance_multiplier = 0.25
									reinforces = yes
									merge = yes
									disband_on_peace = yes
								}
							}
						}
					}
				}
			}
		}
	}
}

###choose dynasty member for mission guy
character_event = {
	id = ipcq.234
	desc = EVTDESAipcq.234
	picture = GFX_evt_powerful_ruler
	
	is_triggered_only = yes
	
	immediate = {
		random_dynasty_member = {
			limit = { can_be_given_imperial_conquest_land_trigger = yes }
			preferred_limit = { 
				age < 30 
				religion = ROOT
				is_ill = no
			}
			save_event_target_as = candidate_1
		}
		random_dynasty_member = {
			limit = { 
				can_be_given_imperial_conquest_land_trigger = yes 
				NOT = { character = event_target:candidate_1 }
			}
			preferred_limit = { 
				age < 30 
				religion = ROOT
				is_ill = no
			}
			save_event_target_as = candidate_2
		}
		random_dynasty_member = {
			limit = { 
				can_be_given_imperial_conquest_land_trigger = yes 
				NOR = { 
					character = event_target:candidate_1 
					character = event_target:candidate_2
				}
			}
			preferred_limit = { 
				age < 30 
				religion = ROOT
				is_ill = no
			}
			save_event_target_as = candidate_3
		}
	}
	
	option = {
		trigger = { event_target:candidate_1 = { always = yes } }
		name = EVTOPTAipcq.234
		show_portrait = event_target:candidate_1
		save_persistent_event_target = { name = imperial_conquest_candidate_1 scope = event_target:candidate_1 }
		ai_chance = { factor = 33 }
	}
	option = {
		trigger = { event_target:candidate_2 = { always = yes } }
		name = EVTOPTBipcq.234
		show_portrait = event_target:candidate_2
		save_persistent_event_target = { name = imperial_conquest_candidate_1 scope = event_target:candidate_2 }
		ai_chance = { factor = 33 }
	}
	option = {
		trigger = { event_target:candidate_3 = { always = yes } }
		name = EVTOPTCipcq.234
		show_portrait = event_target:candidate_3
		save_persistent_event_target = { name = imperial_conquest_candidate_1 scope = event_target:candidate_3 }
		ai_chance = { factor = 33 }
	}
	
	option = { 
		name = EVTOPTDipcq.234 
		ai_chance = { factor = 0 }
	}
}

###choose dynasty member for society members
character_event = {
	id = ipcq.235
	desc = EVTDESAipcq.235
	picture = GFX_evt_powerful_ruler
	
	is_triggered_only = yes
	
	immediate = {
		add_character_modifier = { modifier = imperial_conquest_chose_dynasty days = 20 hidden = yes }
		random_dynasty_member = {
			limit = { can_be_given_imperial_conquest_land_trigger = yes }
			preferred_limit = { 
				age < 30 
				religion = ROOT
				is_ill = no
			}
			save_event_target_as = candidate_1
		}
		random_dynasty_member = {
			limit = { 
				can_be_given_imperial_conquest_land_trigger = yes 
				NOT = { character = event_target:candidate_1 }
			}
			preferred_limit = { 
				age < 30 
				religion = ROOT
				is_ill = no
			}
			save_event_target_as = candidate_2
		}
		random_dynasty_member = {
			limit = { 
				can_be_given_imperial_conquest_land_trigger = yes 
				NOR = { 
					character = event_target:candidate_1 
					character = event_target:candidate_2
				}
			}
			preferred_limit = { 
				age < 30 
				religion = ROOT
				is_ill = no
			}
			save_event_target_as = candidate_3
		}
	}
	
	option = {
		trigger = { event_target:candidate_1 = { always = yes } }
		name = EVTOPTAipcq.235
		show_portrait = event_target:candidate_1
		event_target:candidate_1 = { add_character_modifier = { modifier = imperial_conquest_dynasty_candidate days = 20 hidden = yes } }
		ai_chance = { factor = 33 }
	}
	option = {
		trigger = { event_target:candidate_2 = { always = yes } }
		name = EVTOPTBipcq.235
		show_portrait = event_target:candidate_2
		event_target:candidate_2 = { add_character_modifier = { modifier = imperial_conquest_dynasty_candidate days = 20 hidden = yes } }
		ai_chance = { factor = 33 }
	}
	option = {
		trigger = { event_target:candidate_3 = { always = yes } }
		name = EVTOPTCipcq.235
		show_portrait = event_target:candidate_3
		event_target:candidate_3 = { add_character_modifier = { modifier = imperial_conquest_dynasty_candidate days = 20 hidden = yes } }
		ai_chance = { factor = 33 }
	}
	
	option = { 
		name = EVTOPTDipcq.235
		hidden_tooltip = { remove_character_modifier = imperial_conquest_chose_dynasty }
		ai_chance = { factor = 0 }
	}
}


###determine who should get land at the end
character_event = {
	id = ipcq.236
	
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		society = {
			
			any_society_member = {
				limit = { has_character_modifier = imperial_conquest_chose_dynasty }
				score_value = { 
					value = 1
					additive_modifier = {
						value = 5 
						has_unique_imperial_office_trigger = yes
					}
					additive_modifier = {
						value = 10 
						society_rank == 3
					}
					additive_modifier = {
						value = 5 
						society_rank == 2
					}
					additive_modifier = {
						value = 10 
						tier = king
					}
					additive_modifier = { 
						value = 5 
						tier = duke
					}
					additive_modifier = {
						value = 5
						trait = ipc_imperial_aristrocrat
					}
					additive_modifier = {
						value = 5
						prestige = 2000
					}
					additive_modifier = {
						value = 5
						prestige = 1000
					}
					additive_modifier = {
						value = 5
						prestige = 500
					}
					additive_modifier = {
						value = 5
						dynastic_prestige = 750
					}
					additive_modifier = {
						value = 5
						dynastic_prestige = 500
					}
					additive_modifier = {
						value = 5
						dynastic_prestige = 250
					}
				}
				#largest duchy has 6 counties
				count = 6
				
				random_dynasty_member = {
					limit = { has_character_modifier = imperial_conquest_dynasty_candidate }
					if = {
						limit = { ROOT = { NOT = { persistent_event_target:imperial_conquest_candidate_1 = { always = yes } } } }
						ROOT = { save_persistent_event_target = { name = imperial_conquest_candidate_1 scope = PREV } }
					}
					else_if = {
						limit = { 
							ROOT = { 
								persistent_event_target:imperial_conquest_candidate_1 = { always = yes } 
								NOT = { persistent_event_target:imperial_conquest_candidate_2 = { always = yes } }
							} 
						}
						ROOT = { save_persistent_event_target = { name = imperial_conquest_candidate_2 scope = PREV } }
					}
					else_if = {
						limit = { 
							ROOT = { 
								persistent_event_target:imperial_conquest_candidate_2 = { always = yes } 
								NOT = { persistent_event_target:imperial_conquest_candidate_3 = { always = yes } }
							} 
						}
						ROOT = { save_persistent_event_target = { name = imperial_conquest_candidate_3 scope = PREV } }
					}
					else_if = {
						limit = { 
							ROOT = { 
								persistent_event_target:imperial_conquest_candidate_3 = { always = yes } 
								NOT = { persistent_event_target:imperial_conquest_candidate_4 = { always = yes } }
							} 
						}
						ROOT = { save_persistent_event_target = { name = imperial_conquest_candidate_4 scope = PREV } }
					}
					else_if = {
						limit = { 
							ROOT = { 
								persistent_event_target:imperial_conquest_candidate_4 = { always = yes } 
								NOT = { persistent_event_target:imperial_conquest_candidate_5 = { always = yes } }
							} 
						}
						ROOT = { save_persistent_event_target = { name = imperial_conquest_candidate_5 scope = PREV } }
					}
					else_if = {
						limit = { 
							ROOT = { 
								persistent_event_target:imperial_conquest_candidate_5 = { always = yes } 
								NOT = { persistent_event_target:imperial_conquest_candidate_6 = { always = yes } }
							} 
						}
						ROOT = { save_persistent_event_target = { name = imperial_conquest_candidate_6 scope = PREV } }
					}
				}
			}
			
		}
	}
}


###manage land at end of war
character_event = {
	id = ipcq.237
	
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		society = { clear_persistent_event_target = imperial_conquest_target }
		
		##low influence everything goes to emperor
		if = {
			limit = { society_influence < 60 }
			any_demesne_title = {
				limit = { has_title_flag = imperial_conquest_distribute }
				clr_title_flag = imperial_conquest_distribute
				holder_scope = { top_liege = { grant_title = PREVPREV } }
			}
		}
		
		else_if = {
			limit = { society_influence >= 60 }
			set_variable = { which = imperial_conquest_counties_count value = 0 }
			
			#baronies get auto created chars
			any_demesne_title = {
				limit = { 
					tier = baron
					has_title_flag = imperial_conquest_distribute 
				}
				clr_title_flag = imperial_conquest_distribute
				create_character = {
					random_traits = yes
					dynasty = random
					female = no
					religion = top_liege
					culture = top_liege
				}
				new_character = { grant_title = PREV }
			}
			
			##distribute counties
			any_demesne_title = {
				limit = { 
					tier = count
					has_title_flag = imperial_conquest_distribute 
				}
				ROOT = { change_variable = { which = imperial_conquest_counties_count value = 1 } }
			}
			#leave top candidate for last, to give duchy and transfer vassals
			while = {
				limit = { check_variable = { which = imperial_conquest_counties_count value > 1 } }
				change_variable = { which = imperial_conquest_counties_count value = -1 }
				random_demesne_title = {
					limit = {
						tier = count
						has_title_flag = imperial_conquest_distribute
					}
					clr_title_flag = imperial_conquest_distribute
					if = {
						limit = {
							ROOT = { 
								persistent_event_target:imperial_conquest_candidate_2 = { 
									always = yes 
									is_landed = no
								}
							}
						}
						ROOT = { persistent_event_target:imperial_conquest_candidate_2 = { grant_title = PREVPREV } }
					}
					else_if = {
						limit = {
							ROOT = { 
								persistent_event_target:imperial_conquest_candidate_3 = { 
									always = yes 
									is_landed = no
								}
							}
						}
						ROOT = { persistent_event_target:imperial_conquest_candidate_3 = { grant_title = PREVPREV } }
					}
					else_if = {
						limit = {
							ROOT = { 
								persistent_event_target:imperial_conquest_candidate_4 = { 
									always = yes 
									is_landed = no
								}
							}
						}
						ROOT = { persistent_event_target:imperial_conquest_candidate_4 = { grant_title = PREVPREV } }
					}
					else_if = {
						limit = {
							ROOT = { 
								persistent_event_target:imperial_conquest_candidate_5 = { 
									always = yes 
									is_landed = no
								}
							}
						}
						ROOT = { persistent_event_target:imperial_conquest_candidate_5 = { grant_title = PREVPREV } }
					}
					else_if = {
						limit = {
							ROOT = { 
								persistent_event_target:imperial_conquest_candidate_6 = { 
									always = yes 
									is_landed = no
								}
							}
						}
						ROOT = { persistent_event_target:imperial_conquest_candidate_6 = { grant_title = PREVPREV } }
					}
				}
			}
			any_demesne_title = {
				limit = { has_title_flag = imperial_conquest_distribute }
				clr_title_flag = imperial_conquest_distribute
				ROOT = { persistent_event_target:imperial_conquest_candidate_1 = { grant_title = PREVPREV } }
			}
			
			clear_persistent_event_target = imperial_conquest_candidate_1
			clear_persistent_event_target = imperial_conquest_candidate_2
			clear_persistent_event_target = imperial_conquest_candidate_3
			clear_persistent_event_target = imperial_conquest_candidate_4
			clear_persistent_event_target = imperial_conquest_candidate_5
			clear_persistent_event_target = imperial_conquest_candidate_6
		}
	}
}

###war won, mission complete
character_event = {
	id = ipcq.238
	desc = EVTDESAipcq.238
	picture = GFX_evt_prospering_province
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAipcq.238
		change_society_currency = 500
		clr_quest = quest_ipc_imperial_conquest
		add_imperial_service_opinion_effect = yes
		hidden_tooltip = { top_liege = { primary_title = { ROOT = { save_persistent_event_target = { name = champion_realm scope = PREV } } } } }
		add_character_modifier = { modifier = ipc_imperial_champion years = 10 }
	}
}

###war draw, mission failed
character_event = {
	id = ipcq.239
	desc = EVTDESAipcq.239
	picture = GFX_evt_battle
	
	is_triggered_only = yes
	
	immediate = { society = { clear_persistent_event_target = imperial_conquest_target } }
	
	option = {
		name = EVTOPTAipcq.239
		change_society_currency = -250
		clr_quest = {
			id = quest_ipc_imperial_conquest
			failure = yes
		}
		add_failed_empire_opinion_effect = yes
	}
}

###war lost, mission failed
character_event = {
	id = ipcq.240
	desc = EVTDESAipcq.240
	picture = GFX_evt_judged_by_ruler
	
	is_triggered_only = yes
	
	immediate = { society = { clear_persistent_event_target = imperial_conquest_target } }
	
	option = {
		name = EVTOPTAipcq.240
		change_society_currency = -500
		clr_quest = {
			id = quest_ipc_imperial_conquest
			failure = yes
		}
		add_failed_empire_opinion_effect = yes
		add_character_modifier = { modifier = publicly_humiliated years = 2 } 
	}
}


###ai conquest nudge
character_event = {
	id = ipcq.241
	
	is_triggered_only = yes
	hide_window = yes
	
	trigger = { 
		is_imperial_court_member_trigger = yes 
		has_quest = quest_ipc_imperial_conquest
	}
	
	immediate = {
		if = {
			limit = { NOT = { any_war = { using_cb = ipc_imperial_conquest} } }
			quest_target = { 
				holder_scope = {
					if = {
						limit = { independent = yes }
						ROOT = { war = { target = PREV casus_belli = ipc_imperial_conquest thirdparty_title = PREVPREV tier = duke } }
					}
					else = {
						top_liege = {
							ROOT = { war = { target = PREV casus_belli = ipc_imperial_conquest thirdparty_title = PREVPREVPREV tier = duke } }
						}
					}
				}
			}
		}
	}
}

###ai war invalid, nudge again, trigger by on_action
character_event = {
	id = ipcq.242
	
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		FROM = {
			is_imperial_court_member_trigger = yes 
			has_quest = quest_ipc_imperial_conquest
		}
	}
	
	immediate = {
		FROM = { save_event_target_as = ai_war_again }
		if = {
			limit = { NOT = { any_war = { using_cb = ipc_imperial_conquest} } }
			quest_target = { 
				holder_scope = {
					if = {
						limit = { independent = yes }
						event_target:ai_war_again = { war = { target = PREV casus_belli = ipc_imperial_conquest thirdparty_title = PREVPREV tier = duke } }
					}
					else = {
						top_liege = {
							event_target:ai_war_again = { war = { target = PREV casus_belli = ipc_imperial_conquest thirdparty_title = PREVPREVPREV tier = duke } }
						}
					}
				}
			}
		}
	}
}


############Lawkeeper############

society_quest_event = {
	id = ipcq.300
	desc = EVTDESAipcq.300
	
	is_triggered_only = yes
	is_in_society = yes
	
	trigger = {
		is_imperial_court_member_trigger = yes
		has_any_quest = no
	}
	
	show_from_from = yes
	quest_target = event_target:change_culture_target
	
	option = {
		name = ACCEPT
		event_target:change_culture_target = {
			show_scope_change = no
			set_quest_target = {
				id = quest_ipc_change_culture
				holder = ROOT
			}
		}
		custom_tooltip = {
			text = ipc_mission_diplomacy_or_learning_bonus_tooltip
			event_target:change_culture_target = { character_event = { id = ipcq.301 } }
		}
		ai_chance = { factor = 1 }
	}
	
	option  = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }
		
		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			years = 5
		}
		
		hidden_tooltip = { FROMFROM = { change_society_currency = 150 } }
		
		ai_chance = { factor = 0 }
	}
}

##ping to target
character_event = {
	id = ipcq.301
	
	hide_window = yes
	is_triggered_only = yes
	
	immediate = { FROM = { character_event = { id = ipcq.302 days = 30 } } }
}

##mission begins, choose how to proceed
character_event = {
	id = ipcq.302
	desc = EVTDESAipcq.302
	picture = GFX_evt_shady_meeting
	
	is_triggered_only = yes
	
	##convince with words
	option = {
		name = EVTOPTAipcq.302
		custom_tooltip = {
			text = EVTTOOLTIPAipcq.302
			set_character_flag = mission_diplomacy_route
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1.1
				diplomacy = 4
			}
			modifier = {
				factor = 1.1
				diplomacy = 8
			}
			modifier = {
				factor = 1.1
				diplomacy = 12
			}
			modifier = {
				factor = 1.1
				diplomacy = 16
			}
			modifier = {
				factor = 1.1
				diplomacy = 20
			}
			modifier = {
				factor = 0.9
				FROM = { diplomacy = 4 }
			}
			modifier = {
				factor = 0.9
				FROM = { diplomacy = 8 }
			}
			modifier = {
				factor = 0.9
				FROM = { diplomacy = 12 }
			}
			modifier = {
				factor = 0.9
				FROM = { diplomacy = 16 }
			}
			modifier = {
				factor = 0.9
				FROM = { diplomacy = 20 }
			}
		}
	}
	
	##show our ways
	option = {
		name = EVTOPTBipcq.302
		custom_tooltip = {
			text = EVTTOOLTIPBipcq.302
			set_character_flag = mission_learning_route
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1.1
				learning = 4
			}
			modifier = {
				factor = 1.1
				learning = 8
			}
			modifier = {
				factor = 1.1
				learning = 12
			}
			modifier = {
				factor = 1.1
				learning = 16
			}
			modifier = {
				factor = 1.1
				learning = 20
			}
			modifier = {
				factor = 0.9
				FROM = { learning = 4 }
			}
			modifier = {
				factor = 0.9
				FROM = { learning = 8 }
			}
			modifier = {
				factor = 0.9
				FROM = { learning = 12 }
			}
			modifier = {
				factor = 0.9
				FROM = { learning = 16 }
			}
			modifier = {
				factor = 0.9
				FROM = { learning = 20 }
			}
		}
	}
	
	##threaten
	option = {
		name = EVTOPTCipcq.302
		custom_tooltip = {
			text = EVTTOOLTIPCipcq.302
			set_character_flag = mission_threaten_route
		}
		if = {
			limit = { NOT = { trait = cruel } }
			random = { chance = 20 add_trait = cruel }
		}
		ai_chance = {
			factor = 20
			modifier = {
				factor = 0.25
				is_liege_of = FROM
			}
			modifier = {
				factor = 0.25
				OR = {
					trait = kind
					trait = just
				}
			}
			modifier = {
				factor = 0.75
				trait = shrewd
			}
			modifier = {
				factor = 0.75
				trait = socializer
			}
			modifier = {
				factor = 0.75
				trait = gregarious
			}
			modifier = {
				factor = 1.25
				trait = impaler
			}
			modifier = {
				factor = 1.25
				trait = wroth
			}
			modifier = {
				factor = 1.25
				trait = cruel
			}
			modifier = {
				factor = 1.25
				FROM = { trait = craven }
			}
		}
	}
	
	after = { hidden_tooltip = { FROM = { character_event = { id = ipcq.303 days = 5 } } } }
}

##target gets first approach
character_event = {
	id = ipcq.303
	desc = {
		trigger = { FROM = { has_character_flag = mission_diplomacy_route } }
		text = EVTDESAipcq.303
	}
	desc = {
		trigger = { FROM = { has_character_flag = mission_learning_route } }
		text = EVTDESBipcq.303
	}
	desc = {
		trigger = { FROM = { has_character_flag = mission_threaten_route } }
		text = EVTDESCipcq.303
	}
	picture = GFX_evt_shady_meeting
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { FROM = { has_character_flag = mission_diplomacy_route } }
			export_to_variable = { which = attribute_score value = diplomacy who = FROM }
			export_to_variable = { which = target_attribute_score value = diplomacy }
		}
		else_if = {
			limit = { FROM = { has_character_flag = mission_learning_route } }
			export_to_variable = { which = attribute_score value = learning who = FROM }
			export_to_variable = { which = target_attribute_score value = learning }
		}
		if = {
			limit = { FROM = { NOT = { has_character_flag = mission_threaten_route } } }
			subtract_variable = { which = target_attribute_score which = attribute_score }
		}
	}
	
	#agree to continue
	option = {
		trigger = { NOT = { FROM = { has_character_flag = mission_threaten_route } } }
		name = EVTOPTAipcq.303
		custom_tooltip = {
			text = EVTTOOLTIPAipcq.303
			FROM = { set_character_flag = continue_mission }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1.1
				check_variable = { which = target_attribute_score value <= -1 }
			}
			modifier = {
				factor = 1.2
				check_variable = { which = target_attribute_score value <= -2 }
			}
			modifier = {
				factor = 1.3
				check_variable = { which = target_attribute_score value <= -3 }
			}
			modifier = {
				factor = 1.4
				check_variable = { which = target_attribute_score value <= -4 }
			}
			modifier = {
				factor = 1.5
				check_variable = { which = target_attribute_score value <= -5 }
			}
			modifier = {
				factor = 1.25
				FROM = { trait = shrewd }
			}
			modifier = {
				factor = 1.25
				FROM = { trait = socializer }
			}
			modifier = {
				factor = 1.25
				FROM = { trait = gregarious }
			}
			modifier = {
				factor = 1.5
				FROM = { is_liege_of = ROOT }
			}
		}
	}
	
	#flat out decline
	option = {
		trigger = { NOT = { FROM = { has_character_flag = mission_threaten_route } } }
		name = EVTOPTBipcq.303
		custom_tooltip = {
			text = EVTTOOLTIPBipcq.303
			FROM = { set_character_flag = mission_failure }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1.1
				check_variable = { which = target_attribute_score value >= 1 }
			}
			modifier = {
				factor = 1.2
				check_variable = { which = target_attribute_score value >= 2 }
			}
			modifier = {
				factor = 1.3
				check_variable = { which = target_attribute_score value >= 3 }
			}
			modifier = {
				factor = 1.4
				check_variable = { which = target_attribute_score value >= 4 }
			}
			modifier = {
				factor = 1.5
				check_variable = { which = target_attribute_score value >= 5 }
			}
			modifier = {
				factor = 1.25
				FROM = { trait = shrewd }
			}
			modifier = {
				factor = 1.25
				FROM = { trait = socializer }
			}
			modifier = {
				factor = 1.25
				FROM = { trait = gregarious }
			}
		}
	}
	
	
	#threaten success
	option = {
		trigger = { FROM = { has_character_flag = mission_threaten_route } }
		name = EVTOPTCipcq.303
		culture = FROM
		opinion = { modifier = opinion_hate who = FROM years = 10 }
		hidden_tooltip = { FROM = { set_character_flag = threaten_success } }
		ai_chance = {
			factor = 65
			modifier = {
				factor = 2
				FROM = { trait = impaler }
			}
			modifier = {
				factor = 2
				FROM = { trait = wroth }
			}
			modifier = {
				factor = 2
				FROM = { trait = cruel }
			}
			modifier = {
				factor = 2
				trait = craven
			}
			modifier = {
				factor = 1.5
				tier = count
				NOT = { higher_tier_than = count }
			}
			modifier = {
				factor = 1.5
				FROM = { is_liege_of = ROOT }
			}
		}
	}
	
	#threaten failure
	option = {
		trigger = { FROM = { has_character_flag = mission_threaten_route } }
		name = EVTOPTDipcq.303
		opinion = { modifier = opinion_hate who = FROM years = 10 }
		hidden_tooltip = { FROM = { set_character_flag = threaten_fail } }
		ai_chance = {
			factor = 35
			modifier = {
				factor = 5
				trait = brave
			}
			modifier = {
				factor = 1.25
				tier = duke
			}
			modifier = {
				factor = 2
				tier = king
			}
		}
	}
	after = { FROM = { character_event = { id = ipcq.304 days = 5 } } }
}


###get initial results, continue or fail
character_event = {
	id = ipcq.304
	desc = {
		trigger = { has_character_flag = continue_mission }
		text = EVTDESAipcq.304
	}
	desc = {
		trigger = { has_character_flag = mission_failure }
		text = EVTDESBipcq.304
	}
	desc = {
		trigger = { has_character_flag = threaten_success }
		text = EVTDESCipcq.304
	}
	desc = {
		trigger = { has_character_flag = threaten_fail }
		text = EVTDESDipcq.304
	}
	picture = GFX_evt_shady_meeting
	
	is_triggered_only = yes
	
	#continue
	option = {
		trigger = { has_character_flag = continue_mission }
		name = EVTOPTAipcq.304
		change_society_currency = 200
		clr_quest = quest_ipc_change_culture
		custom_tooltip = {
			text = EVTTOOLTIPAipcq.304
			FROM = { character_event = { id = ipcq.305 days = 20 } } 
		}
	}
	
	#fail
	option = {
		trigger = { has_character_flag = mission_failure }
		name = EVTOPTBipcq.304
		clr_quest = {
			id = quest_ipc_change_culture
			failure = yes
		}
	}
	
	
	#threaten success
	option = {
		trigger = { has_character_flag = threaten_success }
		name = EVTOPTCipcq.304
		change_society_currency = 200
		clr_quest = quest_ipc_change_culture
	}
	
	
	#threaten fail, fail mission
	option = {
		trigger = { has_character_flag = threaten_fail }
		name = EVTOPTDipcq.304
		prestige = -100
		clr_quest = {
			id = quest_ipc_change_culture
			failure = yes
		}
	}
	
	
	after = {
		hidden_tooltip = {
			FROM = {
				set_variable = { which = attribute_score value = 0 }
				set_variable = { which = target_attribute_score value = 0 }
			}
		}
		clr_character_flag = mission_diplomacy_route
		clr_character_flag = mission_learning_route
		clr_character_flag = mission_threaten_route
		clr_character_flag = continue_mission
		clr_character_flag = mission_failure
		clr_character_flag = threaten_success
		clr_character_flag = threaten_fail
	}
}

###convert the target, attempt to convert heir
character_event = {
	id = ipcq.305
	desc = EVTDESAipcq.305
	picture = GFX_evt_shady_meeting
	
	is_triggered_only = yes
	
	#convert heir too
	option = {
		name = EVTOPTAipcq.305
		culture = FROM
		if = {
			limit = { current_heir = { ai = yes } }
			current_heir = {
				random_list = {
					66 = { culture = FROM }
					33 = {}
				}
			}
		}
	}
	
	#dont convert heir
	option = {
		name = EVTOPTBipcq.305
		culture = FROM
	}
}


##organize festival
society_quest_event = {
	id = ipcq.310
	desc = EVTDESAipcq.310
	
	is_triggered_only = yes
	is_in_society = yes
	
	trigger = {
		is_imperial_court_member_trigger = yes
		has_any_quest = no
	}
	
	option = {
		name = ACCEPT
		set_quest = quest_ipc_organize_festival
		custom_tooltip = {
			text = ipc_mission_diplomacy_bonus_tooltip
			character_event = { id = ipcq.311 days = 30 }
		}
		ai_chance = { factor = 1 }
	}
	
	option  = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }
		
		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			years = 5
		}
		
		hidden_tooltip = { FROMFROM = { change_society_currency = 500 } }
		
		ai_chance = { factor = 0 }
	}
}


###choose location
character_event = {
	id = ipcq.311
	desc = EVTDESAipcq.311
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	immediate = { 
		reset_ipc_mission_variables_effect = yes 
		top_liege = {
			random_realm_province = {
				limit = { revolt_risk > 0 }
				preferred_limit = { revolt_risk >= 20 }
				preferred_limit = { revolt_risk >= 15 }
				preferred_limit = { revolt_risk >= 10 }
				preferred_limit = { revolt_risk >= 5 }
				save_event_target_as = province_1
			}
			random_realm_province = {
				limit = {
					NOT = { province = event_target:province_1 }
					revolt_risk > 0 
				}
				preferred_limit = { revolt_risk >= 20 }
				preferred_limit = { revolt_risk >= 15 }
				preferred_limit = { revolt_risk >= 10 }
				preferred_limit = { revolt_risk >= 5 }
				save_event_target_as = province_2
			}
		}
	}
	
	##province 1
	option = {
		name = EVTOPTAipcq.311
		hidden_tooltip = { event_target:province_1 = { save_event_target_as = mission_province } }
		ai_chance = {
			factor = 33
			modifier = {
				factor = 5
				event_target:province_1 = { revolt_risk > 5 }
			}
		}
	}
	
	##province 2
	option = {
		name = EVTOPTBipcq.311
		hidden_tooltip = { event_target:province_2 = { save_event_target_as = mission_province } }
		ai_chance = {
			factor = 33
			modifier = {
				factor = 5
				event_target:province_2 = { revolt_risk > 5 }
			}
		}
	}
	
	##your home
	option = {
		trigger = { higher_tier_than = baron }
		name = EVTOPTCipcq.311
		hidden_tooltip = { capital_scope = { save_event_target_as = mission_province } }
		ai_chance = {
			factor = 33
			modifier = {
				factor = 5
				capital_scope = { revolt_risk > 0 }
			}
		}
	}
	
	after = { hidden_tooltip = { character_event = { id = ipcq.312 days = 30 } } }
}

####get entertainment, opens more random events the better u get
character_event = {
	id = ipcq.312
	desc = EVTDESAipcq.312
	picture = GFX_evt_jugglers

	is_triggered_only = yes
	
	immediate = {
		add_character_modifier = { modifier = holding_summer_fair months = 2 }
		set_character_flag = summer_fair_begin
	}
	
	#lots of stuff
	option = {
		name = EVTOPTAipcq.312 
		scaled_wealth = { value = -0.6 min = -50 max = -300 }
		hidden_tooltip = { set_character_flag = mission_large_entertainment }
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0.5 
				scaled_wealth < 0.6
			}
			modifier = {
				factor = 2
				is_loyal_to_empire_trigger = yes
			}
			modifier = {
				factor = 2
				trait = charitable
			}
		}
	}
	
	#decent amount
	option = {
		name = EVTOPTBipcq.312 
		scaled_wealth = { value = -0.4 min = -25 max = -200 }
		hidden_tooltip = { set_character_flag = mission_medium_entertainment }
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.5 
				scaled_wealth < 0.4
			}
		}
	}
	
	#be a cheapskate
	option = {
		name = EVTOPTCipcq.312
		scaled_wealth = { value = -0.2 min = -10 max = -100 }
		ai_chance = {
			factor = 25
			modifier = {
				factor = 2
				trait = greedy
			}
		}
	}
	
	after = { hidden_tooltip = { character_event = { id = ipcq.313 days = 10 } } }
}

####festival begins
character_event = {
	id = ipcq.313
	desc = EVTDESAipcq.313
	picture = GFX_evt_jugglers
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAipcq.313
		hidden_tooltip = {
			if = {
				limit = { has_character_flag = mission_large_entertainment }
				set_variable = { which = ipc_mission_score value = 4 }
			}
			else_if = {
				limit = { has_character_flag = mission_medium_entertainment }
				set_variable = { which = ipc_mission_score value = 3 }
			}
			else = { set_variable = { which = ipc_mission_score value = 2 } }
			character_event = { id = ipcq.314 days = 1 }
		}
	}
}


####yet another tombola
character_event = {
	id = ipcq.314
	
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		clr_character_flag = fair_event_happened
		if = {
			limit = { capital_scope = { has_province_modifier = peasants_upset } }
			capital_scope = { remove_province_modifier = peasants_upset }
			change_variable = { which = ipc_mission_score value = -1 }
		}
		
		if = {
			limit = { check_variable = { which = ipc_mission_score value <= 0 } } 
			character_event = { id = ipcq.319 days = 5 }
		}
		else_if = {
			limit = { check_variable = { which = ipc_mission_flavor_counter value == 5 } } 
			character_event = { id = ipcq.318 days = 5 }
		}
		else = {
			change_variable = { which = ipc_mission_flavor_counter value = 1 }
			random_list = {
				##vanilla monkey event
				20 = {
					trigger = { 
						NOT = { has_character_flag = fair_event_74000 } 
						capital_scope = { NOT = { has_province_modifier = peasants_upset } }
					}
					character_event = { id = 74000 days = 5 }
					character_event = { id = ipcq.314 days = 10 }
				}
				
				##vanilla archery event
				20 = {
					trigger = { 
						NOT = { has_character_flag = fair_event_74005 } 
						any_vassal = {
							prisoner = no
							NOT = { trait = incapable }
							NOT = { is_inaccessible_trigger = yes }
							is_adult = yes
						}
						capital_scope = { NOT = { has_province_modifier = peasants_upset } }
						NOT = { trait = paranoid }
					}
					character_event = { id = 74005 days = 5 }
					character_event = { id = ipcq.314 days = 10 }
				}
				
				##vanilla jesters event
				20 = { 
					trigger = { 
						NOT = { has_character_flag = fair_event_74010 }
						capital_scope = { NOT = { has_province_modifier = peasants_upset } }
					}
					character_event = { id = 74010 days = 5 }
					character_event = { id = ipcq.314 days = 10 }
				}
				
				20 = { 
					trigger = { 
						NOT = { has_character_flag = fair_event_74015 }
						any_vassal = {
							prisoner = no
							NOT = { trait = incapable }
							NOT = { is_inaccessible_trigger = yes }
							is_adult = yes
							reverse_opinion = { who = ROOT value = 10 } 
						}
						capital_scope = { NOT = { has_province_modifier = peasants_upset } }
					}
					character_event = { id = 74015 days = 5 }
					character_event = { id = ipcq.314 days = 10 }
				}
			
				##vanilla jugglers event
				20 = {
					trigger = { 
						NOT = { has_character_flag = fair_event_74030 } 
						any_vassal = {
							prisoner = no
							NOT = { trait = incapable }
							NOT = { is_inaccessible_trigger = yes }
							is_adult = yes
							is_priest = yes
						}
					}
					character_event = { id = 74030 days = 5 }
					character_event = { id = ipcq.314 days = 10 }
				}
				
				##vanilla magicians
				20 = { 
					trigger = { 
						NOT = { has_character_flag = fair_event_74040 } 
						any_vassal = {
							prisoner = no
							NOT = { trait = incapable }
							NOT = { is_inaccessible_trigger = yes }
							is_adult = yes
							is_priest = yes
						}
						capital_scope = { NOT = { has_province_modifier = peasants_upset } }
					}
					character_event = { id = 74040 days = 5 }
					character_event = { id = ipcq.314 days = 10 }
				}
				

				##street brawl
				20 = {
					trigger = { NOT = { has_character_flag = fair_event_brawl } }
					character_event = { id = ipcq.315 days = 5 }
				}
				
				#nothing
				40 = { character_event = { id = ipcq.314 days = 5 } }
			}
		}
	}
}

###street brawl
character_event = {
	id = ipcq.315
	desc = EVTDESAipcq.315
	picture = GFX_evt_riots_byzantine

	is_triggered_only = yes
	
	immediate = { set_character_flag = fair_event_brawl }
	
	#break them apart
	option = {
		name = EVTOPTAipcq.315
		random_list = {
			40 = { add_trait_wounded_effect = yes }
			20 = { add_trait_severely_injured_effect = yes }
			40 = {
				modifier = {
					factor = 1.1
					is_ok_duelist_trigger = yes
				}
				modifier = {
					factor = 1.3
					is_decent_duelist_trigger = yes
				}
				modifier = {
					factor = 1.4
					is_good_duelist_trigger = yes
				}
				modifier = {
					factor = 1.6
					is_great_duelist_trigger = yes
				}
				modifier = {
					factor = 1.7
					is_fantastic_duelist_trigger = yes
				}
				modifier = {
					factor = 2
					is_the_best_duelist_trigger = yes
				}
				hidden_tooltip = { capital_scope = { add_province_modifier = { modifier = peasants_upset days = 10 } } }
			}
		}
		ai_chance = { factor = 1 }
	}
	
	#tell them to stop
	option = {
		tooltip_info = gregarious
		trigger = { trait = gregarious }
		name = EVTOPTBipcq.315
		ai_chance = { factor = 100 }
	}
	
	#command them to stop
	option = {
		trigger = { tier = king }
		tooltip_info_custom = ipc_king_info
		name = EVTOPTCipcq.315
		ai_chance = { factor = 100 }
		prestige = 50
	}
	
	after = { hidden_tooltip = { character_event = { id = ipcq.314 days = 2 } } }
}

	
###mission complete
character_event = {
	id = ipcq.318
	desc = EVTDESAipcq.318
	picture = GFX_evt_jugglers
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAipcq.318
		if = {
			limit = { has_character_flag = mission_large_entertainment }
			custom_tooltip = {
				text = EVTTOOLTIPAipcq.318
				event_target:mission_province = {
					add_province_modifier = { modifier = ipc_festival years = 10 }
					any_neighbor_province = {
						limit = { 
							NOT = { has_province_modifier = ipc_festival }
							holder_scope = { same_realm = ROOT } 
						}
						add_province_modifier = { modifier = ipc_festival years = 10 }
						any_neighbor_province = {
							limit = {
								NOT = { has_province_modifier = ipc_festival }
								holder_scope = { same_realm = ROOT } 
							}
							add_province_modifier = { modifier = ipc_festival years = 10 }
						}
					}
				}
			}
		}
		else_if = {
			limit = { has_character_flag = mission_medium_entertainment }
			custom_tooltip = {
				text = EVTTOOLTIPBipcq.318
				event_target:mission_province = {
					add_province_modifier = { modifier = ipc_festival years = 10 }
					any_neighbor_province = {
						limit = { 
							NOT = { has_province_modifier = ipc_festival }
							holder_scope = { same_realm = ROOT } 
						}
						add_province_modifier = { modifier = ipc_festival years = 10 }
					}
				}
			}
		}
		else = { event_target:mission_province = { add_province_modifier = { modifier = ipc_festival years = 10 } } }
		change_society_currency = 250
		clr_quest = quest_ipc_organize_festival
		add_imperial_service_opinion_effect = yes
	}
	
	after = {
		hidden_tooltip = {
			clr_character_flag = fair_event_74000
			clr_character_flag = fair_event_74005
			clr_character_flag = fair_event_74010
			clr_character_flag = fair_event_74015
			clr_character_flag = fair_event_74030
			clr_character_flag = fair_event_74040
			clr_character_flag = fair_event_brawl
			clr_character_flag = summer_fair_begin
			remove_character_modifier = holding_summer_fair
		}
	}
}

###mission failed
character_event = {
	id = ipcq.319
	desc = EVTDESAipcq.319
	picture = GFX_evt_jugglers
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAipcq.319
		clr_quest = {
			id = quest_ipc_organize_festival
			failure = yes
		}
		add_failed_empire_opinion_effect = yes
	}
	
	after = {
		hidden_tooltip = {
			clr_character_flag = mission_large_entertainment
			clr_character_flag = mission_medium_entertainment
			clr_character_flag = fair_event_74000
			clr_character_flag = fair_event_74005
			clr_character_flag = fair_event_74010
			clr_character_flag = fair_event_74015
			clr_character_flag = fair_event_74030
			clr_character_flag = fair_event_74040
			clr_character_flag = fair_event_brawl
			clr_character_flag = summer_fair_begin
			remove_character_modifier = holding_summer_fair
		}
	}
}
	

############Spymaster############

###investigate secret cults
society_quest_event = {
	id = ipcq.400
	desc = EVTDESAipcq.400
	
	is_triggered_only = yes
	is_in_society = yes
	
	trigger = {
		is_imperial_court_member_trigger = yes
		has_any_quest = no
	}
	
	option = {
		name = ACCEPT
		set_quest = quest_ipc_investigate_secret_religions
		custom_tooltip = {
			text = ipc_mission_intrigue_bonus_tooltip
			character_event = { id = ipcq.401 days = 30 }
		}
		if = {
			limit = { has_secret_religion = yes }
			custom_tooltip = { text = EVTTOOLTIPAipcq.400 }
		}
		ai_chance = { factor = 1 }
	}
	
	option  = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }
		
		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			years = 5
		}
		
		hidden_tooltip = { FROMFROM = { change_society_currency = 350 } }
		
		ai_chance = { factor = 0 }
	}
}

###choose method
character_event = {
	id = ipcq.401
	desc = {
		trigger = { has_secret_religion = no }
		text = EVTDESAipcq.401
	}
	desc = {
		trigger = { has_secret_religion = yes }
		text = EVTDESBipcq.401
	}
	picture = GFX_evt_suspicious_noble
	
	is_triggered_only = yes
	
	immediate = { 
		reset_ipc_mission_variables_effect = yes
		if = {
			limit = {
				top_liege = {
					any_realm_character = {
						has_secret_religion = yes
					}
				}
			}
			set_character_flag = mission_secret_religions_exist
		}
		if = {
			limit = {
				top_liege = {
					any_realm_character = {
						is_in_society = yes
						society_is_devil_worshiper = yes
					}
				}
			}
			set_character_flag = mission_devil_worshipers_exist
		}
		
	}
	
	#discreet, safe route, heavily dependent on intrigue
	option = {
		trigger = { has_secret_religion = no }
		name = EVTOPTAipcq.401
		custom_tooltip = {
			text = EVTTOOLTIPAipcq.401
			set_character_flag = mission_safe_route
			character_event = { id = ipcq.402 days = 10 }
		}
		ai_chance = { factor = 80 }
	}
	
	
	#more dangerous route, less dependent on intrigue
	option = {
		trigger = { has_secret_religion = no }
		name = EVTOPTBipcq.401
		custom_tooltip = {
			text = EVTTOOLTIPBipcq.401
			set_character_flag = mission_dangerous_route
			character_event = { id = ipcq.402 days = 10 }
		}
		ai_chance = {
			factor = 20
			modifier = {
				factor = 1.5
				intrigue = 12
			}
			modifier = {
				factor = 1.5
				intrigue = 16
			}
			modifier = {
				factor = 1.5
				intrigue = 20
			}
			modifier = {
				factor = 1.5
				trait = schemer
			}
			modifier = {
				factor = 1.5
				trait = deceitful
			}
			modifier = {
				factor = 3
				is_loyal_to_empire_trigger = yes
			}
		}
	}
	
	#secret religion, sabotage attempts
	option = {
		trigger = { has_secret_religion = yes }
		name = EVTOPTCipcq.401
		hidden_tooltip = { character_event = { id = ipcq.417 days = 10 } }
	}
}

###flavor event tombola
character_event = {
	id = ipcq.402
	desc = {
		trigger = { check_variable = { which = ipc_mission_flavor_counter value == 0 } }
		text = EVTDESAipcq.402
	}
	desc = {
		trigger = { check_variable = { which = ipc_mission_flavor_counter value == 1 } }
		text = EVTDESBipcq.402
	}
	desc = {
		trigger = { check_variable = { which = ipc_mission_flavor_counter value == 2 } }
		text = EVTDESCipcq.402
	}
	desc = {
		trigger = { check_variable = { which = ipc_mission_flavor_counter value == 3 } }
		text = EVTDESDipcq.402
	}
	picture = GFX_evt_suspicious_noble
	
	hide_from = yes
	is_triggered_only = yes
	
	option = {
		trigger = { check_variable = { which = ipc_mission_flavor_counter value < 3 } }
		name = {
			trigger = { check_variable = { which = ipc_mission_flavor_counter value == 0 } }
			text = EVTOPTAipcq.402
		}
		name = {
			trigger = { check_variable = { which = ipc_mission_flavor_counter value == 1 } }
			text = EVTOPTBipcq.402
		}
		name = {
			trigger = { check_variable = { which = ipc_mission_flavor_counter value == 2 } }
			text = EVTOPTCipcq.402
		}
		random_list = {
			#eavesdrop
			20 = {
				custom_tooltip = { 
					text = EVTTITLEipcq.404
					character_event = { id = ipcq.404 days = 10 }
				}
			}
			#intercept letters
			20 = {
				custom_tooltip = { 
					text = EVTTITLEipcq.405
					character_event = { id = ipcq.405 days = 10 }
				}
			}
			#slip of the tongue
			20 = {
				trigger = { 
					OR = {
						has_character_flag = mission_secret_religions_exist 
						has_character_flag = mission_devil_worshipers_exist
					}
				}
				custom_tooltip = {
					text = EVTTITLEipcq.406
					hidden_tooltip = {
						top_liege = {
							random_realm_character = {
								limit = { 
									OR = {
										has_secret_religion = yes
										AND = {
											is_in_society = yes
											society_is_devil_worshiper = yes
										}
									}
								}
								set_character_flag = send_slip_tongue
								character_event = { id = ipcq.403 days = 10 }
							}
						}
					}
				}
			}
			#convince an imprisoned lord in exchange for freedom
			15 = {
				trigger = {
					top_liege = {
						any_realm_character = {
							is_landed = yes
							prisoner = yes
							age = 8
						}
					}
				}
				custom_tooltip = {
					text = EVTTITLEipcq.407
					hidden_tooltip = {
						top_liege = {
							random_realm_character = {
								limit = { 
									is_landed = yes
									prisoner = yes
									age = 8
								}
								set_character_flag = send_imprisoned_lord
								character_event = { id = ipcq.403 days = 10 }
							}
						}
					}
				}
			}
			#follow suspect
			40 = {
				trigger = { has_character_flag = mission_dangerous_route }
				custom_tooltip = { 
					text = EVTTITLEipcq.409
					character_event = { id = ipcq.409 days = 10 }
				}
			}
			#confront directly
			40 = {
				trigger = { has_character_flag = mission_dangerous_route }
				custom_tooltip = { 
					text = EVTTITLEipcq.410
					hidden_tooltip = {
						if = { 
							limit = { 
								has_character_flag = mission_secret_religions_exist
								OR = {
									intrigue = 12
									trait = schemer
								}
							}
							top_liege = {
								random_realm_character = {
									limit = { has_secret_religion = yes }
									set_character_flag = send_confront_directly
									character_event = { id = ipcq.403 days = 10 }
								}
							}
						}
						else_if = {
							limit = { 
								has_character_flag = mission_devil_worshipers_exist
								OR = {
									intrigue = 12
									trait = schemer
								}
							}
							top_liege = {
								random_realm_character = {
									limit = { 
										is_in_society = yes
										society_is_devil_worshiper = yes
									}
									set_character_flag = send_confront_directly
									character_event = { id = ipcq.403 days = 10 }
								}
							}
						}
						else = {
							top_liege = {
								random_realm_character = {
									limit = { is_playable = yes }
									set_character_flag = send_confront_directly
									character_event = { id = ipcq.403 days = 10 }
								}
							}
						}
					}
				}
			}
			
			#infiltrate cult
			40 = {
				trigger = { 
					has_character_flag = mission_dangerous_route 
					OR = { 
						has_character_flag = mission_secret_religions_exist
						has_character_flag = mission_devil_worshipers_exist
					}
				}
				custom_tooltip = {
					text = EVTTITLEipcq.411
					character_event = { id = ipcq.411 days = 10 }
				}
			}
		}
	}
	
	#chicken out
	option = {
		trigger = { check_variable = { which = ipc_mission_flavor_counter value < 3 } }
		name = EVTOPTDipcq.402
		clr_quest = {
			id = quest_ipc_investigate_secret_religions
			failure = yes
		}
		add_failed_empire_opinion_effect = yes
		hidden_tooltip = {
			reset_ipc_mission_variables_effect = yes
			clr_character_flag = mission_safe_route
			clr_character_flag = mission_dangerous_route
			clr_character_flag = mission_secret_religions_exist
			clr_character_flag = mission_devil_worshipers_exist
		}
		ai_chance = { factor = 0 }
	}
	
	#finish mission
	option = {
		trigger = { check_variable = { which = ipc_mission_flavor_counter value == 3 } }
		name = EVTOPTEipcq.402
		hidden_tooltip = { character_event = { id = ipcq.416 days = 10 } }
	}
}



#ping to target, if any
character_event = {
	id = ipcq.403
	
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { has_character_flag = send_slip_tongue }
			FROM = { character_event = { id = ipcq.406 days = 1 } }
			clr_character_flag = send_slip_tongue
		}
		else_if = {
			limit = { has_character_flag = send_imprisoned_lord }
			FROM = { character_event = { id = ipcq.407 days = 1 } }
			clr_character_flag = send_imprisoned_lord
		}
		else_if = {
			limit = { has_character_flag = send_confront_directly }
			FROM = { character_event = { id = ipcq.410 days = 1 } }
			clr_character_flag = send_confront_directly
		}
	}


}

#whispers in the night, eavesdropping
character_event = {
	id = ipcq.404
	title = EVTTITLEipcq.404
	desc = EVTDESAipcq.404
	picture = GFX_evt_eavesdropping
	
	is_triggered_only = yes
	
	immediate = { change_variable = { which = ipc_mission_flavor_counter value = 1 } }
	
	option = {
		name = EVTOPTAipcq.404
		random_list = {
			30 = {
				custom_tooltip = { 
					text = EVTTOOLTIPgoodlead
					change_variable = { which = ipc_mission_score value = 1 }
				}
			}
			10 = { 
				custom_tooltip = { 
					text = EVTTOOLTIPgreatlead
					change_variable = { which = ipc_mission_score value = 2 }
				}
			}
			50 = {
				modifier = {
					factor = 0.9
					intrigue = 4
				}
				modifier = {
					factor = 0.9
					intrigue = 8
				}
				modifier = {
					factor = 0.8
					intrigue = 12
				}
				modifier = {
					factor = 0.8
					intrigue = 16
				}
				modifier = {
					factor = 0.7
					intrigue = 20
				}
				modifier = {
					factor = 0.75
					trait = schemer
				}
				modifier = {
					factor = 0.8
					trait = deceitful
				}
				custom_tooltip = { text = EVTTOOLTIPbadlead }
			}
		}
		random_list = { 
			90 = {}
			10 = {
				modifier = {
					factor = 0.9
					intrigue = 12
				}
				modifier = {
					factor = 0.9
					intrigue = 16
				}
				modifier = {
					factor = 0.9
					intrigue = 20
				}
				modifier = {
					factor = 0.8
					trait = schemer
				}
				modifier = {
					factor = 0.9
					trait = deceitful
				}
				custom_tooltip = {
					text = EVTTOOLTIPdiscoveredinvestigation
					set_character_flag = mission_investigation_discovered
				}
			}
		}
	}
	after = { 
		hidden_tooltip = { 
			if = {
				limit = { has_character_flag = mission_investigation_discovered }
				character_event = { id = ipcq.415 days = 10 } 
			}
			else = { character_event = { id = ipcq.402 days = 10 } }
		}
	}
}
	
#intercepted message, intercepted letter
character_event = {
	id = ipcq.405
	title = EVTTITLEipcq.405
	desc = EVTDESAipcq.405
	picture = GFX_evt_recieve_letter
	
	is_triggered_only = yes
	
	immediate = { change_variable = { which = ipc_mission_flavor_counter value = 1 } }
	
	option = {
		name = EVTOPTAipcq.405
		random_list = {
			30 = {
				custom_tooltip = { 
					text = EVTTOOLTIPgoodlead
					change_variable = { which = ipc_mission_score value = 1 }
				}
			}
			10 = { 
				custom_tooltip = { 
					text = EVTTOOLTIPgreatlead
					change_variable = { which = ipc_mission_score value = 2 }
				}
			}
			50 = {
				modifier = {
					factor = 0.9
					intrigue = 4
				}
				modifier = {
					factor = 0.9
					intrigue = 8
				}
				modifier = {
					factor = 0.8
					intrigue = 12
				}
				modifier = {
					factor = 0.8
					intrigue = 16
				}
				modifier = {
					factor = 0.7
					intrigue = 20
				}
				modifier = {
					factor = 0.75
					trait = schemer
				}
				modifier = {
					factor = 0.8
					trait = deceitful
				}
				custom_tooltip = { text = EVTTOOLTIPbadlead }
			}
		}
		random_list = { 
			90 = {}
			10 = {
				modifier = {
					factor = 0.9
					intrigue = 12
				}
				modifier = {
					factor = 0.9
					intrigue = 16
				}
				modifier = {
					factor = 0.9
					intrigue = 20
				}
				modifier = {
					factor = 0.8
					trait = schemer
				}
				modifier = {
					factor = 0.9
					trait = deceitful
				}
				custom_tooltip = {
					text = EVTTOOLTIPdiscoveredinvestigation
					set_character_flag = mission_investigation_discovered
				}
			}
		}
	}
	after = {
		hidden_tooltip = { 
			if = {
				limit = { has_character_flag = mission_investigation_discovered }
				character_event = { id = ipcq.415 days = 10 } 
			}
			else = { character_event = { id = ipcq.402 days = 10 } }
		}
	}
}
	
#slip of the tongue, secret religion guy spoke wrong
character_event = {
	id = ipcq.406
	title = EVTTITLEipcq.406
	desc = EVTDESAipcq.406
	picture = GFX_evt_courtiers_talking
	
	is_triggered_only = yes
	
	immediate = { change_variable = { which = ipc_mission_flavor_counter value = 1 } }
	
	option = {
		name = EVTOPTAipcq.406
		random_list = {
			40 = {
				custom_tooltip = { 
					text = EVTTOOLTIPgoodlead
					change_variable = { which = ipc_mission_score value = 1 }
				}
			}
			30 = {
				custom_tooltip = { 
					text = EVTTOOLTIPgreatlead
					change_variable = { which = ipc_mission_score value = 2 }
				}
			}
			30 = {
				modifier = {
					factor = 0.9
					intrigue = 4
				}
				modifier = {
					factor = 0.9
					intrigue = 8
				}
				modifier = {
					factor = 0.8
					intrigue = 12
				}
				modifier = {
					factor = 0.8
					intrigue = 16
				}
				modifier = {
					factor = 0.7
					intrigue = 20
				}
				modifier = {
					factor = 0.75
					trait = schemer
				}
				modifier = {
					factor = 0.8
					trait = deceitful
				}
				modifier = {
					factor = 1.1
					FROM = { intrigue = 4 }
				}
				modifier = {
					factor = 1.2
					FROM = { intrigue = 8 }
				}
				modifier = {
					factor = 1.2
					FROM = { intrigue = 12 }
				}
				modifier = {
					factor = 1.2
					FROM = { intrigue = 16 }
				}
				modifier = {
					factor = 1.3
					FROM = { intrigue = 20 }
				}
				modifier = {
					factor = 1.25
					FROM = { trait = schemer }
				}
				modifier = {
					factor = 1.25
					FROM = { trait = deceitful }
				}
				custom_tooltip = { text = EVTTOOLTIPbadlead }
			}
		}
		random_list = { 
			90 = {}
			10 = {
				modifier = {
					factor = 0.9
					intrigue = 12
				}
				modifier = {
					factor = 0.9
					intrigue = 16
				}
				modifier = {
					factor = 0.9
					intrigue = 20
				}
				modifier = {
					factor = 0.8
					trait = schemer
				}
				modifier = {
					factor = 0.9
					trait = deceitful
				}
				custom_tooltip = {
					text = EVTTOOLTIPdiscoveredinvestigation
					set_character_flag = mission_investigation_discovered
				}
			}
		}
	}
	after = {
		hidden_tooltip = { 
			if = {
				limit = { has_character_flag = mission_investigation_discovered }
				character_event = { id = ipcq.415 days = 10 } 
			}
			else = { character_event = { id = ipcq.402 days = 10 } }
		}
	}
}
	
#price of freedom, get info from imprisoned character
character_event = {
	id = ipcq.407
	title = EVTTITLEipcq.407
	desc = EVTDESAipcq.407
	picture = GFX_evt_into_the_dungeon
	
	is_triggered_only = yes
	
	immediate = { change_variable = { which = ipc_mission_flavor_counter value = 1 } }
	
	option = {
		name = EVTOPTAipcq.407
		random_list = {
			40 = {
				custom_tooltip = { 
					text = EVTTOOLTIPgoodlead
					change_variable = { which = ipc_mission_score value = 1 }
				}
			}
			20 = {
				custom_tooltip = { 
					text = EVTTOOLTIPgreatlead
					change_variable = { which = ipc_mission_score value = 2 }
				}
			}
			40 = {
				modifier = {
					factor = 0.9
					intrigue = 4
				}
				modifier = {
					factor = 0.9
					intrigue = 8
				}
				modifier = {
					factor = 0.8
					intrigue = 12
				}
				modifier = {
					factor = 0.8
					intrigue = 16
				}
				modifier = {
					factor = 0.7
					intrigue = 20
				}
				modifier = {
					factor = 0.75
					trait = schemer
				}
				modifier = {
					factor = 0.8
					trait = deceitful
				}
				modifier = {
					factor = 0.5
					FROM = { trait = craven }
				}
				modifier = {
					factor = 0.75
					FROM = { has_secret_religion = yes }
				}
				modifier = {
					factor = 1.2
					FROM = { intrigue = 12 }
				}
				modifier = {
					factor = 1.2
					FROM = { intrigue = 16 }
				}
				modifier = {
					factor = 1.3
					FROM = { intrigue = 20 }
				}
				modifier = {
					factor = 1.25
					FROM = { trait = schemer }
				}
				modifier = {
					factor = 1.25
					FROM = { trait = deceitful }
				}
				custom_tooltip = { text = EVTTOOLTIPbadlead }
			}
		}
		random_list = {
			90 = {}
			10 = {
				modifier = {
					factor = 0.9
					intrigue = 12
				}
				modifier = {
					factor = 0.9
					intrigue = 16
				}
				modifier = {
					factor = 0.9
					intrigue = 20
				}
				modifier = {
					factor = 0.8
					trait = schemer
				}
				modifier = {
					factor = 0.9
					trait = deceitful
				}
				custom_tooltip = {
					text = EVTTOOLTIPdiscoveredinvestigation
					set_character_flag = mission_investigation_discovered
				}
			}
		}
	}
	after = {
		hidden_tooltip = { 
			if = {
				limit = { has_character_flag = mission_investigation_discovered }
				character_event = { id = ipcq.415 days = 10 } 
			}
			else = { character_event = { id = ipcq.402 days = 10 } }
			FROM = { character_event = { id = ipcq.408 } }
		}
	}
}

#price of freedom, free imprisoned character
character_event = {
	id = ipcq.408
	desc = EVTDESAipcq.408
	picture = GFX_evt_into_the_dungeon
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAipcq.408
		imprison = no
	}
}

#follow suspect
character_event = {
	id = ipcq.409
	title = EVTTITLEipcq.409
	desc = EVTDESAipcq.409
	picture = GFX_evt_shadowy_cabal
	
	is_triggered_only = yes
	
	immediate = { change_variable = { which = ipc_mission_flavor_counter value = 1 } }
	
	option = {
		name = EVTOPTAipcq.409
		random_list = {
			50 = {
				custom_tooltip = { 
					text = EVTTOOLTIPgoodlead
					change_variable = { which = ipc_mission_score value = 1 }
				}
			}
			20 = { 
				custom_tooltip = { 
					text = EVTTOOLTIPgreatlead
					change_variable = { which = ipc_mission_score value = 2 }
				}
			}
			30 = {
				modifier = {
					factor = 0.9
					intrigue = 4
				}
				modifier = {
					factor = 0.9
					intrigue = 8
				}
				modifier = {
					factor = 0.8
					intrigue = 12
				}
				modifier = {
					factor = 0.8
					intrigue = 16
				}
				modifier = {
					factor = 0.7
					intrigue = 20
				}
				modifier = {
					factor = 0.75
					trait = schemer
				}
				modifier = {
					factor = 0.8
					trait = deceitful
				}
				custom_tooltip = { text = EVTTOOLTIPbadlead }
			}
		}
		random_list = { 
			80 = {}
			20 = {
				modifier = {
					factor = 0.9
					intrigue = 12
				}
				modifier = {
					factor = 0.8
					intrigue = 16
				}
				modifier = {
					factor = 0.7
					intrigue = 20
				}
				modifier = {
					factor = 0.8
					trait = schemer
				}
				modifier = {
					factor = 0.9
					trait = deceitful
				}
				custom_tooltip = {
					text = EVTTOOLTIPdiscoveredinvestigation
					set_character_flag = mission_investigation_discovered
				}
			}
		}
	}
	after = {
		hidden_tooltip = { 
			if = {
				limit = { has_character_flag = mission_investigation_discovered }
				character_event = { id = ipcq.415 days = 10 } 
			}
			else = { character_event = { id = ipcq.402 days = 10 } }
		}
	}
}

#confront directly
character_event = {
	id = ipcq.410
	title = EVTTITLEipcq.410
	desc = EVTDESAipcq.410
	picture = GFX_evt_poke_king_in_chest
	
	is_triggered_only = yes
	
	immediate = { change_variable = { which = ipc_mission_flavor_counter value = 1 } }
	
	option = {
		name = EVTOPTAipcq.410
		random_list = {
			40 = {
				modifier = {
					factor = 1.5
					FROM = { has_secret_religion = yes }
				}
				custom_tooltip = { 
					text = EVTTOOLTIPgoodlead
					change_variable = { which = ipc_mission_score value = 1 }
				}
			}
			20 = {
				modifier = {
					factor = 2
					FROM = { has_secret_religion = yes }
				}
				custom_tooltip = { 
					text = EVTTOOLTIPgreatlead
					change_variable = { which = ipc_mission_score value = 2 }
				}
			}
			40 = {
				modifier = {
					factor = 0.9
					intrigue = 4
				}
				modifier = {
					factor = 0.9
					intrigue = 8
				}
				modifier = {
					factor = 0.8
					intrigue = 12
				}
				modifier = {
					factor = 0.8
					intrigue = 16
				}
				modifier = {
					factor = 0.7
					intrigue = 20
				}
				modifier = {
					factor = 0.75
					trait = schemer
				}
				modifier = {
					factor = 0.8
					trait = deceitful
				}
				modifier = {
					factor = 1.1
					FROM = { intrigue = 12 }
				}
				modifier = {
					factor = 1.2
					FROM = { intrigue = 16 }
				}
				modifier = {
					factor = 1.3
					FROM = { intrigue = 20 }
				}
				modifier = {
					factor = 1.25
					FROM = { trait = schemer }
				}
				modifier = {
					factor = 1.25
					FROM = { trait = deceitful }
				}
				custom_tooltip = { text = EVTTOOLTIPbadlead }
			}
		}
		random_list = { 
			70 = {}
			30 = {
				modifier = {
					factor = 0.9
					FROM = { has_secret_religion = no }
				}
				modifier = {
					factor = 0.85
					intrigue = 12
				}
				modifier = {
					factor = 0.75
					intrigue = 16
				}
				modifier = {
					factor = 0.65
					intrigue = 20
				}
				modifier = {
					factor = 0.7
					trait = schemer
				}
				modifier = {
					factor = 0.9
					trait = deceitful
				}
				custom_tooltip = {
					text = EVTTOOLTIPdiscoveredinvestigation
					set_character_flag = mission_investigation_discovered
				}
			}
		}
	}
	after = {
		hidden_tooltip = { 
			if = {
				limit = { has_character_flag = mission_investigation_discovered }
				character_event = { id = ipcq.415 days = 10 } 
			}
			else = { character_event = { id = ipcq.402 days = 10 } }
		}
	}
}

#infiltrate cult
character_event = {
	id = ipcq.411
	title = EVTTITLEipcq.411
	desc = EVTDESAipcq.411
	picture = GFX_evt_shadowy_cabal
	
	is_triggered_only = yes
	
	immediate = { change_variable = { which = ipc_mission_flavor_counter value = 1 } }
	
	option = {
		name = EVTOPTAipcq.411
		random_list = {
			60 = {
				custom_tooltip = { 
					text = EVTTOOLTIPgoodlead
					change_variable = { which = ipc_mission_score value = 1 }
				}
			}
			30 = { 
				custom_tooltip = { 
					text = EVTTOOLTIPgreatlead
					change_variable = { which = ipc_mission_score value = 2 }
				}
			}
			10 = {
				modifier = {
					factor = 0.9
					intrigue = 4
				}
				modifier = {
					factor = 0.9
					intrigue = 8
				}
				modifier = {
					factor = 0.8
					intrigue = 12
				}
				modifier = {
					factor = 0.8
					intrigue = 16
				}
				modifier = {
					factor = 0.7
					intrigue = 20
				}
				modifier = {
					factor = 0.75
					trait = schemer
				}
				modifier = {
					factor = 0.8
					trait = deceitful
				}
				custom_tooltip = { text = EVTTOOLTIPbadlead }
			}
		}
		random_list = { 
			70 = {}
			30 = {
				modifier = {
					factor = 0.9
					intrigue = 8
				}
				modifier = {
					factor = 0.9
					intrigue = 12
				}
				modifier = {
					factor = 0.8
					intrigue = 16
				}
				modifier = {
					factor = 0.7
					intrigue = 20
				}
				modifier = {
					factor = 0.7
					trait = schemer
				}
				modifier = {
					factor = 0.8
					trait = deceitful
				}
				custom_tooltip = {
					text = EVTTOOLTIPdiscoveredinvestigation
					set_character_flag = mission_investigation_discovered
				}
			}
		}
	}
	after = {
		hidden_tooltip = { 
			if = {
				limit = { has_character_flag = mission_investigation_discovered }
				character_event = { id = ipcq.415 days = 10 } 
			}
			else = { character_event = { id = ipcq.402 days = 10 } }
		}
	}
}


###mission discovered
character_event = {
	id = ipcq.415
	desc = EVTDESAipcq.415
	picture = GFX_evt_assassination
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAipcq.415
		clr_quest = {
			id = quest_ipc_investigate_secret_religions
			failure = yes
		}
		add_failed_empire_opinion_effect = yes
		random_list = {
			80 = { add_trait_wounded_effect = yes }
			15 = { add_maimed_trait_effect = yes }
			5 = { death = { death_reason = death_murder_unknown } }
		}
	}
	
	after = {
		hidden_tooltip = {
			if = {
				limit = { is_alive = yes }
				reset_ipc_mission_variables_effect = yes
				clr_character_flag = mission_safe_route
				clr_character_flag = mission_dangerous_route
				clr_character_flag = mission_secret_religions_exist
				clr_character_flag = mission_devil_worshipers_exist
			}
		}
	}
}

###finished investigation, get results
character_event = {
	id = ipcq.416
	desc = {
		trigger = { has_character_flag = minor_success }
		text = EVTDESAipcq.416
	}
	desc = {
		trigger = { has_character_flag = moderate_success }
		text = EVTDESBipcq.416
	}
	desc = {
		trigger = { has_character_flag = great_success }
		text = EVTDESCipcq.416
	}
	picture = GFX_evt_book_carolingian_script
	
	is_triggered_only = yes
	
	immediate = {
		set_variable = { which = ipc_while_counter value = 0 }
		if = {
			limit = { check_variable = { which = ipc_mission_score value >= 5 } }
			set_character_flag = mission_great_success
		}
		else_if = {
			limit = { check_variable = { which = ipc_mission_score value >= 2 } }
			set_character_flag = mission_moderate_success
		}
		else_if = {
			limit = { check_variable = { which = ipc_mission_score value < 2 } }
			set_character_flag = mission_minor_success
		}
	}
	
	option = {
		trigger = { has_character_flag = mission_minor_success}
		name = EVTOPTAipcq.416
		change_society_currency = 300
		clr_quest = quest_ipc_investigate_secret_religions
		add_imperial_service_opinion_effect = yes
		if = {
			limit = {
				OR = {
					has_character_flag = mission_secret_religions_exist
					has_character_flag = mission_devil_worshipers_exist
				}
			}
			custom_tooltip = {
				text = EVTTOOLTIPAipcq.416
				if = {
					limit = { has_character_flag = mission_secret_religions_exist }
					top_liege = {
						while = {
							limit = { ROOT = { check_variable = { which = ipc_while_counter value < 3 } } }
							ROOT = { change_variable = { which = ipc_while_counter value = 1 } }
							random_realm_character = { 
								limit = { 
									has_secret_religion = yes 
									NOT = { has_character_flag = ipc_revealed_cultist }
								}
								set_character_flag = ipc_revealed_cultist
								if = {
									limit = { society_member_of = secret_religious_cult }
									set_discovered_society = yes
								}
								hidden_tooltip = { liege = { opinion = { modifier = opinion_charge_cultist who = PREV years = 5 } } }
							}
						}
					}
				}
				else_if = {
					limit = { has_character_flag = mission_devil_worshipers_exist }
					top_liege = {
						while = {
							limit = { ROOT = { check_variable = { which = ipc_while_counter value < 3 } } }
							ROOT = { change_variable = { which = ipc_while_counter value = 1 } }
							random_realm_character = { 
								limit = { 
									is_in_society = yes
									society_is_devil_worshiper = yes
									NOT = { has_character_flag = ipc_revealed_cultist }
								}
								set_character_flag = ipc_revealed_cultist
								set_discovered_society = yes
								hidden_tooltip = { liege = { opinion = { modifier = opinion_charge_cultist who = PREV years = 5 } } }
							}
						}
					}
				}
			}
		}
	}
	
	option = {
		trigger = { has_character_flag = mission_moderate_success}
		name = EVTOPTBipcq.416
		change_society_currency = 400
		clr_quest = quest_ipc_investigate_secret_religions
		add_imperial_service_opinion_effect = yes
		if = {
			limit = {
				OR = {
					has_character_flag = mission_secret_religions_exist
					has_character_flag = mission_devil_worshipers_exist
				}
			}
			custom_tooltip = {
				text = EVTTOOLTIPBipcq.416
				if = {
					limit = { has_character_flag = mission_secret_religions_exist }
					top_liege = {
						while = {
							limit = { ROOT = { check_variable = { which = ipc_while_counter value < 7 } } }
							ROOT = { change_variable = { which = ipc_while_counter value = 1 } }
							random_realm_character = { 
								limit = { 
									has_secret_religion = yes 
									NOT = { has_character_flag = ipc_revealed_cultist }
								}
								set_character_flag = ipc_revealed_cultist
								if = {
									limit = { society_member_of = secret_religious_cult }
									set_discovered_society = yes
								}
								hidden_tooltip = { liege = { opinion = { modifier = opinion_charge_cultist who = PREV years = 5 } } }
							}
						}
					}
				}
				else_if = {
					limit = { has_character_flag = mission_devil_worshipers_exist }
					top_liege = {
						while = {
							limit = { ROOT = { check_variable = { which = ipc_while_counter value < 7 } } }
							ROOT = { change_variable = { which = ipc_while_counter value = 1 } }
							random_realm_character = { 
								limit = {
									is_in_society = yes
									society_is_devil_worshiper = yes
									NOT = { has_character_flag = ipc_revealed_cultist }
								}
								set_character_flag = ipc_revealed_cultist
								set_discovered_society = yes
								hidden_tooltip = { liege = { opinion = { modifier = opinion_charge_cultist who = PREV years = 5 } } }
							}
						}
					}
				}
			}
		}
	}
	
	option = {
		trigger = { has_character_flag = mission_great_success }
		name = EVTOPTCipcq.416
		change_society_currency = 500
		clr_quest = quest_ipc_investigate_secret_religions
		add_imperial_service_opinion_effect = yes
		if = {
			limit = {
				OR = {
					has_character_flag = mission_secret_religions_exist
					has_character_flag = mission_devil_worshipers_exist
				}
			}
			custom_tooltip = {
				text = EVTTOOLTIPCipcq.416
				if = {
					limit = { has_character_flag = mission_secret_religions_exist }
					top_liege = {
						any_realm_character = { 
							limit = { 
								has_secret_religion = yes 
								NOT = { has_character_flag = ipc_revealed_cultist }
							}
							set_character_flag = ipc_revealed_cultist
							if = {
								limit = { society_member_of = secret_religious_cult }
								set_discovered_society = yes
							}
							hidden_tooltip = { liege = { opinion = { modifier = opinion_charge_cultist who = PREV years = 5 } } }
						}
					}
				}
				else_if = {
					limit = { has_character_flag = mission_devil_worshipers_exist }
					top_liege = {
						any_realm_character = { 
							limit = { 
								is_in_society = yes
								society_is_devil_worshiper = yes
								NOT = { has_character_flag = ipc_revealed_cultist }
							}
							set_character_flag = ipc_revealed_cultist
							set_discovered_society = yes
							hidden_tooltip = { liege = { opinion = { modifier = opinion_charge_cultist who = PREV years = 5 } } }
						}
					}
				}
			}
		}
	}
	
	after = {
		hidden_tooltip = {
			reset_ipc_mission_variables_effect = yes
			clr_character_flag = mission_safe_route
			clr_character_flag = mission_dangerous_route
			clr_character_flag = mission_secret_religions_exist
			clr_character_flag = mission_devil_worshipers_exist
			clr_character_flag = mission_minor_success
			clr_character_flag = mission_moderate_success
			clr_character_flag = mission_great_success
		}
	}
}

#part of secret religion, sabotage attempts
character_event = {
	id = ipcq.417
	desc = EVTDESAipcq.417
	picture = GFX_evt_secret_ceremony
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAipcq.417
		random_list = {
			50 = {
				modifier = {
					factor = 1.1
					intrigue = 4
				}
				modifier = {
					factor = 1.2
					intrigue = 8
				}
				modifier = {
					factor = 1.2
					intrigue = 12
				}
				modifier = {
					factor = 1.3
					intrigue = 16
				}
				modifier = {
					factor = 1.3
					intrigue = 20
				}
				modifier = {
					factor = 1.25
					trait = schemer
				}
				modifier = {
					factor = 1.15
					trait = deceitful
				}
				custom_tooltip = {
					text = EVTTOOLTIPAipcq.417
					set_character_flag = mission_success
				}
			}
			50 = {
				custom_tooltip = {
					text = EVTTOOLTIPBipcq.417
					set_character_flag = mission_failure
				}
			}
		}
		hidden_tooltip = { character_event = { id = ipcq.418 days = 50 } }
	}
}

#results of sabotage
character_event = {
	id = ipcq.418
	desc = {
		trigger = { has_character_flag = mission_success }
		text = EVTDESAipcq.418
	}
	desc = {
		trigger = { has_character_flag = mission_failure }
		text = EVTDESAipcq.418
	}
	picture = GFX_evt_secret_ceremony
	
	is_triggered_only = yes
	
	option = {
		trigger = { has_character_flag = mission_success }
		name = EVTOPTAipcq.418
		change_society_currency = 150
		clr_quest = quest_ipc_investigate_secret_religions
		add_imperial_service_opinion_effect = yes
	}
	option = {
		trigger = { has_character_flag = mission_failure }
		name = EVTOPTAipcq.418
		clr_quest = {
			id = quest_ipc_investigate_secret_religions
			failure = yes
		}
		add_failed_empire_opinion_effect = yes
		liege = { show_scope_change = no opinion = { modifier = opinion_charge_cultist who = ROOT years = 5 } }
	}
	after = {
		clr_character_flag = mission_success
		clr_character_flag = mission_failure
	}
}



#######infiltrate foreign court, short quest
society_quest_event = {
	id = ipcq.420
	desc = EVTDESAipcq.420
	
	is_triggered_only = yes
	is_in_society = yes
	
	trigger = {
		is_imperial_court_member_trigger = yes
		has_any_quest = no
	}
	
	show_from_from = yes
	quest_target = event_target:infiltrate_court_target
	
	option = {
		name = ACCEPT
		event_target:infiltrate_court_target = {
			set_quest_target = {
				id = quest_ipc_infiltrate_court
				holder = ROOT
			}
		}
		custom_tooltip = {
			text = ipc_mission_intrigue_bonus_tooltip
			character_event = { id = ipcq.421 days = 30 }
		}
		ai_chance = { factor = 1 }
	}
	
	option  = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }
		
		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			years = 5
		}
		
		hidden_tooltip = { FROMFROM = { change_society_currency = 200 } }
		
		ai_chance = { factor = 0 }
	}
}

###prepare for departure
character_event = {
	id = ipcq.421
	desc = EVTDESAipcq.421
	picture = GFX_evt_carriage
	
	is_triggered_only = yes
	
	option = { 
		name = EVTOPTAipcq.421
		hidden_tooltip = { event_target:infiltrate_court_target = { character_event = { id = ipcq.422 days = 30 } } }
	}
}

###ping to target
character_event = {
	id = ipcq.422
	
	hide_window = yes
	is_triggered_only = yes
	
	immediate = { FROM = { character_event = { id = ipcq.423 } } }
}

####visiting the target
character_event = {
	id = ipcq.423
	desc = EVTDESAipcq.423
	picture = GFX_evt_council_speaker
	
	is_triggered_only = yes
	
	#say you want to improve relations
	option = {
		name = EVTOPTAipcq.423
		random_list = {
			50 = {
				modifier = {
					factor = 1.2
					intrigue = 4
				}
				modifier = {
					factor = 1.2
					intrigue = 8
				}
				modifier = {
					factor = 1.4
					intrigue = 12
				}
				modifier = {
					factor = 1.4
					intrigue = 16
				}
				modifier = {
					factor = 1.6
					intrigue = 20
				}
				modifier = {
					factor = 1.5
					trait = deceitful
				}
				modifier = {
					factor = 2
					trait = fair
					OR = {
						trait = fair
						AND = {
							age < 40
							FROM = { age < 40 }
						}
					}
					OR = {
						is_opposite_sex = FROM
						AND = {
							same_sex = FROM
							FROM = { trait = homosexual }
						}
					}
					FROM = {
						NOR = {
							trait = chaste
							trait = celibate
							trait = eunuch
						}
					}
				}
				
				custom_tooltip = {
					text = ipc_success_tooltip
					set_character_flag = moderate_success
				}
			}
			
			50 = {
				modifier = {
					factor = 0.8
					FROM = { trait = trusting }
				}
				modifier = {
					factor = 1.1
					FROM = { intrigue = 5 }
				}
				modifier = {
					factor = 1.1
					FROM = { intrigue = 10 }
				}
				modifier = {
					factor = 1.1
					FROM = { intrigue = 15 }
				}
				modifier = {
					factor = 1.3
					FROM = { intrigue = 20 }
				}
				modifier = {
					factor = 1.5
					FROM = { trait = paranoid }
				}
				modifier = {
					factor = 1.5
					FROM = { trait = shrewd }
				}
				
				
				custom_tooltip = {
					text = ipc_failure_tooltip
					set_character_flag = mission_failure
				}
			}
		}
		ai_chance = { factor = 80 }
	}
	
	#say you want to do business
	option = {
		name = EVTOPTBipcq.423
		scaled_wealth = { value = -0.25 min = -50 max = -250 }
		random_list = {
			75 = {
				modifier = {
					factor = 1.2
					intrigue = 4
				}
				modifier = {
					factor = 1.2
					intrigue = 8
				}
				modifier = {
					factor = 1.4
					intrigue = 12
				}
				modifier = {
					factor = 1.4
					intrigue = 16
				}
				modifier = {
					factor = 1.6
					intrigue = 20
				}
				modifier = {
					factor = 1.5
					trait = deceitful
				}
				modifier = {
					factor = 2
					trait = fair
					OR = {
						trait = fair
						AND = {
							age < 40
							FROM = { age < 40 }
						}
					}
					OR = {
						is_opposite_sex = FROM
						AND = {
							same_sex = FROM
							FROM = { trait = homosexual }
						}
					}
					FROM = {
						NOR = {
							trait = chaste
							trait = celibate
							trait = eunuch
						}
					}
				}
				
				custom_tooltip = {
					text = ipc_success_tooltip
					set_character_flag = moderate_success
				}
			}
			
			25 = {
				modifier = {
					factor = 0.8
					FROM = { trait = trusting }
				}
				modifier = {
					factor = 1.2
					FROM = { trait = greedy }
				}
				modifier = {
					factor = 1.1
					FROM = { intrigue = 5 }
				}
				modifier = {
					factor = 1.1
					FROM = { intrigue = 10 }
				}
				modifier = {
					factor = 1.1
					FROM = { intrigue = 15 }
				}
				modifier = {
					factor = 1.3
					FROM = { intrigue = 20 }
				}
				modifier = {
					factor = 1.5
					FROM = { trait = paranoid }
				}
				modifier = {
					factor = 1.5
					FROM = { trait = shrewd }
				}
				
				
				custom_tooltip = {
					text = ipc_failure_tooltip
					set_character_flag = mission_failure
				}
			}
		}
		ai_chance = {
			factor = 20
			modifier = {
				factor = 0
				wealth < 50
			}
			modifier = {
				factor = 0.8
				trait = greedy
			}
			modifier = {
				factor = 2.5
				is_loyal_to_empire_trigger = yes
			}
			modifier = {
				factor = 1.2
				scaled_wealth = 0.3
			}
			modifier = {
				factor = 1.2
				scaled_wealth = 0.4
			}
			modifier = {
				factor = 1.3
				scaled_wealth = 0.5
			}
			modifier = {
				factor = 1.3
				scaled_wealth = 0.6
			}
			modifier = {
				factor = 1.5
				scaled_wealth = 0.8
			}
		}
	}
	
	after = { hidden_tooltip = { character_event = { id = ipcq.424 days = 30 } } }
}


####get result, end mission if failed
character_event = {
	id = ipcq.424
	desc = {
		trigger = { has_character_flag = moderate_success }
		text = EVTDESAipcq.424
	}
	desc = {
		trigger = { has_character_flag = mission_failure }
		text = EVTDESBipcq.424
	}
	picture = GFX_evt_council_speaker
	
	is_triggered_only = yes
	
	show_from_from = yes
	
	option = {
		trigger = { has_character_flag = moderate_success }
		name = EVTOPTAipcq.424
		hidden_tooltip = { character_event = { id = ipcq.425 days = 30 } } 
	}
	
	option = {
		trigger = { has_character_flag = mission_failure }
		name = EVTOPTBipcq.424
		clr_quest = {
			id = quest_ipc_infiltrate_court
			failure = yes
		}
		add_failed_empire_opinion_effect = yes
	}
	
	after = {
		hidden_tooltip = { 
			clr_character_flag = moderate_success
			clr_character_flag = mission_failure
		}
	}
}


####spawn the courtier and complete mission
character_event = {
	id = ipcq.425
	desc = EVTDESAipcq.425
	picture = GFX_evt_council_speaker
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTAipcq.425
		event_target:infiltrate_court_target = {
			create_character = {
				age = 30
				random_traits = yes
				dynasty = random
				female = no
				religion = THIS
				culture = THIS
				attributes = {
					diplomacy = 4
					martial = 4
					stewardship = 4
					intrigue = 6
					learning = 4
				}
			}
			hidden_tooltip = {
				new_character = {
					remove_trait = weak
					remove_trait = slow
					remove_trait = imbecile
					remove_trait = dull
					
					remove_trait = mystic
					remove_trait = socializer
					remove_trait = gamer
					remove_trait = hedonist
					remove_trait = duelist
					remove_trait = hunter
					remove_trait = strategist
					remove_trait = administrator
					remove_trait = architect
					remove_trait = gardener
					remove_trait = schemer
					remove_trait = impaler
					remove_trait = seducer
					remove_trait = seductress
					remove_trait = theologian
					remove_trait = scholar
					
					remove_trait = naive_appeaser
					remove_trait = underhanded_rogue
					remove_trait = charismatic_negotiator
					remove_trait = grey_eminence
					
					remove_trait = misguided_warrior
					remove_trait = tough_soldier
					remove_trait = skilled_tactician
					remove_trait = brilliant_strategist
					
					remove_trait = indulgent_wastrel
					remove_trait = thrifty_clerk
					remove_trait = fortune_builder
					remove_trait = midas_touched
					
					remove_trait = amateurish_plotter
					remove_trait = flamboyant_schemer
					remove_trait = intricate_webweaver
					remove_trait = elusive_shadow
					
					remove_trait = detached_priest
					remove_trait = martial_cleric
					remove_trait = scholarly_theologian
					remove_trait = mastermind_theologian

					remove_trait = content
					
					set_character_flag = no_court_invites
					set_character_flag = ipc_infiltrator
					add_trait = ipc_infiltrator_trait
					
					random_list = {
						50 = { add_trait = grey_eminence }
						50 = { add_trait = brilliant_strategist }
						50 = { add_trait = midas_touched }
						50 = { add_trait = elusive_shadow }
						50 = { add_trait = mastermind_theologian }
					}
					
					random_list = {
						25 = { change_intrigue = 3 }
						25 = { change_intrigue = 4 }
						25 = { change_intrigue = 5 }
						25 = { change_intrigue = 6 }
					}
					
					random_list = {
						20 = { add_trait = deceitful }
						20 = { add_trait = paranoid }
						20 = { add_trait = just }
						20 = { add_trait = administrator }
						20 = { add_trait = gardener }
						20 = { add_trait = erudite }
						20 = { add_trait = theologian }
					}
					
					opinion = { modifier = opinion_ipc_infiltrator who = ROOT years = 50 }
					ROOT = {
						society = {
							any_society_member = {
								limit = { society_rank > 1 }
								reverse_opinion = { modifier = opinion_ipc_infiltrator who = PREVPREVPREV years = 50 }
							}
						}
					}
					
				}
			}
		}
		change_society_currency = 200
		clr_quest = quest_ipc_infiltrate_court
		add_imperial_service_opinion_effect = yes
	}
}




################End of Mission stuff################


#########Success#########
character_event = {
	id = ipcq.1000
	
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		is_in_society = yes
		is_imperial_court_member_trigger = yes
	}
	
	immediate = {
		
		#vanilla already adds
		#if = {
		#	limit = {
		#		OR = {
		#			has_quest = quest_ipc_undermine_member
		#			has_quest = quest_ipc_build_imperial_road
		#			has_quest = quest_ipc_change_culture
		#		}
		#	}
		#	add_society_modifier = 	{
		#		modifier = ipc_successful_generic_mission
		#		years = 3
		#	}
		#}
		
		if = {
			limit = {
				OR = {
					has_quest = quest_ipc_improve_imperial_capital
					has_quest = quest_ipc_military_drill
					has_quest = quest_ipc_distribute_levy_recompense
					has_quest = quest_ipc_organize_festival
					has_quest = quest_ipc_investigate_secret_religions
				}
			}
			add_society_modifier = 	{
				modifier = ipc_successful_realm_mission
				years = 5
			}
		}
		else_if = {
			limit = {
				#OR = {
					has_quest = quest_ipc_infiltrate_court
				#}
			}
			add_society_modifier = 	{
				modifier = ipc_successful_foreign_mission
				years = 5
			}
		}
		else_if = {
			limit = {
				has_quest = quest_ipc_imperial_conquest
			}
			add_society_modifier = 	{
				modifier = ipc_successful_imperial_conquest
				years = 10
			}
		}
		add_character_modifier = { modifier = quest_cooldown_timer years = 1 hidden = yes }
		
		####report quest success
		#seneschal
		if = {
			limit = {
				OR = {
					has_quest = quest_ipc_build_imperial_road
					has_quest = quest_ipc_improve_imperial_capital
				}
			}
			trigger_switch = {
				on_trigger = has_quest
				
				quest_ipc_build_imperial_road = { add_character_modifier = { modifier = quest_ipc_build_imperial_road_success_notification days = 10 hidden = yes } }
				quest_ipc_improve_imperial_capital = { add_character_modifier = { modifier = quest_ipc_improve_imperial_capital_success_notification days = 10 hidden = yes } }
				
			}
			if = {
				limit = { top_liege = { primary_title = { has_title_flag = has_imperial_seneschal } } }
				society = { 
					persistent_event_target:current_imperial_seneschal = {
						if = {
							limit = { 
								NOR = {
									has_character_modifier = imperial_office_bonus
									has_instances_of_character_modifier = { modifier = imperial_office_bonus amount = 10 }
								}
							}
							add_character_modifier = { modifier = imperial_office_bonus duration = -1 stacking = yes }
						}
						character_event = { id = ipcq.1010 days = 2 }
					}
				}
			}
			else = { 
				society = { 
					leader = {
						if = {
							limit = {
								NOT = { tier = emperor }
								NOR = {
									has_character_modifier = imperial_office_bonus
									has_instances_of_character_modifier = { modifier = imperial_office_bonus amount = 10 }
								}
							}
							add_character_modifier = { modifier = imperial_office_bonus duration = -1 stacking = yes }
						}
						character_event = { id = ipcq.1010 days = 2 } 
					} 
				}
			}
		}
		#marshal
		else_if = {
			limit = {
				OR = {
					has_quest = quest_ipc_military_drill
					has_quest = quest_ipc_distribute_levy_recompense
					has_quest = quest_ipc_imperial_conquest
				}
			}
			trigger_switch = {
				on_trigger = has_quest
				
				quest_ipc_military_drill = { add_character_modifier = { modifier = quest_ipc_military_drill_success_notification days = 10 hidden = yes } }
				quest_ipc_distribute_levy_recompense = { add_character_modifier = { modifier = quest_ipc_distribute_levy_recompense_success_notification days = 10 hidden = yes } }
				quest_ipc_imperial_conquest = { add_character_modifier = { modifier = quest_ipc_imperial_conquest_success_notification days = 10 hidden = yes } }
				
			}
			if = {
				limit = { top_liege = { primary_title = { has_title_flag = has_imperial_marshal } } }
				society = { 
					persistent_event_target:current_imperial_marshal = {
						if = {
							limit = { 
								NOR = {
									has_character_modifier = imperial_office_bonus
									has_instances_of_character_modifier = { modifier = imperial_office_bonus amount = 10 }
								}
							}
							add_character_modifier = { modifier = imperial_office_bonus duration = -1 stacking = yes }
						}
						character_event = { id = ipcq.1020 days = 2 }
					}
				}
			}
			else = { 
				society = { 
					leader = {
						if = {
							limit = {
								NOT = { tier = emperor }
								NOR = {
									has_character_modifier = imperial_office_bonus
									has_instances_of_character_modifier = { modifier = imperial_office_bonus amount = 10 }
								}
							}
							add_character_modifier = { modifier = imperial_office_bonus duration = -1 stacking = yes }
						}
						character_event = { id = ipcq.1020 days = 2 } 
					} 
				}
			}
		}
		#lawkeeper
		else_if = {
			limit = {
				#OR = {
					has_quest = quest_ipc_change_culture
				#}
			}
			trigger_switch = {
				on_trigger = has_quest
				
				quest_ipc_change_culture = { add_character_modifier = { modifier = quest_ipc_change_culture_success_notification days = 10 hidden = yes } }
				quest_ipc_organize_festival = { add_character_modifier = { modifier = quest_ipc_organize_festival_success_notification days = 10 hidden = yes } }
				
			}
			if = {
				limit = { top_liege = { primary_title = { has_title_flag = has_imperial_lawkeeper } } }
				society = { 
					persistent_event_target:current_imperial_lawkeeper = {
						if = {
							limit = { 
								NOR = {
									has_character_modifier = imperial_office_bonus
									has_instances_of_character_modifier = { modifier = imperial_office_bonus amount = 10 }
								}
							}
							add_character_modifier = { modifier = imperial_office_bonus duration = -1 stacking = yes }
						}
						character_event = { id = ipcq.1030 days = 2 }
					}
				}
			}
			else = { 
				society = { 
					leader = {
						if = {
							limit = {
								NOT = { tier = emperor }
								NOR = {
									has_character_modifier = imperial_office_bonus
									has_instances_of_character_modifier = { modifier = imperial_office_bonus amount = 10 }
								}
							}
							add_character_modifier = { modifier = imperial_office_bonus duration = -1 stacking = yes }
						}
						character_event = { id = ipcq.1030 days = 2 } 
					} 
				}
			}
		}
		#spymaster
		else_if = {
			limit = {
				OR = {
					has_quest = quest_ipc_investigate_secret_religions
					has_quest = quest_ipc_infiltrate_court
				}
			}
			trigger_switch = {
				on_trigger = has_quest
				
				quest_ipc_investigate_secret_religions = { add_character_modifier = { modifier = quest_ipc_investigate_secret_religions_success_notification days = 10 hidden = yes } }
				quest_ipc_infiltrate_court = { add_character_modifier = { modifier = quest_ipc_infiltrate_court_success_notification days = 10 hidden = yes } }
				
			}
			if = {
				limit = { top_liege = { primary_title = { has_title_flag = has_imperial_spymaster } } }
				society = { 
					persistent_event_target:current_imperial_spymaster = {
						if = {
							limit = { 
								NOR = {
									has_character_modifier = imperial_office_bonus
									has_instances_of_character_modifier = { modifier = imperial_office_bonus amount = 10 }
								}
							}
							add_character_modifier = { modifier = imperial_office_bonus duration = -1 stacking = yes }
						}
						character_event = { id = ipcq.1040 days = 2 }
					}
				}
			}
			else = { 
				society = { 
					leader = {
						if = {
							limit = {
								NOT = { tier = emperor }
								NOR = {
									has_character_modifier = imperial_office_bonus
									has_instances_of_character_modifier = { modifier = imperial_office_bonus amount = 10 }
								}
							}
							add_character_modifier = { modifier = imperial_office_bonus duration = -1 stacking = yes }
						}
						character_event = { id = ipcq.1040 days = 2 } 
					} 
				}
			}
		}
	}
}

#########Failure#########
character_event = {
	id = ipcq.1001
	
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		is_in_society = yes
		is_imperial_court_member_trigger = yes
	}
	
	immediate = {
		
		#vanilla already adds
		#if = {
		#	limit = {
		#		OR = {
		#			has_quest = quest_ipc_undermine_member
		#			has_quest = quest_ipc_build_imperial_road
		#			has_quest = quest_ipc_change_culture
		#		}
		#	}
		#	add_society_modifier = 	{
		#		modifier = ipc_failed_generic_mission
		#		years = 3
		#	}
		#}
		
		if = {
			limit = {
				OR = {
					has_quest = quest_ipc_improve_imperial_capital
					has_quest = quest_ipc_military_drill
					has_quest = quest_ipc_distribute_levy_recompense
					has_quest = quest_ipc_organize_festival
					has_quest = quest_ipc_investigate_secret_religions
				}
			}
			add_society_modifier = 	{
				modifier = ipc_failed_realm_mission
				years = 5
			}
		}
		else_if = {
			limit = {
				#OR = {
					has_quest = quest_ipc_infiltrate_court
				#}
			}
			add_society_modifier = 	{
				modifier = ipc_failed_foreign_mission
				years = 5
			}
		}
		else_if = {
			limit = {
				has_quest = quest_ipc_imperial_conquest
			}
			add_society_modifier = 	{
				modifier = ipc_failed_imperial_conquest
				years = 10
			}
		}
		add_character_modifier = { modifier = quest_cooldown_timer years = 1 hidden = yes }
		
		####report quest failure
		#seneschal
		if = {
			limit = {
				#OR = {
					has_quest = quest_ipc_improve_imperial_capital
				#}
			}
			trigger_switch = {
				on_trigger = has_quest
				
				quest_ipc_improve_imperial_capital = { add_character_modifier = { modifier = quest_ipc_improve_imperial_capital_failure_notification days = 10 hidden = yes } }
				
			}
			if = {
				limit = { top_liege = { primary_title = { has_title_flag = has_imperial_seneschal } } }
				society = { 
					persistent_event_target:current_imperial_seneschal = {
						if = {
							limit = { 
								OR = {
									has_character_modifier = imperial_office_bonus
									has_instances_of_character_modifier = { modifier = imperial_office_bonus amount > 1 }
								}
							}
							remove_character_modifier = imperial_office_bonus
						}
						character_event = { id = ipcq.1010 days = 2 }
					}
				}
			}
			else = { 
				society = { 
					leader = {
						if = {
							limit = {
								NOT = { tier = emperor }
								OR = {
									has_character_modifier = imperial_office_bonus
									has_instances_of_character_modifier = { modifier = imperial_office_bonus amount > 1 }
								}
							}
							remove_character_modifier = imperial_office_bonus
						}
						character_event = { id = ipcq.1010 days = 2 } 
					} 
				}
			}
		}
		#marshal
		else_if = {
			limit = {
				OR = {
					has_quest = quest_ipc_military_drill
					has_quest = quest_ipc_distribute_levy_recompense
					has_quest = quest_ipc_imperial_conquest
				}
			}
			trigger_switch = {
				on_trigger = has_quest
				
				quest_ipc_military_drill = { add_character_modifier = { modifier = quest_ipc_military_drill_failure_notification days = 10 hidden = yes } }
				quest_ipc_distribute_levy_recompense = { add_character_modifier = { modifier = quest_ipc_distribute_levy_recompense_failure_notification days = 10 hidden = yes } }
				quest_ipc_imperial_conquest = { add_character_modifier = { modifier = quest_ipc_imperial_conquest_failure_notification days = 10 hidden = yes } }
			}
			if = {
				limit = { top_liege = { primary_title = { has_title_flag = has_imperial_marshal } } }
				society = { 
					persistent_event_target:current_imperial_marshal = {
						if = {
							limit = { 
								OR = {
									has_character_modifier = imperial_office_bonus
									has_instances_of_character_modifier = { modifier = imperial_office_bonus amount > 1 }
								}
							}
							remove_character_modifier = imperial_office_bonus
						}
						character_event = { id = ipcq.1020 days = 2 }
					}
				}
			}
			else = { 
				society = { 
					leader = {
						if = {
							limit = {
								NOT = { tier = emperor }
								OR = {
									has_character_modifier = imperial_office_bonus
									has_instances_of_character_modifier = { modifier = imperial_office_bonus amount > 1 }
								}
							}
							remove_character_modifier = imperial_office_bonus
						}
						character_event = { id = ipcq.1020 days = 2 } 
					} 
				}
			}
		}
		#lawkeeper
		else_if = {
			limit = {
				#OR = {
					has_quest = quest_ipc_change_culture
				#}
			}
			trigger_switch = {
				on_trigger = has_quest
				
				quest_ipc_change_culture = { add_character_modifier = { modifier = quest_ipc_change_culture_failure_notification days = 10 hidden = yes } }
				quest_ipc_organize_festival = { add_character_modifier = { modifier = quest_ipc_organize_festival_failure_notification days = 10 hidden = yes } }
				
			}
			if = {
				limit = { top_liege = { primary_title = { has_title_flag = has_imperial_lawkeeper } } }
				society = { 
					persistent_event_target:current_imperial_lawkeeper = {
						if = {
							limit = { 
								OR = {
									has_character_modifier = imperial_office_bonus
									has_instances_of_character_modifier = { modifier = imperial_office_bonus amount > 1 }
								}
							}
							remove_character_modifier = imperial_office_bonus
						}
						character_event = { id = ipcq.1030 days = 2 }
					}
				}
			}
			else = { 
				society = { 
					leader = {
						if = {
							limit = {
								NOT = { tier = emperor }
								OR = {
									has_character_modifier = imperial_office_bonus
									has_instances_of_character_modifier = { modifier = imperial_office_bonus amount > 1 }
								}
							}
							remove_character_modifier = imperial_office_bonus
						}
						character_event = { id = ipcq.1030 days = 2 } 
					} 
				}
			}
		}
		#spymaster
		else_if = {
			limit = {
				OR = {
					has_quest = quest_ipc_investigate_secret_religions
					has_quest = quest_ipc_infiltrate_court
				}
			}
			trigger_switch = {
				on_trigger = has_quest
				
				quest_ipc_investigate_secret_religions = { add_character_modifier = { modifier = quest_ipc_investigate_secret_religions_failure_notification days = 10 hidden = yes } }
				quest_ipc_infiltrate_court = { add_character_modifier = { modifier = quest_ipc_infiltrate_court_failure_notification days = 10 hidden = yes } }
				
			}
			if = {
				limit = { top_liege = { primary_title = { has_title_flag = has_imperial_spymaster } } }
				society = { 
					persistent_event_target:current_imperial_spymaster = {
						if = {
							limit = { 
								OR = {
									has_character_modifier = imperial_office_bonus
									has_instances_of_character_modifier = { modifier = imperial_office_bonus amount > 1 }
								}
							}
							remove_character_modifier = imperial_office_bonus
						}
						character_event = { id = ipcq.1040 days = 2 }
					}
				}
			}
			else = { 
				society = { 
					leader = {
						if = {
							limit = {
								NOT = { tier = emperor }
								OR = {
									has_character_modifier = imperial_office_bonus
									has_instances_of_character_modifier = { modifier = imperial_office_bonus amount > 1 }
								}
							}
							remove_character_modifier = imperial_office_bonus
						}
						character_event = { id = ipcq.1040 days = 2 } 
					} 
				}
			}
		}
	}
}


#########Death#########
character_event = {
	id = ipcq.1002
	
	hide_window = yes
	is_triggered_only = yes
	
	is_in_society = yes
	
	trigger = {
		is_imperial_court_member_trigger = yes
		has_any_quest = yes
	}
	
	immediate = {
		#seneschal
		if = {
			limit = {
				OR = {
					has_quest = quest_ipc_build_imperial_road
					has_quest = quest_ipc_improve_imperial_capital
				}
			}
			if = {
				limit = { has_quest = quest_ipc_build_imperial_road }
				quest_target = { remove_province_modifier = building_imperial_road }
			}
			if = {
				limit = { top_liege = { primary_title = { has_title_flag = has_imperial_seneschal } } }
				society = { persistent_event_target:current_imperial_seneschal = { character_event = { id = ipcq.1050 days = 2 } } }
			}
			else = { society = { leader = { character_event = { id = ipcq.1050 days = 2 } } } }
		}
		#marshal
		else_if = {
			limit = {
				OR = {
					has_quest = quest_ipc_military_drill
					has_quest = quest_ipc_distribute_levy_recompense
					has_quest = quest_ipc_imperial_conquest
				}
			}
			if = {
				limit = { top_liege = { primary_title = { has_title_flag = has_imperial_marshal } } }
				society = { persistent_event_target:current_imperial_marshal = { character_event = { id = ipcq.1050 days = 2 } } }
			}
			else = { society = { leader = { character_event = { id = ipcq.1050 days = 2 } } } }
		}
		#lawkeeper
		else_if = {
			limit = {
				OR = {
					has_quest = quest_ipc_change_culture
					has_quest = quest_ipc_organize_festival
				}
			}
			if = {
				limit = { top_liege = { primary_title = { has_title_flag = has_imperial_lawkeeper } } }
				society = { persistent_event_target:current_imperial_lawkeeper = { character_event = { id = ipcq.1050 days = 2 } } }
			}
			else = { society = { leader = { character_event = { id = ipcq.1050 days = 2 } } } }
		}
		#spymaster
		else_if = {
			limit = {
				OR = {
					has_quest = quest_ipc_investigate_secret_religions
					has_quest = quest_ipc_infiltrate_court
				}
			}
			if = {
				limit = { top_liege = { primary_title = { has_title_flag = has_imperial_spymaster } } }
				society = { persistent_event_target:current_imperial_spymaster = { character_event = { id = ipcq.1050 days = 2 } } }
			}
			else = { society = { leader = { character_event = { id = ipcq.1050 days = 2 } } } }
		}
	}
}

##############Notifications##############

#########Seneschal#########
#notification
character_event = {
	id = ipcq.1010
	desc = {
		trigger = { FROM = { has_character_modifier = quest_ipc_build_imperial_road_success_notification } }
		text = EVTDESAipcq.1010
	}
	desc = {
		trigger = { FROM = { has_character_modifier = quest_ipc_improve_imperial_capital_success_notification } }
		text = EVTDESBipcq.1010
	}
	desc = {
		trigger = { FROM = { has_character_modifier = quest_ipc_improve_imperial_capital_failure_notification } }
		text = EVTDESCipcq.1010
	}
	picture = GFX_evt_recieve_letter
	
	notification = yes
	
	is_triggered_only = yes
	
	immediate = { get_imperial_capital_effect = yes }
	
	option = { name = OK }
}



#########Marshal#########
#notification
character_event = {
	id = ipcq.1020
	desc = {
		trigger = { FROM = { has_character_modifier = quest_ipc_military_drill_success_notification } }
		text = EVTDESAipcq.1020
	}
	desc = {
		trigger = { FROM = { has_character_modifier = quest_ipc_military_drill_failure_notification } }
		text = EVTDESBipcq.1020
	}
	desc = {
		trigger = { FROM = { has_character_modifier = quest_ipc_distribute_levy_recompense_success_notification } }
		text = EVTDESCipcq.1020
	}
	desc = {
		trigger = { FROM = { has_character_modifier = quest_ipc_distribute_levy_recompense_failure_notification } }
		text = EVTDESDipcq.1020
	}
	desc = {
		trigger = { FROM = { has_character_modifier = quest_ipc_imperial_conquest_success_notification } }
		text = EVTDESEipcq.1020
	}
	desc = {
		trigger = { FROM = { has_character_modifier = quest_ipc_imperial_conquest_failure_notification } }
		text = EVTDESFipcq.1020
	}
	picture = GFX_evt_recieve_letter
	
	notification = yes
	
	is_triggered_only = yes
	
	option = { name = OK }
}

#########Lawkeeper#########
#notification
character_event = {
	id = ipcq.1030
	desc = {
		trigger = { FROM = { has_character_modifier = quest_ipc_change_culture_success_notification } }
		text = EVTDESAipcq.1030
	}
	desc = {
		trigger = { FROM = { has_character_modifier = quest_ipc_change_culture_failure_notification } }
		text = EVTDESBipcq.1030
	}
	desc = {
		trigger = { FROM = { has_character_modifier = quest_ipc_organize_festival_success_notification } }
		text = EVTDESCipcq.1030
	}
	desc = {
		trigger = { FROM = { has_character_modifier = quest_ipc_organize_festival_failure_notification } }
		text = EVTDESDipcq.1030
	}
	
	picture = GFX_evt_recieve_letter
	
	notification = yes
	
	is_triggered_only = yes
	
	option = { name = OK }
}


#########Spymaster#########
#notification
character_event = {
	id = ipcq.1040
	desc = {
		trigger = { FROM = { has_character_modifier = quest_ipc_investigate_secret_religions_success_notification } }
		text = EVTDESAipcq.1040
	}
	desc = {
		trigger = { FROM = { has_character_modifier = quest_ipc_investigate_secret_religions_failure_notification } }
		text = EVTDESBipcq.1040
	}
	
	desc = {
		trigger = { FROM = { has_character_modifier = quest_ipc_infiltrate_court_success_notification } }
		text = EVTDESCipcq.1040
	}
	desc = {
		trigger = { FROM = { has_character_modifier = quest_ipc_infiltrate_court_failure_notification } }
		text = EVTDESDipcq.1040
	}
	picture = GFX_evt_recieve_letter
	
	notification = yes
	
	is_triggered_only = yes
	
	option = { name = OK }
}


#########Death#########
character_event = {
	id = ipcq.1050
	desc = EVTDESAipcq.1050
	picture = GFX_evt_recieve_letter
	
	notification = yes
	
	is_triggered_only = yes
	
	option = { name = OK }
}












